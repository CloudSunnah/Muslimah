<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muslimah - by CLOUD SUNNAH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Konfigurasi Tailwind CSS untuk mengaktifkan mode gelap via class
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        html {
            height: 100%;
            width: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .splash-screen {
            background: linear-gradient(to bottom right, #fbcfe8, #fda4af);
        }

        .main-container {
            transition: background-color 0.5s ease;
        }

        .bottom-nav-button-active {
            transform: translateY(-0.5rem);
        }

        .chat-bubble-user {
            border-bottom-right-radius: 0;
        }

        .chat-bubble-bot {
            border-bottom-left-radius: 0;
        }

        .animate-pulse-dot {
            animation: pulse-dot 1.4s infinite ease-in-out both;
        }

        @keyframes pulse-dot {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1.0);
            }
        }

        .animate-pulse-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .animate-pulse-dot:nth-child(2) {
            animation-delay: -0.16s;
        }
    </style>
</head>

<body class="overflow-hidden">

    <!-- Login Screen -->
    <div id="login-screen"
        class="w-full h-screen flex flex-col justify-center items-center fixed inset-0 z-[101] bg-gradient-to-br from-pink-500 via-rose-400 to-pink-600">
        <div class="w-full max-w-md px-6">
            <!-- Logo/Title -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white tracking-widest mb-2"
                    style="text-shadow: 2px 2px 4px rgba(0,0,0,0.2)">MUSLIMAH</h1>
                <p class="text-white/80 text-lg">by CLOUD SUNNAH</p>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 shadow-2xl">
                <h2 class="text-2xl font-bold text-center text-slate-800 mb-6">Masuk ke Akun</h2>

                <div class="space-y-4">
                    <div>
                        <input id="login-email" type="email" placeholder="Email"
                            class="w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 text-slate-800">
                    </div>
                    <div>
                        <input id="login-password" type="password" placeholder="Password"
                            class="w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 text-slate-800">
                    </div>
                    <button id="login-btn"
                        class="w-full py-3 bg-pink-500 text-white font-semibold rounded-lg hover:bg-pink-600 transition-colors">
                        Masuk
                    </button>
                </div>

                <div class="text-center mt-4">
                    <p class="text-slate-600">Belum punya akun?
                        <button id="show-register-btn" class="text-pink-500 font-semibold hover:text-pink-600">Daftar di
                            sini</button>
                    </p>
                </div>

                <div id="login-error"
                    class="hidden mt-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg text-sm"></div>
            </div>

            <!-- Register Form -->
            <div id="register-form" class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 shadow-2xl hidden">
                <h2 class="text-2xl font-bold text-center text-slate-800 mb-6">Daftar Akun Baru</h2>

                <div class="space-y-4">
                    <div>
                        <input id="register-name" type="text" placeholder="Nama Lengkap"
                            class="w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 text-slate-800">
                    </div>
                    <div>
                        <input id="register-email" type="email" placeholder="Email"
                            class="w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 text-slate-800">
                    </div>
                    <div>
                        <input id="register-password" type="password" placeholder="Password (min. 6 karakter)"
                            class="w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 text-slate-800">
                    </div>
                    <div>
                        <input id="register-confirm-password" type="password" placeholder="Konfirmasi Password"
                            class="w-full px-4 py-3 bg-slate-100 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 text-slate-800">
                    </div>
                    <button id="register-btn"
                        class="w-full py-3 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors">
                        Daftar
                    </button>
                </div>

                <div class="text-center mt-4">
                    <p class="text-slate-600">Sudah punya akun?
                        <button id="show-login-btn" class="text-pink-500 font-semibold hover:text-pink-600">Masuk di
                            sini</button>
                    </p>
                </div>

                <div id="register-error"
                    class="hidden mt-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg text-sm"></div>
                <div id="register-success"
                    class="hidden mt-4 p-3 bg-green-100 border border-green-300 text-green-700 rounded-lg text-sm">
                </div>
            </div>

            <!-- Waiting for Approval -->
            <div id="waiting-approval" class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 shadow-2xl hidden">
                <div class="text-center">
                    <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h2 class="text-xl font-bold text-slate-800 mb-2">Menunggu Persetujuan</h2>
                    <p class="text-slate-600 mb-4">Akun Anda sedang menunggu persetujuan dari admin. Anda akan dapat
                        mengakses aplikasi setelah akun disetujui.</p>
                    <button id="logout-btn"
                        class="px-6 py-2 bg-slate-500 text-white rounded-lg hover:bg-slate-600 transition-colors">
                        Keluar
                    </button>
                </div>
            </div>

            <!-- Loading -->
            <div id="auth-loading" class="hidden text-center">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
                <p class="mt-2 text-white">Memproses...</p>
            </div>
        </div>
    </div>

    <!-- Splash Screen -->
    <div id="splash-screen"
        class="splash-screen w-full h-screen flex flex-col justify-center items-center fixed inset-0 z-[100] transition-opacity duration-500 hidden">
        <div class="text-center">
            <h1 class="text-5xl font-bold text-white tracking-widest" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.2)">
                MUSLIMAH</h1>
            <p class="text-white/80 mt-2 text-lg">by CLOUD SUNNAH</p>
        </div>
        <div class="absolute bottom-10 text-white/70 text-sm">Loading...</div>
    </div>

    <!-- Main App Structure -->
    <div id="app-container"
        class="font-sans antialiased w-full h-screen flex flex-col bg-rose-50 dark:bg-slate-900 main-container hidden">
        <main id="main-content" class="flex-grow overflow-y-auto">
            <!-- Content will be rendered here by JavaScript -->
        </main>
        <nav id="bottom-nav-bar"
            class="shrink-0 bg-white/80 dark:bg-slate-800/80 backdrop-blur-lg border-t border-slate-200/80 dark:border-slate-700/80 rounded-t-3xl shadow-[0_-5px_20px_-5px_rgba(0,0,0,0.05)]">
            <!-- Bottom Nav will be rendered here by JavaScript -->
        </nav>
    </div>

    <script>
        // === Firebase Configuration ===
        const firebaseConfig = {
            apiKey: "AIzaSyCyYsy5vPRlC8h6eu-o7J6hnSpFbYg-JnU",
            authDomain: "muslimah-ecc7f.firebaseapp.com",
            projectId: "muslimah-ecc7f",
            storageBucket: "muslimah-ecc7f.firebasestorage.app",
            messagingSenderId: "429716762955",
            appId: "1:429716762955:web:e2cbc6728c4dab2c9a38ce",
            measurementId: "G-WDR3VGJKW0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // === Authentication Functions ===
        const showElement = (id) => document.getElementById(id).classList.remove('hidden');
        const hideElement = (id) => document.getElementById(id).classList.add('hidden');
        const showError = (elementId, message) => {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        };
        const hideError = (elementId) => {
            document.getElementById(elementId).classList.add('hidden');
        };

        const registerUser = async () => {
            const name = document.getElementById('register-name').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;

            hideError('register-error');
            hideElement('register-success');

            if (!name || !email || !password) {
                showError('register-error', 'Semua field harus diisi.');
                return;
            }

            if (password.length < 6) {
                showError('register-error', 'Password minimal 6 karakter.');
                return;
            }

            if (password !== confirmPassword) {
                showError('register-error', 'Password dan konfirmasi password tidak sama.');
                return;
            }

            showElement('auth-loading');

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Update profile dengan nama
                await user.updateProfile({
                    displayName: name
                });

                // Simpan data user ke Firestore dengan status pending
                await db.collection('users').doc(user.uid).set({
                    name: name,
                    email: email,
                    status: 'pending', // pending, approved, rejected
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    uid: user.uid
                });

                document.getElementById('register-success').innerHTML =
                    'Pendaftaran berhasil! Akun Anda akan disetujui oleh admin terlebih dahulu.';
                showElement('register-success');

                // Clear form
                document.getElementById('register-name').value = '';
                document.getElementById('register-email').value = '';
                document.getElementById('register-password').value = '';
                document.getElementById('register-confirm-password').value = '';

                setTimeout(() => {
                    hideElement('register-form');
                    showElement('waiting-approval');
                }, 2000);

            } catch (error) {
                console.error('Registration error:', error);
                let errorMessage = 'Terjadi kesalahan saat mendaftar.';

                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Email sudah terdaftar. Silakan gunakan email lain atau login.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Format email tidak valid.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Password terlalu lemah.';
                }

                showError('register-error', errorMessage);
            } finally {
                hideElement('auth-loading');
            }
        };

        const loginUser = async () => {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;

            hideError('login-error');

            if (!email || !password) {
                showError('login-error', 'Email dan password harus diisi.');
                return;
            }

            showElement('auth-loading');

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Check user status di Firestore
                const userDoc = await db.collection('users').doc(user.uid).get();

                if (!userDoc.exists) {
                    // Jika user tidak ada di Firestore, buat data baru dengan status pending
                    await db.collection('users').doc(user.uid).set({
                        name: user.displayName || 'User',
                        email: user.email,
                        status: 'pending',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        uid: user.uid
                    });

                    hideElement('login-form');
                    showElement('waiting-approval');
                    return;
                }

                const userData = userDoc.data();

                if (userData.status === 'pending') {
                    hideElement('login-form');
                    showElement('waiting-approval');
                } else if (userData.status === 'approved') {
                    // User disetujui, lanjut ke aplikasi
                    proceedToApp();
                } else if (userData.status === 'rejected') {
                    await auth.signOut();
                    showError('login-error', 'Akun Anda ditolak oleh admin. Silakan hubungi administrator.');
                } else {
                    // Status tidak dikenal, default ke pending
                    hideElement('login-form');
                    showElement('waiting-approval');
                }

            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Terjadi kesalahan saat login.';

                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Email tidak terdaftar. Silakan daftar terlebih dahulu.';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Password salah.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Format email tidak valid.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Terlalu banyak percobaan login. Coba lagi nanti.';
                }

                showError('login-error', errorMessage);
            } finally {
                hideElement('auth-loading');
            }
        };

        const logoutUser = async () => {
            try {
                await auth.signOut();
                hideElement('waiting-approval');
                showElement('login-form');

                // Clear forms
                document.getElementById('login-email').value = '';
                document.getElementById('login-password').value = '';
            } catch (error) {
                console.error('Logout error:', error);
            }
        };

        const proceedToApp = () => {
            hideElement('login-screen');
            showElement('splash-screen');

            // Initialize app
            if (typeof window.initApp === 'function') {
                window.initApp();
            }

            setTimeout(() => {
                const splashScreen = document.getElementById('splash-screen');
                const appContainer = document.getElementById('app-container');

                splashScreen.style.opacity = '0';
                appContainer.classList.remove('hidden');
                appContainer.classList.add('flex');
                setTimeout(() => splashScreen.style.display = 'none', 500);
            }, 1500);
        };

        // === Auth State Listener ===
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                // User sudah login, cek status di Firestore
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();

                    if (userDoc.exists) {
                        const userData = userDoc.data();

                        if (userData.status === 'approved') {
                            // Jika user sudah disetujui dan sedang di halaman login, langsung masuk
                            if (!document.getElementById('login-screen').classList.contains('hidden')) {
                                proceedToApp();
                            }
                        } else if (userData.status === 'pending') {
                            // Tampilkan halaman waiting
                            hideElement('login-form');
                            hideElement('register-form');
                            showElement('waiting-approval');
                        } else if (userData.status === 'rejected') {
                            // Logout jika ditolak
                            await auth.signOut();
                        }
                    } else {
                        // User tidak ada di Firestore, buat dengan status pending
                        await db.collection('users').doc(user.uid).set({
                            name: user.displayName || 'User',
                            email: user.email,
                            status: 'pending',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            uid: user.uid
                        });

                        hideElement('login-form');
                        hideElement('register-form');
                        showElement('waiting-approval');
                    }
                } catch (error) {
                    console.error('Error checking user status:', error);
                }
            } else {
                // User tidak login, tampilkan form login
                hideElement('splash-screen');
                hideElement('app-container');
                showElement('login-screen');
                showElement('login-form');
                hideElement('register-form');
                hideElement('waiting-approval');
            }
        });

        // === Auth Event Listeners ===
        document.addEventListener('DOMContentLoaded', () => {
            // Login/Register form toggles
            document.getElementById('show-register-btn').addEventListener('click', () => {
                hideElement('login-form');
                showElement('register-form');
                hideError('login-error');
            });

            document.getElementById('show-login-btn').addEventListener('click', () => {
                hideElement('register-form');
                showElement('login-form');
                hideError('register-error');
                hideElement('register-success');
            });

            // Form submissions
            document.getElementById('login-btn').addEventListener('click', loginUser);
            document.getElementById('register-btn').addEventListener('click', registerUser);
            document.getElementById('logout-btn').addEventListener('click', logoutUser);

            // Enter key support
            document.getElementById('login-email').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') loginUser();
            });
            document.getElementById('login-password').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') loginUser();
            });
            document.getElementById('register-confirm-password').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') registerUser();
            });
        });

        // === App State and Logic ===
        document.addEventListener('DOMContentLoaded', () => {
            const mainContent = document.getElementById('main-content');
            const bottomNavBarContainer = document.getElementById('bottom-nav-bar');
            const splashScreen = document.getElementById('splash-screen');
            const appContainer = document.getElementById('app-container');

            // --- App Constants ---
            const FIDYAH_PER_DAY = 45000;

            // --- App State ---
            let state = {
                theme: 'light',
                activeScreen: 'tap-clipz',
                currentDate: new Date(),
                isModalOpen: false,
                selectedDate: null,
                showChatHistory: false,
                modalType: 'start', // 'start' untuk mulai haid, 'end' untuk selesai haid
                tanyaCloud: {
                    prompt: '',
                    messages: [],
                    isLoading: false,
                    error: null,
                    chatHistory: [],
                },
                tapClipz: {
                    currentVideoIndex: 0,
                    videos: [
                        'https://files.catbox.moe/yn4dut.mp4',
                        'https://files.catbox.moe/qwwqwj.mp4',
                        'https://files.catbox.moe/8tczgh.mp4',
                        'https://files.catbox.moe/tqz3g4.mp4',
                        'https://files.catbox.moe/ahvf6o.mp4'
                    ],
                    isVideoLoading: false
                },
                kuiz: {
                    currentQuestion: null,
                    isLoading: false,
                    error: null,
                    userAnswer: '',
                    showResult: false,
                    score: 0,
                    correctAnswer: '',
                    explanation: '',
                    totalQuestions: 0,
                    correctAnswers: 0,
                    history: []
                },
                userData: {
                    menstruationDates: [],
                    menstruationEndDates: [],
                    fastingDebt: 0,
                    manualFastingDebt: 0, // Hutang puasa yang ditambah manual
                },
                prayerTimes: {
                    data: null,
                    location: '',
                    lastUpdated: null,
                    isLoading: false,
                    error: null,
                    countdown: null,
                    nextPrayer: null
                }
            };

            // === Audio System ===
            let audioContext = null;
            let isPlayingClickSound = false;

            const playClickSound = () => {
                // Prevent multiple simultaneous click sounds
                if (isPlayingClickSound) return;

                try {
                    // Initialize audio context only once
                    if (!audioContext) {
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    }

                    // Resume audio context if suspended
                    if (audioContext.state === 'suspended') {
                        audioContext.resume();
                    }

                    isPlayingClickSound = true;

                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.1);

                    gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);

                    // Reset flag after sound duration
                    setTimeout(() => {
                        isPlayingClickSound = false;
                    }, 150);
                } catch (e) {
                    // Fallback jika audio context tidak didukung
                    isPlayingClickSound = false;
                    console.log("Audio not supported");
                }
            };

            // === ICONS (as functions returning SVG strings) ===
            const icons = {
                CalendarDays: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></svg>`,
                Cloudy: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z" /><path d="M22 10a3 3 0 0 0-3-3h-2.207a5.502 5.502 0 0 0-10.702.5" /></svg>`,
                Settings: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0 2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></svg>`,
                Moon: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" /></svg>`,
                Sun: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>`,
                Minus: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="M5 12h14" /></svg>`,
                Plus: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="M5 12h14" /><path d="M12 5v14" /></svg>`,
                ChevronLeft: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="m15 18-6-6 6-6" /></svg>`,
                ChevronRight: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="m9 18 6-6-6-6" /></svg>`,
                SendHorizonal: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="m3 3 3 9-3 9 19-9Z"/><path d="M6 12h16"/></svg>`,
                History: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>`,
                Trash2: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>`,
                ArrowLeft: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>`,
                Clock: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>`,
                MapPin: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>`,
                BookOpen: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
                CheckCircle: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22,4 12,14.01 9,11.01"/></svg>`,
                XCircle: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>`,
                RotateCcw: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>`,
                Play: (cn = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cn}"><polygon points="5,3 19,12 5,21"/></svg>`,
            };

            // === Hijri Date Converter (Algoritma yang Lebih Akurat) ===
            const toHijri = (gregorianDate) => {
                // Algoritma yang lebih akurat (Kuwaiti algorithm)
                const int = (n) => Math.floor(n);
                let d = gregorianDate.getDate();
                let m = gregorianDate.getMonth() + 1;
                let y = gregorianDate.getFullYear();

                // Konversi Gregorian ke Julian Day
                let jd = int((1461 * (y + 4800 + int((m - 14) / 12))) / 4) +
                    int((367 * (m - 2 - 12 * (int((m - 14) / 12)))) / 12) -
                    int((3 * (int((y + 4900 + int((m - 14) / 12)) / 100))) / 4) +
                    d - 32075;

                // Konversi Julian Day ke Hijriah
                let l = jd - 1948440 + 10632;
                let n = int((l - 1) / 10631);
                l = l - 10631 * n + 354;
                let j = (int((10985 - l) / 5316)) * (int((50 * l) / 17719)) +
                    (int(l / 5670)) * (int((43 * l) / 15238));
                l = l - (int((30 - j) / 15)) * (int((17719 * j) / 50)) -
                    (int(j / 16)) * (int((15238 * j) / 43)) + 29;

                let hMonth = int((24 * l) / 709);
                let hDay = l - int((709 * hMonth) / 24);
                let hYear = 30 * n + j - 30;

                const monthNames = ["Muharram", "Safar", "Rabi'ul Awwal", "Rabi'ul Akhir", "Jumadal Ula", "Jumadal Akhirah", "Rajab", "Sha'ban", "Ramadan", "Shawwal", "Dzulqaidah", "Dzulhijjah"];

                return {day: hDay, month: hMonth, monthName: monthNames[hMonth - 1], year: hYear};
            };

            // === Sistem Prediksi Menstruasi ===
            const calculateMenstrualPredictions = (userData) => {
                const predictions = {
                    nextPeriod: null,
                    fertileWindow: null,
                    ovulation: null,
                    currentCycle: null,
                    ishadhahWarning: null
                };

                if (userData.menstruationDates.length === 0) return predictions;

                // Urutkan tanggal menstruasi dengan parsing yang benar
                const sortedDates = userData.menstruationDates.map(dateStr => {
                    const parts = dateStr.split('-');
                    return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
                }).sort((a, b) => a - b);
                const lastPeriod = sortedDates[sortedDates.length - 1];

                // Hitung rata-rata siklus dari 3 siklus terakhir atau default 28 hari
                let avgCycle = 28;
                if (sortedDates.length >= 2) {
                    const cycles = [];
                    for (let i = 1; i < Math.min(4, sortedDates.length); i++) {
                        const cycle = Math.round((sortedDates[i] - sortedDates[i - 1]) / (1000 * 60 * 60 * 24));
                        if (cycle >= 21 && cycle <= 35) cycles.push(cycle);
                    }
                    if (cycles.length > 0) {
                        avgCycle = Math.round(cycles.reduce((a, b) => a + b, 0) / cycles.length);
                    }
                }

                // Prediksi haid berikutnya
                const nextPeriodDate = new Date(lastPeriod);
                nextPeriodDate.setDate(nextPeriodDate.getDate() + avgCycle);
                predictions.nextPeriod = nextPeriodDate;

                // Prediksi ovulasi (14 hari sebelum haid berikutnya)
                const ovulationDate = new Date(nextPeriodDate);
                ovulationDate.setDate(ovulationDate.getDate() - 14);
                predictions.ovulation = ovulationDate;

                // Masa subur (5 hari sebelum dan 1 hari setelah ovulasi)
                const fertileStart = new Date(ovulationDate);
                fertileStart.setDate(fertileStart.getDate() - 5);
                const fertileEnd = new Date(ovulationDate);
                fertileEnd.setDate(fertileEnd.getDate() + 1);
                predictions.fertileWindow = {start: fertileStart, end: fertileEnd};

                // Periksa ishadhah (haid lebih dari 15 hari berturut-turut)
                const today = new Date();
                const daysSinceLastPeriod = Math.floor((today - lastPeriod) / (1000 * 60 * 60 * 24));
                if (daysSinceLastPeriod <= 15) {
                    // Hitung berapa hari berturut-turut mengalami haid
                    let consecutiveDays = 0;
                    const currentDate = new Date(lastPeriod);
                    while (userData.menstruationDates.includes(currentDate.toISOString().split('T')[0])) {
                        consecutiveDays++;
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    if (consecutiveDays > 15) {
                        predictions.ishadhahWarning = consecutiveDays;
                    }
                }

                return predictions;
            };

            // === Fungsi untuk menghitung hutang puasa otomatis ===
            const calculateAutomaticFastingDebt = (userData) => {
                let ramadanDays = 0;
                userData.menstruationDates.forEach(dateStr => {
                    const date = new Date(dateStr);
                    const hijri = toHijri(date);
                    if (hijri.month === 9) { // Bulan Ramadan
                        ramadanDays++;
                    }
                });
                return ramadanDays;
            };

            // === Sistem Kuiz Islam ===
            const getRandomQuestion = async () => {
                state.kuiz.isLoading = true;
                state.kuiz.error = null;
                state.kuiz.showResult = false;
                render();

                try {
                    // Daftar pertanyaan Islam yang sesuai Al-Quran dan Sunnah
                    const islamicQuestions = [
                        {
							"question": "Surah dalam Al-Qur'an yang dikenal sebagai 'Arus Al-Qur'an' (Pengantin Al-Qur'an) karena keindahan bahasanya yang luar biasa adalah Surah?",
							"options": ["Yasin", "Al-Waqi'ah", "Ar-Rahman", "Al-Mulk"],
							"correct": 2,
							"explanation": "Surah **Ar-Rahman** memiliki ritme dan repetisi ayat 'Fabiayyi ala i rabbikuma tukadzdziban' yang sangat indah dan menyentuh hati, menjadikannya salah satu surah dengan gaya bahasa paling memukau."
						},
						{
							"question": "Setiap surah dalam Al-Qur'an diawali dengan 'Bismillahirrahmanirrahim', kecuali satu surah. Surah apakah itu?",
							"options": ["Al-Anfal", "Yunus", "At-Taubah", "Al-Fatihah"],
							"correct": 2,
							"explanation": "Surah **At-Taubah** (atau Bara'ah) tidak diawali dengan Basmalah. Para ulama menjelaskan, ini karena surah tersebut dimulai dengan pernyataan pemutusan perjanjian dan pengumuman perang terhadap kaum musyrikin, yang tidak sesuai dengan sifat kasih sayang dalam Basmalah."
						},
						{
							"question": "Surah yang dinamai berdasarkan nama serangga yang menunjukkan keagungan ciptaan Allah bahkan pada makhluk kecil adalah Surah Al-'Ankabut, yang artinya?",
							"options": ["Lebah", "Semut", "Nyamuk", "Laba-laba"],
							"correct": 3,
							"explanation": "Surah Al-'Ankabut (**Laba-laba**) menggunakan sarang laba-laba sebagai perumpamaan bagi rapuhnya perlindungan selain Allah. Ini adalah metafora yang sangat kuat tentang tauhid."
						},
						{
							"question": "Surah terakhir yang turun secara lengkap kepada Rasulullah Shallallahu 'alaihi wasallam, yang mengisyaratkan dekatnya wafat beliau, adalah Surah?",
							"options": ["Al-Ma'idah", "An-Nasr", "Al-Ikhlas", "Al-'Asr"],
							"correct": 1,
							"explanation": "Surah **An-Nasr** ('Pertolongan') turun setelah Fathu Makkah dan berbicara tentang datangnya pertolongan Allah dan manusia yang berbondong-bondong masuk Islam. Para sahabat seperti Ibnu Abbas memahami ini sebagai isyarat bahwa tugas Nabi telah selesai."
						},
						{
							"question": "Ayat yang paling agung dalam Al-Qur'an adalah Ayat Kursi. Ayat ini terdapat dalam Surah?",
							"options": ["Ali 'Imran", "An-Nisa'", "Al-Baqarah", "Al-Ma'idah"],
							"correct": 2,
							"explanation": "Ayat Kursi adalah ayat ke-255 dari Surah **Al-Baqarah**. Keagungannya terletak pada kandungan isinya yang menjelaskan tentang keesaan, kekuasaan, ilmu, dan kebesaran Allah Subhanahu wa Ta'ala secara paripurna."
						},
						{
							"question": "Allah Subhanahu wa Ta'ala berfirman, 'Sesungguhnya Kamilah yang menurunkan Adz-Dzikr (Al-Qur'an), dan sesungguhnya Kami benar-benar memeliharanya'. Ayat yang menjamin keaslian Al-Qur'an ini terdapat dalam Surah?",
							"options": ["Al-Waqi'ah", "Al-Qiyamah", "Al-Furqan", "Al-Hijr"],
							"correct": 3,
							"explanation": "Ayat ke-9 dari Surah **Al-Hijr** ini adalah jaminan langsung dari Allah bahwa Al-Qur'an akan senantiasa terjaga dari perubahan, penambahan, atau pengurangan, berbeda dengan kitab-kitab suci sebelumnya."
						},
						{
							"question": "Ayat-ayat dalam Al-Qur'an yang menjelaskan tahapan penciptaan manusia dari saripati tanah hingga menjadi makhluk yang sempurna terdapat dalam Surah?",
							"options": ["Al-Mu'minun", "Yasin", "Ar-Rum", "Luqman"],
							"correct": 0,
							"explanation": "Ayat 12-14 dari Surah **Al-Mu'minun** merincikan proses penciptaan manusia dari nutfah, 'alaqah, mudghah, hingga ditiupkannya ruh. Ini adalah salah satu bukti kemukjizatan ilmiah Al-Qur'an."
						},
						{
							"question": "Ayat terpanjang dalam Al-Qur'an (Al-Baqarah: 282) membahas secara sangat rinci tentang?",
							"options": ["Hukum Waris", "Tata Cara Haji", "Hukum Utang-Piutang (Muamalah)", "Kisah para nabi"],
							"correct": 2,
							"explanation": "Ayat ini, yang dikenal sebagai 'Ayat ad-Dayn', menunjukkan betapa pentingnya pencatatan, saksi, dan keadilan dalam urusan **utang-piutang** untuk menghindari perselisihan. Ini adalah dasar dari literasi finansial dalam Islam."
						},
						{
							"question": "Asbabun Nuzul (sebab turunnya) ayat tentang perubahan arah kiblat dari Baitul Maqdis ke Ka'bah adalah?",
							"options": ["Perintah dari kaum Yahudi", "Keinginan dan doa Rasulullah Shallallahu 'alaihi wasallam yang sering menengadah ke langit", "Hasil musyawarah para sahabat", "Kemenangan dalam Perang Badar"],
							"correct": 1,
							"explanation": "Rasulullah Shallallahu 'alaihi wasallam sangat berharap agar kiblat umat Islam adalah Ka'bah, kiblat Nabi Ibrahim. Allah mengabulkan keinginan hati beliau ini dengan menurunkan ayat 144 dari Surah Al-Baqarah."
						},
						{
							"question": "Surah Al-Kafirun, yang diakhiri dengan 'Lakum diinukum wa liya diin' (Untukmu agamamu, dan untukkulah, agamaku), turun sebagai jawaban atas tawaran kaum Quraisy untuk?",
							"options": ["Berperang tanding", "Mengadakan perjanjian damai", "Bertukar sesembahan (kompromi akidah)", "Berbagi kekuasaan di Makkah"],
							"correct": 2,
							"explanation": "Surah ini adalah deklarasi yang tegas dan final. Ia menolak segala bentuk sinkretisme atau kompromi dalam masalah akidah dan penyembahan, sambil tetap mengajarkan toleransi dalam urusan sosial."
						},
						{
							"question": "Ayat tentang Tayammum (bersuci dengan debu) turun saat rombongan kaum muslimin kehabisan air dalam sebuah perjalanan. Peristiwa ini terjadi karena?",
							"options": ["Unta Nabi hilang", "Salah seorang sahabat terluka", "Kalung milik Aisyah r.a. hilang dan dicari", "Waktu shalat hampir habis"],
							"correct": 2,
							"explanation": "Hilangnya kalung Aisyah r.a. membuat rombongan berhenti hingga kehabisan air. Peristiwa ini, meskipun tampak sepele, menjadi sebab turunnya syariat tayamum yang menjadi keringanan besar bagi umat Islam hingga hari ini."
						},
						{
							"question": "Ayat 'Wahai orang-orang beriman, janganlah kamu meninggikan suaramu melebihi suara Nabi...' (Al-Hujurat: 1) turun sebagai teguran karena perdebatan antara?",
							"options": ["Umar dan Ali r.a.", "Abu Bakar dan Umar r.a.", "Utsman dan Ali r.a.", "Thalhah dan Zubair r.a."],
							"correct": 1,
							"explanation": "Saat berdebat tentang penunjukan seorang pemimpin, suara **Abu Bakar dan Umar** r.a. sempat meninggi di hadapan Nabi. Ayat ini turun untuk mengajarkan adab tertinggi kepada Rasulullah Shallallahu 'alaihi wasallam."
						},
						{
							"question": "Kelompok surah-surah dalam Al-Qur'an yang diawali dengan 'Ha Mim' (seperti Ghafir, Fushshilat, Asy-Syura) dikenal dengan sebutan?",
							"options": ["Al-Mufasshal", "Al-Matsani", "Al-Hawamim", "Al-Mu'awwidzat"],
							"correct": 2,
							"explanation": "**Al-Hawamim** adalah sekelompok tujuh surah yang dimulai dengan Huruf Muqatta'at 'Ha Mim'. Surah-surah ini memiliki tema dan gaya bahasa yang mirip."
						},
						{
							"question": "Ayat pembuka dari Surah Al-Mu'minun, 'Qad aflahal mu'minun' (Sesungguhnya beruntunglah orang-orang yang beriman), dilanjutkan dengan menyebutkan ciri-ciri mereka. Ciri pertama adalah?",
							"options": ["Orang yang menunaikan zakat", "Orang yang khusyu' dalam shalatnya", "Orang yang menjaga kemaluannya", "Orang yang menjauhkan diri dari perbuatan sia-sia"],
							"correct": 1,
							"explanation": "Ciri pertama dan utama dari seorang mukmin yang beruntung adalah kekhusyu'an dalam shalatnya. Ini menunjukkan bahwa kualitas shalat adalah tolok ukur utama dari keimanan seseorang."
						},
						{
							"question": "Lima ayat pertama dari surah apakah yang menjadi wahyu pertama yang diterima oleh Nabi Muhammad Shallallahu 'alaihi wasallam?",
							"options": ["Al-Fatihah", "Al-Muddassir", "Al-Qalam", "Al-'Alaq"],
							"correct": 3,
							"explanation": "Wahyu pertama adalah lima ayat dari Surah **Al-'Alaq**, yang dimulai dengan perintah 'Iqra!' (Bacalah!). Peristiwa ini menandai dimulainya kenabian dan risalah Islam."
						},
						{
							"question": "Perbedaan mendasar antara Hadits Qudsi dan Al-Qur'an adalah?",
							"options": ["Hadits Qudsi tidak shahih", "Lafaz Al-Qur'an adalah mukjizat dan membacanya adalah ibadah", "Hadits Qudsi hanya berisi tentang akhlak", "Al-Qur'an diturunkan di Makkah, Hadits Qudsi di Madinah"],
							"correct": 1,
							"explanation": "Meskipun maknanya sama-sama dari Allah, lafaz **Al-Qur'an adalah mukjizat** yang tidak tertandingi, dan setiap huruf yang dibaca bernilai pahala ibadah. Hal ini tidak berlaku bagi Hadits Qudsi."
						},
						{
							"question": "Hadits yang menyatakan bahwa 'Dunia ini adalah penjara bagi orang mukmin dan surga bagi orang kafir' diriwayatkan oleh?",
							"options": ["Umar bin Khattab", "Anas bin Malik", "Abu Hurairah", "Aisyah"],
							"correct": 2,
							"explanation": "Hadits riwayat **Abu Hurairah** ini mengajarkan bahwa seberapa pun nikmatnya dunia bagi seorang mukmin, ia tetaplah 'penjara' jika dibandingkan dengan kenikmatan surga yang menantinya. Sebaliknya, seberapa pun sengsaranya orang kafir, penderitaannya itu adalah 'surga' dibandingkan azab akhirat."
						},
						{
							"question": "Surah yang sangat dianjurkan untuk dibaca agar terhindar dari siksa kubur adalah Surah?",
							"options": ["Al-Waqi'ah", "Ar-Rahman", "Yasin", "Al-Mulk"],
							"correct": 3,
							"explanation": "Rasulullah Shallallahu 'alaihi wasallam tidak akan tidur sebelum membaca Surah As-Sajdah dan Surah **Al-Mulk**. Beliau bersabda bahwa Surah Al-Mulk adalah 'Al-Mani'ah' (sang pencegah) yang akan membela pembacanya di dalam kubur."
						},
						{
							"question": "Lengkapkan hadits ini: 'Barangsiapa yang menunjuki kepada kebaikan, maka ia akan mendapatkan pahala seperti...'",
							"options": ["Pahala orang tuanya", "Pahala puasanya", "Pahala orang yang mengerjakannya", "Pahala hajinya"],
							"correct": 2,
							"explanation": "Hadits ini adalah motivasi besar untuk berdakwah dan mengajarkan ilmu. Setiap kali orang lain mengamalkan ilmu yang kita ajarkan, kita akan terus mendapatkan aliran pahalanya tanpa mengurangi pahala orang tersebut."
						},
						{
							"question": "Istilah 'As-Sab'ul Matsani' (Tujuh Ayat yang Diulang-ulang) adalah nama lain untuk Surah?",
							"options": ["Al-Baqarah", "Yasin", "Al-Ikhlas", "Al-Fatihah"],
							"correct": 3,
							"explanation": "Surah **Al-Fatihah** disebut demikian karena ia terdiri dari tujuh ayat dan selalu diulang-ulang pada setiap rakaat dalam shalat fardhu maupun sunnah."
						},
						{
							"question": "Surah yang mengisahkan tentang pasukan gajah yang hendak menghancurkan Ka'bah adalah Surah?",
							"options": ["Quraisy", "Al-Fil", "Al-Humazah", "Al-Ma'un"],
							"correct": 1,
							"explanation": "Surah **Al-Fil** (Gajah) menceritakan tentang peristiwa ajaib di tahun kelahiran Nabi Muhammad Shallallahu 'alaihi wasallam, di mana Allah menghancurkan pasukan Abrahah dengan mengirimkan burung-burung Ababil."
						},
						{
							"question": "Siapakah nabi pertama yang juga merupakan manusia pertama yang diciptakan oleh Allah Subhanahu wa Ta'ala?",
							"options": ["Nabi Nuh a.s.", "Nabi Idris a.s.", "Nabi Adam a.s.", "Nabi Syits a.s."],
							"correct": 2,
							"explanation": "**Nabi Adam a.s.** adalah bapak seluruh umat manusia ('Abul Basyar'). Allah menciptakannya dari tanah, mengajarkannya nama-nama segala sesuatu, dan menempatkannya di surga sebelum diturunkan ke bumi."
						},
						{
							"question": "Nabi yang mendapat gelar 'Bapak Para Nabi' (Abul Anbiya) karena dari keturunannyalah lahir banyak nabi dan rasul adalah?",
							"options": ["Nabi Adam a.s.", "Nabi Nuh a.s.", "Nabi Ibrahim a.s.", "Nabi Musa a.s."],
							"correct": 2,
							"explanation": "**Nabi Ibrahim a.s.** mendapat gelar ini. Dari putranya, Ismail a.s., lahir Nabi Muhammad Shallallahu 'alaihi wasallam. Dari putranya yang lain, Ishaq a.s., lahir Nabi Ya'qub a.s. (Israil) yang menjadi leluhur para nabi Bani Israil."
						},
						{
							"question": "Mukjizat terbesar Nabi Musa a.s. saat berhadapan dengan Fir'aun adalah tongkatnya yang berubah menjadi ular dan...?",
							"options": ["Membelah bulan", "Menghidupkan orang mati", "Membelah lautan", "Berbicara dengan binatang"],
							"correct": 2,
							"explanation": "Atas izin Allah, **Nabi Musa a.s.** memukulkan tongkatnya ke Laut Merah, yang kemudian terbelah menjadi jalan kering untuk menyelamatkan kaumnya dari kejaran Fir'aun dan tentaranya."
						},
						{
							"question": "Nabi yang memiliki mukjizat bisa berbicara saat masih bayi untuk membela kesucian ibunya adalah?",
							"options": ["Nabi Yahya a.s.", "Nabi Zakaria a.s.", "Nabi Ismail a.s.", "Nabi Isa a.s."],
							"correct": 3,
							"explanation": "Mukjizat pertama **Nabi Isa a.s.** adalah berbicara dari buaian. Beliau berkata, 'Sesungguhnya aku ini hamba Allah, Dia memberiku Al Kitab (Injil) dan Dia menjadikan aku seorang nabi'."
						},
						{
							"question": "Nabi yang dengan sabar berdakwah kepada kaumnya selama 950 tahun namun hanya sedikit yang beriman, lalu Allah memerintahkannya membuat bahtera besar, adalah?",
							"options": ["Nabi Hud a.s.", "Nabi Shalih a.s.", "Nabi Nuh a.s.", "Nabi Luth a.s."],
							"correct": 2,
							"explanation": "Kisah **Nabi Nuh a.s.** adalah pelajaran tentang kesabaran luar biasa dalam berdakwah. Bahtera yang ia bangun menjadi satu-satunya penyelamat dari azab banjir bandang yang menenggelamkan seluruh bumi."
						},
						{
							"question": "Nabi yang Allah anugerahi kerajaan yang megah, mampu berbicara dengan binatang, dan menundukkan angin serta jin adalah?",
							"options": ["Nabi Dawud a.s.", "Nabi Sulaiman a.s.", "Nabi Yusuf a.s.", "Nabi Dzulkarnain"],
							"correct": 1,
							"explanation": "Kerajaan **Nabi Sulaiman a.s.** adalah anugerah istimewa yang tidak diberikan kepada siapapun sesudahnya. Kisahnya dengan Ratu Balqis dan semut adalah salah satu yang paling terkenal."
						},
						{
							"question": "Nabi yang memiliki paras sangat tampan dan diberi kemampuan untuk menafsirkan mimpi, namun diuji dengan kedengkian saudara-saudaranya, adalah?",
							"options": ["Nabi Ismail a.s.", "Nabi Ishaq a.s.", "Nabi Yusuf a.s.", "Nabi Syu'aib a.s."],
							"correct": 2,
							"explanation": "Kisah **Nabi Yusuf a.s.** dalam Al-Qur'an (Surat Yusuf) disebut sebagai 'Ahsanul Qasas' (kisah yang terbaik) karena penuh dengan pelajaran tentang kesabaran, memaafkan, dan hikmah di balik setiap ujian."
						},
						{
							"question": "Nabi yang diutus kepada kaum Tsamud dan mukjizatnya adalah seekor unta betina yang keluar dari batu adalah?",
							"options": ["Nabi Hud a.s.", "Nabi Luth a.s.", "Nabi Syu'aib a.s.", "Nabi Shalih a.s."],
							"correct": 3,
							"explanation": "**Nabi Shalih a.s.** memberikan unta tersebut sebagai bukti kenabiannya. Namun, kaumnya justru membunuh unta itu, sehingga Allah menimpakan azab yang membinasakan mereka."
						},
						{
							"question": "Nabi yang diutus kepada kaum 'Ad yang terkenal dengan kekuatan fisik dan bangunan-bangunan tingginya, namun mereka sombong, adalah?",
							"options": ["Nabi Shalih a.s.", "Nabi Hud a.s.", "Nabi Nuh a.s.", "Nabi Ibrahim a.s."],
							"correct": 1,
							"explanation": "**Nabi Hud a.s.** mengajak kaum 'Ad untuk menyembah Allah, namun mereka menolak. Akhirnya, Allah mengirimkan azab berupa angin topan yang sangat dingin (sharshar) selama delapan hari tujuh malam."
						},
						{
							"question": "Nabi yang pernah ditelan oleh ikan besar karena meninggalkan kaumnya sebelum mendapat izin Allah adalah?",
							"options": ["Nabi Ilyas a.s.", "Nabi Ayyub a.s.", "Nabi Yunus a.s.", "Nabi Zakaria a.s."],
							"correct": 2,
							"explanation": "Di dalam perut ikan, **Nabi Yunus a.s.** (juga bergelar Dzun Nun) bertaubat dengan tulus. Doa beliau, 'La ilaha illa anta subhanaka inni kuntu minaz zalimin', diabadikan dalam Al-Qur'an."
						},
						{
							"question": "Nabi yang dikenal karena kesabarannya yang luar biasa saat diuji dengan penyakit parah, kehilangan harta, dan wafatnya semua anaknya adalah?",
							"options": ["Nabi Ya'qub a.s.", "Nabi Ayyub a.s.", "Nabi Zakaria a.s.", "Nabi Syu'aib a.s."],
							"correct": 1,
							"explanation": "Kesabaran **Nabi Ayyub a.s.** menjadi teladan abadi. Setelah melewati ujian yang sangat berat, Allah menyembuhkannya dan mengembalikan kepadanya keluarga serta harta yang lebih banyak."
						},
						{
							"question": "Nabi yang diutus kepada kaum Madyan yang curang dalam takaran dan timbangan adalah?",
							"options": ["Nabi Luth a.s.", "Nabi Shalih a.s.", "Nabi Hud a.s.", "Nabi Syu'aib a.s."],
							"correct": 3,
							"explanation": "**Nabi Syu'aib a.s.** dikenal sebagai 'Khatibul Anbiya' (juru bicara para nabi) karena kefasihannya dalam berdakwah. Beliau mengajak kaumnya untuk berlaku adil dalam perniagaan."
						},
						{
							"question": "Nabi yang diutus untuk berdakwah kepada kaum Sodom yang melakukan perbuatan homoseksual adalah?",
							"options": ["Nabi Ibrahim a.s.", "Nabi Luth a.s.", "Nabi Ismail a.s.", "Nabi Ishaq a.s."],
							"correct": 1,
							"explanation": "**Nabi Luth a.s.** adalah keponakan dari Nabi Ibrahim a.s. Kaumnya yang menolak untuk bertaubat dari perbuatan keji tersebut akhirnya dibinasakan oleh Allah dengan hujan batu dan buminya dibalikkan."
						},
						{
							"question": "Nabi yang Allah anugerahi suara yang sangat merdu dan kemampuan untuk melunakkan besi dengan tangannya adalah?",
							"options": ["Nabi Sulaiman a.s.", "Nabi Dawud a.s.", "Nabi Harun a.s.", "Nabi Zakaria a.s."],
							"correct": 1,
							"explanation": "**Nabi Dawud a.s.** membaca kitab Zabur dengan suara yang begitu merdu hingga gunung-gunung dan burung-burung pun ikut bertasbih bersamanya. Beliau juga seorang pandai besi yang ahli membuat baju zirah."
						},
						{
							"question": "Nabi yang Allah karuniai seorang anak di usianya yang sudah sangat senja, sebagai jawaban atas doanya yang tak pernah putus, adalah?",
							"options": ["Nabi Ibrahim a.s.", "Nabi Imran", "Nabi Zakaria a.s.", "Nabi Syu'aib a.s."],
							"correct": 2,
							"explanation": "**Nabi Zakaria a.s.** terus berdoa memohon keturunan. Allah pun mengabulkan doanya dan memberinya seorang putra yang shalih, yaitu Nabi Yahya a.s."
						},
						{
							"question": "Anak dari Nabi Zakaria a.s. yang juga seorang nabi dan dikenal karena ketegasannya dalam menegakkan syariat adalah?",
							"options": ["Nabi Isa a.s.", "Nabi Ilyasa' a.s.", "Nabi Dzulkifli a.s.", "Nabi Yahya a.s."],
							"correct": 3,
							"explanation": "**Nabi Yahya a.s.** adalah sepupu dari Nabi Isa a.s. Beliau dikenal sangat zuhud dan tidak takut untuk menyampaikan kebenaran bahkan di hadapan penguasa yang zalim."
						},
						{
							"question": "Gelar 'Ulul Azmi' diberikan kepada para nabi dan rasul yang memiliki keteguhan hati luar biasa. Siapakah lima nabi yang termasuk di dalamnya?",
							"options": ["Adam, Idris, Ibrahim, Musa, Isa", "Nuh, Ibrahim, Musa, Isa, Muhammad", "Ibrahim, Ismail, Ishaq, Ya'qub, Yusuf", "Adam, Nuh, Dawud, Sulaiman, Muhammad"],
							"correct": 1,
							"explanation": "Lima rasul **Ulul Azmi** adalah: Nabi Nuh, Nabi Ibrahim, Nabi Musa, Nabi Isa, dan Nabi Muhammad (shallallahu 'alaihim wa sallam). Mereka menghadapi ujian dakwah yang paling berat dengan kesabaran yang tiada tanding."
						},
						{
							"question": "Nabi yang pertama kali mengajarkan manusia tentang tulisan, jahitan, dan ilmu perbintangan (astronomi) adalah?",
							"options": ["Nabi Adam a.s.", "Nabi Syits a.s.", "Nabi Idris a.s.", "Nabi Nuh a.s."],
							"correct": 2,
							"explanation": "**Nabi Idris a.s.** dikenal sebagai nabi yang sangat cerdas. Allah mengangkatnya ke martabat yang tinggi, dan beliau adalah nabi pertama yang menerima wahyu melalui tulisan (suhuf)."
						},
						{
							"question": "Nabi yang dengan tulus ikhlas siap untuk dikorbankan oleh ayahnya sebagai bentuk ketaatan mutlak kepada Allah adalah?",
							"options": ["Nabi Ishaq a.s.", "Nabi Ismail a.s.", "Nabi Ya'qub a.s.", "Nabi Yusuf a.s."],
							"correct": 1,
							"explanation": "Ketabahan dan keikhlasan **Nabi Ismail a.s.** saat akan disembelih oleh ayahnya, Nabi Ibrahim, menjadi dasar dari ibadah kurban (Udhiyah) yang kita laksanakan setiap Idul Adha."
						},
						{
							"question": "Nabi yang diutus untuk mendampingi dan membantu saudaranya, Nabi Musa a.s., dalam berdakwah kepada Fir'aun karena kefasihan lisannya adalah?",
							"options": ["Nabi Syu'aib a.s.", "Nabi Khidir a.s.", "Nabi Harun a.s.", "Nabi Dzulkifli a.s."],
							"correct": 2,
							"explanation": "Nabi Musa a.s. berdoa kepada Allah agar saudaranya, **Nabi Harun a.s.**, diangkat menjadi nabi untuk membantunya, karena Harun lebih fasih berbicara. Doa ini dikabulkan oleh Allah."
						},
						{
							"question": "Siapakah nama putra Nabi Nuh a.s. yang menolak ajakan ayahnya untuk naik ke bahtera dan akhirnya ikut tenggelam bersama kaum yang kafir?",
							"options": ["Sam", "Ham", "Yafits", "Kan'an"],
							"correct": 3,
							"explanation": "**Kan'an** lebih memilih untuk berlindung di puncak gunung, mengandalkan logikanya sendiri daripada wahyu Allah. Kisahnya menjadi pelajaran bahwa ikatan darah tidak menjamin keselamatan jika tidak didasari oleh ikatan iman."
						},
						{
							"question": "Siapakah sahabat yang termasuk dalam sepuluh yang dijamin masuk surga dan doanya sangat mustajab karena didoakan secara khusus oleh Rasulullah Shallallahu 'alaihi wasallam?",
							"options": ["Zubair bin Awwam", "Thalhah bin Ubaidillah", "Sa'ad bin Abi Waqqas", "Abdurrahman bin Auf"],
							"correct": 2,
							"explanation": "**Sa'ad bin Abi Waqqas** r.a. didoakan oleh Nabi, 'Ya Allah, kabulkanlah doanya jika ia berdoa'. Beliau juga adalah panglima perang yang menaklukkan Persia dalam Pertempuran Al-Qadisiyyah."
						},
						{
							"question": "Gelar 'Saifullah Al-Maslul' (Pedang Allah yang Terhunus) diberikan oleh Rasulullah Shallallahu 'alaihi wasallam kepada panglima perang legendaris?",
							"options": ["Amr bin Al-'Ash", "Abu Ubaidah bin Jarrah", "Khalid bin Walid", "Ali bin Abi Thalib"],
							"correct": 2,
							"explanation": "**Khalid bin Walid** r.a. adalah seorang jenius militer yang tidak pernah kalah dalam pertempuran. Gelar ini diberikan setelah kepahlawanannya dalam Perang Mu'tah."
						},
						{
							"question": "Sahabat yang menjadi muadzin pertama dalam Islam dan menunjukkan keteguhan iman yang luar biasa saat disiksa oleh tuannya adalah?",
							"options": ["Abdullah bin Mas'ud", "Zaid bin Haritsah", "Salman Al-Farisi", "Bilal bin Rabah"],
							"correct": 3,
							"explanation": "**Bilal bin Rabah** r.a. adalah simbol dari kekuatan tauhid yang mengalahkan penindasan. Batu besar yang ditimpakan di dadanya hanya mampu dibalas dengan ucapan 'Ahad... Ahad...' (Esa... Esa...)."
						},
						{
							"question": "Ketika dipersaudarakan dengan Sa'ad bin Ar-Rabi' yang menawarkan separuh hartanya, sahabat Muhajirin ini menolak dengan halus dan hanya bertanya, 'Tunjukkan padaku di mana letak pasar?'. Siapakah beliau?",
							"options": ["Utsman bin Affan", "Abdurrahman bin Auf", "Thalhah bin Ubaidillah", "Zubair bin Awwam"],
							"correct": 1,
							"explanation": "Kisah **Abdurrahman bin Auf** r.a. ini menunjukkan kemuliaan, kehormatan diri, dan keahliannya dalam berdagang. Dengan modal yang sedikit, beliau segera menjadi salah satu sahabat terkaya dan paling dermawan di Madinah."
						},
						{
							"question": "Gelar 'Amin Hadzihi al-Ummah' (Orang Kepercayaan Umat Ini) diberikan oleh Rasulullah Shallallahu 'alaihi wasallam kepada sahabat?",
							"options": ["Abu Bakar Ash-Shiddiq", "Umar bin Khattab", "Abu Ubaidah bin Al-Jarrah", "Mu'adz bin Jabal"],
							"correct": 2,
							"explanation": "**Abu Ubaidah bin Al-Jarrah** r.a. adalah salah satu dari sepuluh yang dijamin masuk surga. Sifat amanahnya yang luar biasa membuatnya sangat dipercaya oleh Nabi dan para khalifah setelahnya."
						},
						{
							"question": "Istri pertama Rasulullah Shallallahu 'alaihi wasallam yang juga merupakan orang pertama yang beriman kepada risalah beliau dan mendukung dakwah dengan seluruh jiwa dan hartanya adalah?",
							"options": ["Aisyah binti Abu Bakar", "Hafshah binti Umar", "Khadijah binti Khuwailid", "Ummu Salamah"],
							"correct": 2,
							"explanation": "**Khadijah** r.a. bergelar 'At-Thahirah' (Wanita Suci). Dukungannya yang total di masa-masa tersulit menjadi penopang utama bagi Rasulullah Shallallahu 'alaihi wasallam. Nabi selalu mengenangnya bahkan setelah ia wafat."
						},
						{
							"question": "Gelar 'Az-Zahra' (Yang Bercahaya) dan 'Al-Batul' (Yang Memutuskan Diri untuk Beribadah) adalah gelar untuk putri kesayangan Nabi Muhammad Shallallahu 'alaihi wasallam, yaitu?",
							"options": ["Zainab", "Ruqayyah", "Ummu Kultsum", "Fatimah"],
							"correct": 3,
							"explanation": "**Fatimah Az-Zahra** r.a. adalah ibu dari Hasan dan Husain. Rasulullah Shallallahu 'alaihi wasallam menyebutnya sebagai 'Sayyidatu Nisa' Ahlil Jannah' (Pemimpin para wanita penghuni surga)."
						},
						{
							"question": "Wanita pertama yang mati syahid (syahidah) dalam sejarah Islam karena mempertahankan keimanannya dari siksaan Abu Jahal adalah?",
							"options": ["Khadijah binti Khuwailid", "Fatimah binti Khattab", "Sumayyah binti Khabbat", "Nusaibah binti Ka'ab"],
							"correct": 2,
							"explanation": "**Sumayyah** r.a., ibu dari Ammar bin Yasir, menjadi simbol keteguhan akidah yang luar biasa. Beliau dan keluarganya disiksa dengan kejam, namun mereka tetap sabar hingga meraih kesyahidan."
						},
						{
							"question": "Gelar 'Al-Humaira' (Yang Pipinya Kemerah-merahan) adalah panggilan sayang dari Rasulullah Shallallahu 'alaihi wasallam kepada istrinya yang cerdas dan menjadi sumber rujukan ilmu, yaitu?",
							"options": ["Hafshah", "Zainab", "Aisyah", "Saudah"],
							"correct": 2,
							"explanation": "**Aisyah** r.a. adalah istri yang paling banyak meriwayatkan hadits dari Nabi. Kecerdasan dan pemahamannya yang mendalam menjadikannya seorang faqihah (ahli fiqih) terkemuka."
						},
						{
							"question": "Pendiri mazhab fiqih yang dikenal dengan penekanannya pada 'Amal Ahlil Madinah (praktik penduduk Madinah) dan penulis kitab hadits Al-Muwatta' adalah Imam?",
							"options": ["Abu Hanifah", "Malik bin Anas", "Asy-Syafi'i", "Ahmad bin Hanbal"],
							"correct": 1,
							"explanation": "**Imam Malik** adalah ulama besar dari kota Madinah. Beliau berpendapat bahwa praktik turun-temurun penduduk Madinah adalah cerminan sunnah yang hidup, sehingga menjadi salah satu dasar hukum dalam mazhabnya."
						},
						{
							"question": "Ulama besar yang dikenal sebagai peletak dasar-dasar Ilmu Ushul Fiqih (metodologi hukum Islam) melalui karyanya 'Ar-Risalah' adalah Imam?",
							"options": ["Abu Hanifah", "Malik", "Asy-Syafi'i", "Ahmad"],
							"correct": 2,
							"explanation": "**Imam Asy-Syafi'i** adalah seorang mujtahid mutlak yang jenius. Beliau berhasil merumuskan kaidah-kaidah pengambilan hukum dari Al-Qur'an dan Sunnah secara sistematis, yang menjadi fondasi bagi ilmu fiqih modern."
						},
						{
							"question": "Imam mazhab yang diuji dengan siksaan berat pada masa Khalifah Al-Ma'mun karena menolak mengakui bahwa Al-Qur'an adalah makhluk (Mihnah) adalah Imam?",
							"options": ["Asy-Syafi'i", "Ahmad bin Hanbal", "Abu Hanifah", "Malik"],
							"correct": 1,
							"explanation": "**Imam Ahmad** menunjukkan keteguhan yang luar biasa dalam mempertahankan akidah Ahlus Sunnah bahwa Al-Qur'an adalah Kalamullah (firman Allah), bukan makhluk. Ketegarannya berhasil menyelamatkan akidah umat."
						},
						{
							"question": "Kitab hadits yang dianggap sebagai kitab paling shahih setelah Al-Qur'an adalah Shahih Bukhari. Siapakah nama lengkap dari Imam Al-Bukhari?",
							"options": ["Muslim bin Hajjaj", "Muhammad bin Ismail", "Ahmad bin Hanbal", "Muhammad bin Idris Asy-Syafi'i"],
							"correct": 1,
							"explanation": "Nama lengkap beliau adalah **Muhammad bin Ismail Al-Bukhari**. Beliau dikenal karena metodologinya yang sangat ketat dalam menyeleksi hadits, di mana ia mensyaratkan pertemuan langsung antara perawi dengan gurunya."
						},
						{
							"question": "Ilmuwan Muslim yang dikenal sebagai 'Bapak Aljabar' dan namanya diabadikan dalam istilah 'algoritma' adalah?",
							"options": ["Ibnu Sina", "Al-Biruni", "Jabir bin Hayyan", "Al-Khawarizmi"],
							"correct": 3,
							"explanation": "**Muhammad bin Musa Al-Khawarizmi** adalah seorang matematikawan jenius dari Baitul Hikmah di Baghdad. Karyanya menjadi fondasi bagi perkembangan matematika dan ilmu komputer modern."
						},
						{
							"question": "Sahabat yang mendapat gelar 'Hawari Rasulillah' (Penolong Setia Rasulullah) adalah?",
							"options": ["Thalhah bin Ubaidillah", "Zubair bin Awwam", "Sa'ad bin Abi Waqqas", "Sa'id bin Zaid"],
							"correct": 1,
							"explanation": "**Zubair bin Awwam** r.a., yang juga merupakan sepupu Nabi, mendapatkan gelar ini karena keberanian dan kesigapannya dalam membela Rasulullah Shallallahu 'alaihi wasallam, terutama saat Perang Khandaq."
						},
						{
							"question": "Gelar 'Dzatun Nithaqain' (Pemilik Dua Ikat Pinggang) diberikan kepada Asma' binti Abu Bakar karena jasanya saat peristiwa?",
							"options": ["Perang Uhud", "Perjanjian Hudaibiyah", "Hijrah Nabi ke Madinah", "Fathu Makkah"],
							"correct": 2,
							"explanation": "Saat **hijrah**, Asma' r.a. dengan cerdik menyobek ikat pinggangnya menjadi dua untuk mengikat bekal makanan bagi Nabi dan ayahnya, Abu Bakar, yang bersembunyi di Gua Tsur. Ini adalah simbol pengorbanan dan kecerdasan."
						},
						{
							"question": "Imam mazhab fiqih yang tertua dan dikenal banyak menggunakan Qiyas (analogi) dan Istihsan (pertimbangan kebaikan) dalam ijtihadnya adalah?",
							"options": ["Imam Malik", "Imam Asy-Syafi'i", "Imam Ahmad", "Imam Abu Hanifah"],
							"correct": 3,
							"explanation": "**Imam Abu Hanifah** yang berasal dari Kufah, Irak, mendirikan mazhab yang sangat rasional dan banyak digunakan di wilayah Turki, Asia Tengah, dan anak benua India."
						},
						{
							"question": "Sahabat Nabi yang pertama kali secara terang-terangan membacakan Al-Qur'an di hadapan para pembesar Quraisy di dekat Ka'bah adalah?",
							"options": ["Abu Bakar Ash-Shiddiq", "Umar bin Khattab", "Bilal bin Rabah", "Abdullah bin Mas'ud"],
							"correct": 3,
							"explanation": "Meskipun bertubuh kecil, **Abdullah bin Mas'ud** r.a. memiliki keberanian yang luar biasa. Beliau dengan lantang membacakan Surat Ar-Rahman hingga disiksa oleh kaum Quraisy. Beliau juga dikenal sebagai sahabat yang paling paham tentang Al-Qur'an."
						},
						{
							"question": "Istri Nabi yang dikenal sangat bijaksana, di mana nasihatnya berhasil menyelesaikan kebuntuan saat para sahabat enggan bertahallul pada Perjanjian Hudaibiyah adalah?",
							"options": ["Aisyah", "Hafshah", "Ummu Salamah", "Zainab binti Jahsy"],
							"correct": 2,
							"explanation": "**Ummu Salamah** r.a. menyarankan Nabi untuk memulai tahallul (mencukur rambut) terlebih dahulu. Saat melihat Nabi melakukannya, para sahabat pun serentak mengikuti. Ini menunjukkan peran penting seorang istri yang cerdas."
						},
						{
							"question": "Siapakah nama lengkap dari Imam Muslim, penulis kitab Shahih Muslim?",
							"options": ["Muhammad bin Ismail Al-Bukhari", "Muslim bin Al-Hajjaj", "Ahmad bin Syu'aib An-Nasa'i", "Abu Dawud As-Sijistani"],
							"correct": 1,
							"explanation": "Nama lengkapnya adalah **Muslim bin Al-Hajjaj An-Naisaburi**. Beliau adalah murid terkemuka dari Imam Bukhari. Kitab Shahih-nya memiliki keistimewaan dalam sistematika penyusunan bab yang sangat rapi."
						},
						{
							"question": "Sahabat yang berasal dari Persia dan menempuh perjalanan sangat panjang untuk mencari kebenaran hingga akhirnya bertemu dengan Nabi Muhammad Shallallahu 'alaihi wasallam di Madinah adalah?",
							"options": ["Bilal bin Rabah", "Suhayb Ar-Rumi", "Salman Al-Farisi", "Abdullah bin Salam"],
							"correct": 2,
							"explanation": "Perjalanan spiritual **Salman Al-Farisi** sangat inspiratif. Ia melewati berbagai agama dan guru sebelum akhirnya menemukan petunjuk tentang nabi terakhir. Beliaulah yang mengusulkan strategi parit dalam Perang Khandaq."
						},
						{
							"question": "Sifat selalu berkata dan berbuat sesuai dengan kenyataan, serta selaras antara hati, ucapan, dan perbuatan disebut?",
							"options": ["Amanah", "Sabar", "Jujur (Shiddiq)", "Syukur"],
							"correct": 2,
							"explanation": "**Jujur (Shiddiq)** adalah induk dari akhlak-akhlak terpuji. Rasulullah Shallallahu 'alaihi wasallam bersabda bahwa kejujuran akan menuntun kepada kebaikan, dan kebaikan akan menuntun ke surga."
						},
						{
							"question": "Menunaikan titipan, menjaga rahasia, dan melaksanakan tugas dengan sebaik-baiknya adalah wujud dari sifat?",
							"options": ["Amanah", "Syukur", "Ikhlas", "Tawadhu'"],
							"correct": 0,
							"explanation": "**Amanah** (dapat dipercaya) adalah salah satu tanda keimanan seseorang. Rasulullah Shallallahu 'alaihi wasallam bersabda, 'Tidak ada iman bagi orang yang tidak memiliki amanah'."
						},
						{
							"question": "Kesabaran dalam menahan diri dari melakukan perbuatan maksiat adalah salah satu dari tiga tingkatan sabar. Tingkatan ini disebut?",
							"options": ["Sabar dalam ketaatan", "Sabar dalam menghadapi musibah", "Sabar dari kemaksiatan", "Sabar dalam bekerja"],
							"correct": 2,
							"explanation": "Sabar memiliki tiga tingkatan: (0) Sabar dalam menjalankan ketaatan, (1) **Sabar dalam menjauhi kemaksiatan**, dan (2) Sabar saat ditimpa musibah. Tingkatan kedua ini seringkali lebih berat karena melawan hawa nafsu."
						},
						{
							"question": "Mengakui nikmat dalam hati, mengucapkannya dengan lisan (dengan memuji Allah), dan menggunakan nikmat tersebut untuk ketaatan adalah cara mengamalkan sifat?",
							"options": ["Sabar", "Syukur", "Qana'ah", "Jujur"],
							"correct": 1,
							"explanation": "Hakikat **syukur** mencakup tiga hal ini. Jika salah satunya tidak ada, maka syukurnya belum sempurna. Lawan dari syukur adalah kufur nikmat."
						},
						{
							"question": "Sikap tidak merendahkan orang lain dan tidak merasa diri lebih hebat, meskipun memiliki kelebihan ilmu, harta, atau jabatan, disebut?",
							"options": ["Takabur (Sombong)", "Ujub (Kagum pada diri sendiri)", "Rendah Hati (Tawadhu')", "Riya' (Pamer)"],
							"correct": 2,
							"explanation": "**Tawadhu'** adalah akhlak mulia yang membuat seseorang diangkat derajatnya oleh Allah. Rasulullah bersabda, 'Tidak akan berkurang harta karena sedekah, dan Allah tidak akan menambah seorang hamba karena memaafkan kecuali kemuliaan, dan tidaklah seseorang merendahkan hati karena Allah melainkan Allah akan mengangkatnya'."
						},
						{
							"question": "Menurut hadits, definisi dari kesombongan (Al-Kibr) adalah 'menolak kebenaran dan...'",
							"options": ["Berbicara kasar", "Menyakiti tetangga", "Merendahkan orang lain", "Tidak mau bersedekah"],
							"correct": 2,
							"explanation": "Rasulullah Shallallahu 'alaihi wasallam mendefinisikan sombong dengan sangat jelas: 'batharul haq wa ghamthun naas', yaitu menolak kebenaran (karena gengsi) dan **meremehkan orang lain**. Ini adalah penyakit hati yang sangat berbahaya."
						},
						{
							"question": "Perasaan tidak suka terhadap nikmat yang didapat oleh orang lain dan berharap nikmat tersebut hilang darinya disebut?",
							"options": ["Ghibthah", "Hasad (Dengki)", "Ghibah", "Namimah"],
							"correct": 1,
							"explanation": "**Hasad** adalah penyakit yang 'memakan' kebaikan sebagaimana api memakan kayu bakar. Ini berbeda dengan Ghibthah, yaitu keinginan untuk memiliki nikmat yang sama tanpa berharap nikmat itu hilang dari orang lain, dan ini diperbolehkan dalam hal kebaikan."
						},
						{
							"question": "Menyebutkan keburukan saudaramu di belakangnya yang ia tidak sukai, meskipun hal itu benar adanya, adalah definisi dari?",
							"options": ["Fitnah (Buhtan)", "Dusta (Kadzib)", "Ghibah (Menggunjing)", "Namimah (Adu Domba)"],
							"correct": 2,
							"explanation": "Inilah definisi **Ghibah** dari Rasulullah Shallallahu 'alaihi wasallam. Jika yang dibicarakan tidak benar, maka itu menjadi Fitnah (Buhtan), yang dosanya lebih besar lagi. Al-Qur'an mengumpamakan ghibah seperti memakan bangkai saudaranya sendiri."
						},
						{
							"question": "Perbuatan mengadu domba, yaitu memindahkan perkataan seseorang kepada orang lain dengan tujuan untuk merusak hubungan di antara mereka, disebut?",
							"options": ["Ghibah", "Hasad", "Namimah", "Riya'"],
							"correct": 2,
							"explanation": "**Namimah** adalah salah satu dosa besar. Rasulullah Shallallahu 'alaihi wasallam bersabda, 'Tidak akan masuk surga orang yang suka mengadu domba (qattat)'."
						},
						{
							"question": "Amalan yang dilakukan bukan karena Allah, melainkan untuk mendapatkan pujian atau dilihat oleh manusia, disebut?",
							"options": ["Ikhlas", "Sum'ah (ingin didengar)", "Riya' (ingin dilihat)", "Ujub"],
							"correct": 2,
							"explanation": "**Riya'** disebut juga sebagai syirik kecil (syirkul asghar) karena ia memalingkan tujuan ibadah dari Allah kepada selain-Nya. Perbuatan ini dapat menghapuskan pahala amal."
						},
						{
							"question": "Adab pertama dan utama sebelum mulai makan dan minum adalah?",
							"options": ["Mencuci tangan", "Membaca 'Bismillah'", "Mencicipi sedikit", "Duduk dengan tegak"],
							"correct": 1,
							"explanation": "Rasulullah Shallallahu 'alaihi wasallam mengajarkan untuk menyebut nama Allah sebelum makan. Beliau bersabda bahwa jika seseorang lupa, hendaknya ia membaca 'Bismillahi awwalahu wa akhirahu'."
						},
						{
							"question": "Posisi tidur yang dianjurkan oleh Rasulullah Shallallahu 'alaihi wasallam adalah berbaring miring ke sebelah?",
							"options": ["Kanan", "Kiri", "Terlentang", "Tengkurap"],
							"correct": 0,
							"explanation": "Tidur miring ke sebelah **kanan** adalah sunnah yang menyehatkan, karena posisi ini meringankan beban jantung dan memudahkan proses pencernaan. Tidur tengkurap adalah posisi yang dibenci Allah."
						},
						{
							"question": "Bagi laki-laki, memakai pakaian yang panjangnya melebihi mata kaki karena sombong disebut Isbal. Hukumnya adalah?",
							"options": ["Sunnah", "Mubah", "Makruh", "Haram"],
							"correct": 3,
							"explanation": "**Isbal** adalah perbuatan yang dilarang keras, dengan ancaman tidak akan dilihat oleh Allah di hari kiamat. Larangan ini berlaku untuk celana, sarung, maupun jubah."
						},
						{
							"question": "Adab bertamu menuntut kita untuk meminta izin masuk sebanyak maksimal...?",
							"options": ["Satu kali", "Dua kali", "Tiga kali", "Empat kali"],
							"correct": 2,
							"explanation": "Minta izinlah sebanyak tiga kali. Jika tidak ada jawaban, maka hendaknya pulang. Ini adalah adab yang diajarkan Al-Qur'an untuk menjaga privasi dan kehormatan pemilik rumah."
						},
						{
							"question": "Amalan pertama yang disunnahkan untuk dilakukan saat memasuki masjid dan sebelum duduk adalah?",
							"options": ["Berwudhu", "Membaca Al-Qur'an", "Shalat sunnah Tahiyatul Masjid", "Berzikir"],
							"correct": 2,
							"explanation": "Rasulullah Shallallahu 'alaihi wasallam bersabda, 'Jika salah seorang dari kalian masuk masjid, maka janganlah ia duduk sebelum shalat dua rakaat'. Ini adalah bentuk penghormatan kepada 'rumah Allah'."
						},
						{
							"question": "Rasulullah Shallallahu 'alaihi wasallam bersabda, 'Barangsiapa beriman kepada Allah dan hari akhir, maka hendaklah ia berkata baik atau...'?",
							"options": ["Diam", "Pergi", "Berdebat", "Menulis"],
							"correct": 0,
							"explanation": "Hadits ini adalah kaidah emas dalam menjaga lisan. Jika perkataan kita tidak mengandung kebaikan, maka **diam** adalah pilihan yang lebih selamat dan lebih baik daripada berbicara sia-sia atau menyakiti orang lain."
						},
						{
							"question": "Menyingkirkan gangguan dari jalanan, seperti duri, paku, atau batu, adalah bagian dari iman. Amalan ini disebut?",
							"options": ["Jihad fi sabilillah", "Shadaqah", "Imathatul adza 'anith thariq", "Amal jariyah"],
							"correct": 2,
							"explanation": "**Imathatul adza 'anith thariq** adalah cabang keimanan yang paling rendah namun tetap bernilai besar. Ini menunjukkan bahwa Islam adalah agama yang sangat peduli pada kemaslahatan dan keamanan publik."
						},
						{
							"question": "Perasaan kagum terhadap diri sendiri dan amalannya tanpa menyandarkannya kepada Allah disebut?",
							"options": ["Takabur", "Riya'", "Ujub", "Ghurur (tertipu)"],
							"correct": 2,
							"explanation": "**Ujub** adalah penyakit hati yang berbahaya karena dapat membuat seseorang merasa amalnya sudah banyak dan meremehkan dosa. Ujub bisa menjadi pintu masuk menuju kesombongan (takabur)."
						},
						{
							"question": "Orang yang paling kuat menurut Rasulullah Shallallahu 'alaihi wasallam adalah orang yang mampu?",
							"options": ["Mengalahkan pegulat", "Mengangkat beban berat", "Mengendalikan dirinya ketika marah", "Berlari paling cepat"],
							"correct": 2,
							"explanation": "Kekuatan sejati bukanlah kekuatan fisik, melainkan kekuatan jiwa dalam **mengendalikan hawa nafsu amarah**. Meredam amarah adalah ciri orang bertakwa yang dijanjikan surga."
						},
						{
							"question": "Adab yang benar ketika menguap adalah?",
							"options": ["Membukanya lebar-lebar", "Mengeluarkan suara keras", "Menahannya sebisa mungkin dan menutup mulut dengan tangan", "Menghadap ke arah kiblat"],
							"correct": 2,
							"explanation": "Rasulullah Shallallahu 'alaihi wasallam mengajarkan untuk **menahan menguap** semampunya, karena menguap berasal dari setan. Jika tidak mampu menahannya, maka hendaknya mulut ditutup dengan tangan."
						},
						{
							"question": "Sikap selalu berprasangka baik, terutama kepada Allah dan juga kepada sesama muslim, disebut?",
							"options": ["Su'uzhon (prasangka buruk)", "Tajasus (mencari-cari kesalahan)", "Ghibah", "Husnudzon (prasangka baik)"],
							"correct": 3,
							"explanation": "**Husnudzon** adalah pangkal ketenangan jiwa. Berprasangka baik kepada Allah akan membuat kita ridha pada takdir-Nya, dan berprasangka baik kepada sesama akan menjaga keutuhan ukhuwah."
						},
						{
							"question": "Salah satu rukun wudhu yang sering terlupakan adalah 'tertib', yang berarti?",
							"options": ["Membasuh setiap anggota tiga kali", "Menggunakan air yang banyak", "Mendahulukan yang kanan", "Melakukan basuhan secara berurutan sesuai tuntunan"],
							"correct": 3,
							"explanation": "Tertib adalah rukun wudhu keenam (dalam mazhab Syafi'i). Artinya, wudhu harus dilakukan secara berurutan: dimulai dari niat, membasuh wajah, tangan, mengusap kepala, hingga membasuh kaki. Meninggalkannya membuat wudhu tidak sah."
						},
						{
							"question": "Bersuci menggunakan debu yang suci sebagai pengganti wudhu atau mandi wajib saat tidak ada air atau berhalangan menggunakannya disebut?",
							"options": ["Istinja'", "Istijmar", "Tayamum", "Ghusl"],
							"correct": 2,
							"explanation": "Tayamum adalah keringanan (rukhsah) dari Allah. Rukunnya adalah niat, mengusap wajah, dan mengusap kedua tangan dengan debu yang suci."
						},
						{
							"question": "Air liur anjing dan babi dikategorikan sebagai najis berat. Najis ini disebut Najis?",
							"options": ["Mukhaffafah (Ringan)", "Mutawassithah (Pertengahan)", "Mughallazhah (Berat)", "'Ainiyah (Terlihat)"],
							"correct": 2,
							"explanation": "Najis Mughallazhah memiliki tata cara penyucian khusus, yaitu dibasuh sebanyak tujuh kali, di mana salah satu basuhannya dicampur dengan tanah yang suci."
						},
						{
							"question": "Seseorang yang telah selesai berwudhu kemudian tertidur pulas dalam posisi berbaring hingga tidak sadar, maka hukum wudhunya adalah?",
							"options": ["Tetap sah", "Makruh", "Batal", "Menjadi lebih sempurna"],
							"correct": 2,
							"explanation": "Tidur nyenyak yang menghilangkan kesadaran adalah salah satu hal yang membatalkan wudhu. Ini berbeda dengan mengantuk ringan di mana seseorang masih bisa mendengar suara di sekitarnya."
						},
						{
							"question": "Darah, nanah, kotoran manusia/hewan, dan bangkai (selain ikan dan belalang) termasuk dalam kategori najis?",
							"options": ["Mughallazhah", "Mutawassithah", "Mukhaffafah", "Ma'fu (Dimaafkan)"],
							"correct": 1,
							"explanation": "Najis Mutawassithah (pertengahan) adalah jenis najis yang paling umum dijumpai. Cara menyucikannya adalah dengan menghilangkan wujud, rasa, warna, dan baunya menggunakan air muthlaq."
						},
						{
							"question": "Prinsip utama dalam makanan dan minuman menurut fiqih Islam adalah bahwa 'segala sesuatu pada dasarnya adalah halal, kecuali...'",
							"options": ["Yang tidak enak rasanya", "Yang harganya mahal", "Yang ada dalil tegas mengharamkannya", "Yang tidak disebutkan namanya"],
							"correct": 2,
							"explanation": "Ini adalah kaidah fiqih penting. Kita tidak boleh mengharamkan sesuatu kecuali ada dalil yang jelas dari Al-Qur'an atau Hadits Shahih yang melarangnya."
						},
						{
							"question": "Hewan yang mati tanpa melalui proses penyembelihan syar'i disebut bangkai (maitah). Manakah dari berikut ini yang DIKECUALIKAN dan halal dimakan?",
							"options": ["Ayam yang mati tertabrak", "Sapi yang mati karena sakit", "Ikan dan Belalang", "Kambing yang mati tercekik"],
							"correct": 2,
							"explanation": "Rasulullah Shallallahu 'alaihi wasallam bersabda, 'Dihalalkan bagi kita dua bangkai dan dua darah'. Dua bangkai tersebut adalah ikan dan belalang, sedangkan dua darah adalah hati dan limpa."
						},
						{
							"question": "Minuman yang memabukkan, baik sedikit maupun banyak, disebut khamr dan hukumnya haram. Alasan utama pengharamannya adalah karena khamr...?",
							"options": ["Rasanya pahit", "Harganya mahal", "Dapat merusak akal dan menjadi induk kejahatan", "Berasal dari buah-buahan"],
							"correct": 2,
							"explanation": "Pengharaman khamr bertujuan untuk menjaga akal (hifzhul 'aql), salah satu dari lima tujuan utama syariat Islam (Maqashid Syariah). Hilangnya akal sehat menjadi pemicu berbagai tindakan kriminal dan dosa lainnya."
						},
						{
							"question": "Berikut ini yang merupakan rukun nikah yang harus ada agar pernikahan dianggap sah adalah?",
							"options": ["Adanya resepsi pernikahan (walimah)", "Adanya wali dari pihak mempelai wanita", "Adanya cinta antara kedua mempelai", "Adanya cincin kawin"],
							"correct": 1,
							"explanation": "Menurut jumhur (mayoritas) ulama, pernikahan tidak sah tanpa adanya wali yang sah bagi mempelai wanita. Rukun nikah lainnya adalah adanya mempelai pria, mempelai wanita, dua orang saksi, dan ijab qabul."
						},
						{
							"question": "Pemberian wajib dari calon suami kepada calon istri sebagai bentuk penghormatan dan kesungguhan, yang menjadi hak mutlak istri, disebut?",
							"options": ["Nafkah", "Mahar (Mas Kawin)", "Hadiah", "Seserahan"],
							"correct": 1,
							"explanation": "Mahar adalah salah satu rukun nikah. Besarannya tidak ditentukan secara spesifik, namun dianjurkan untuk tidak memberatkan. Mahar terbaik adalah yang paling mudah."
						},
						{
							"question": "Kewajiban utama seorang suami terhadap istrinya yang mencakup sandang, pangan, dan papan (pakaian, makanan, dan tempat tinggal) disebut?",
							"options": ["Mahar", "Waris", "Hibah", "Nafkah"],
							"correct": 3,
							"explanation": "Memberikan nafkah yang layak sesuai kemampuannya adalah kewajiban suami dan hak istri. Melalaikan kewajiban ini tanpa udzur adalah perbuatan dosa."
						},
						{
							"question": "Salah satu syarat sahnya jual beli adalah barang yang diperjualbelikan harus jelas dan tidak mengandung unsur ketidakpastian yang bisa menimbulkan sengketa. Unsur ketidakpastian ini disebut?",
							"options": ["Riba", "Gharar", "Maysir", "Tadlis"],
							"correct": 1,
							"explanation": "Gharar adalah ketidakjelasan pada objek, harga, atau waktu penyerahan. Contohnya adalah menjual 'ikan di dalam kolam' atau 'janin di dalam kandungan'. Jual beli seperti ini dilarang."
						},
						{
							"question": "Pengambilan tambahan dari pokok utang sebagai syarat yang ditetapkan di awal adalah definisi dari?",
							"options": ["Keuntungan (Ribh)", "Sewa (Ujrah)", "Riba", "Hadiah (Hibah)"],
							"correct": 2,
							"explanation": "Riba adalah salah satu dosa besar dalam Islam. Setiap pinjaman yang mensyaratkan adanya kelebihan saat pengembalian adalah riba, tidak peduli seberapa besar atau kecil tambahan tersebut."
						},
						{
							"question": "Serah terima dalam akad jual beli, di mana penjual mengucapkan penawaran ('Saya jual...') dan pembeli mengucapkan penerimaan ('Saya beli...'), disebut?",
							"options": ["Syahadatain", "Khitbah", "Ijab dan Qabul", "Akad dan Niat"],
							"correct": 2,
							"explanation": "Ijab (penawaran) dan Qabul (penerimaan) adalah rukun dari akad jual beli yang menunjukkan keridhaan (saling rela) antara kedua belah pihak."
						},
						{
							"question": "Mandi yang diwajibkan untuk menghilangkan hadas besar, seperti setelah berhubungan suami-istri atau setelah haid, disebut?",
							"options": ["Mandi Jumat", "Mandi Taubat", "Mandi Wajib (Ghusl Janabah)", "Mandi Sunnah"],
							"correct": 2,
							"explanation": "Mandi wajib memiliki rukun yang harus dipenuhi, yaitu niat dan meratakan air ke seluruh tubuh, mulai dari ujung rambut hingga ujung kaki."
						},
						{
							"question": "Daging hewan yang disembelih oleh seorang muslim dengan menyebut nama Allah adalah halal. Bagaimana hukum daging sembelihan Ahli Kitab (Yahudi dan Nasrani)?",
							"options": ["Haram secara mutlak", "Halal, selama mereka menyembelih sesuai syariat agamanya", "Makruh", "Hanya halal jika dalam kondisi darurat"],
							"correct": 1,
							"explanation": "Al-Qur'an (Surat Al-Ma'idah ayat 5) menyatakan bahwa sembelihan Ahli Kitab adalah halal bagi kaum muslimin, dengan syarat mereka tidak menyebut nama selain Allah saat menyembelih."
						},
						{
							"question": "Kewajiban utama seorang istri terhadap suaminya adalah taat dalam hal yang...?",
							"options": ["Menguntungkan dirinya", "Disukai oleh keluarganya", "Tidak bertentangan dengan syariat Allah", "Bersifat duniawi saja"],
							"correct": 2,
							"explanation": "Ketaatan istri kepada suami adalah bentuk ibadah, namun ketaatan ini dibatasi. Tidak ada ketaatan kepada makhluk dalam hal bermaksiat kepada Al-Khaliq (Sang Pencipta)."
						},
						{
							"question": "Menukar emas dengan emas atau perak dengan perak disyaratkan harus sama takarannya dan diserahkan saat itu juga. Jika ada penundaan waktu penyerahan, maka akan jatuh ke dalam?",
							"options": ["Riba Fadhl (riba kualitas)", "Riba an-Nasi'ah (riba penundaan)", "Jual beli yang sah", "Gharar"],
							"correct": 1,
							"explanation": "Riba an-Nasi'ah adalah riba yang timbul karena adanya penundaan waktu pembayaran atau penyerahan pada barang-barang ribawi (seperti emas, perak, kurma, gandum)."
						},
						{
							"question": "Air kencing bayi laki-laki yang hanya minum ASI dan belum makan makanan lain termasuk najis?",
							"options": ["Mughallazhah", "Mutawassithah", "Mukhaffafah", "Tidak najis"],
							"correct": 2,
							"explanation": "Najis Mukhaffafah (ringan) adalah najis yang paling ringan cara menyucikannya. Cukup dengan memercikkan air ke area yang terkena najis tersebut hingga merata."
						},
						{
							"question": "Proses lamaran atau pinangan dalam Islam sebelum melangsungkan akad nikah disebut?",
							"options": ["Walimah", "Ta'aruf", "Khitbah", "Ijab Qabul"],
							"correct": 2,
							"explanation": "Khitbah adalah lamaran resmi dari pihak pria kepada pihak wanita. Wanita yang telah di-khitbah oleh seorang pria, haram bagi pria lain untuk melamarnya."
						},
						{
							"question": "Apa syarat utama agar sebuah transaksi jual beli dianggap sah dalam Islam?",
							"options": ["Adanya keuntungan besar", "Barang yang dijual harus baru", "Adanya unsur saling ridha (rela) antara penjual dan pembeli", "Dilakukan di dalam pasar"],
							"correct": 2,
							"explanation": "Prinsip 'An Taradhin Minkum' (saling ridha di antara kalian) yang disebutkan dalam Surat An-Nisa' adalah ruh dan fondasi dari semua transaksi muamalah dalam Islam. Tidak boleh ada paksaan, penipuan, atau ketidakjelasan."
						},
						{
							"question": "Surah pertama dalam Al-Qur'an yang juga disebut 'Ummul Kitab' (Induk Kitab) adalah Al-Fatihah, yang artinya?",
							"options": ["Sapi Betina", "Keluarga Imran", "Pembukaan", "Hidangan"],
							"correct": 2,
							"explanation": "Al-Fatihah berarti 'Pembukaan' karena ia menjadi pembuka dari Al-Qur'an dan wajib dibaca pada setiap rakaat shalat. Surah ini merangkum seluruh isi pokok Al-Qur'an."
						},
						{
							"question": "Surah dalam Al-Qur'an yang dianjurkan untuk dibaca karena keutamaannya sebagai 'jantung Al-Qur'an' (Qalbul Qur'an) adalah surah?",
							"options": ["Al-Baqarah", "Yasin", "Ar-Rahman", "Al-Waqi'ah"],
							"correct": 1,
							"explanation": "Meskipun hadits yang menyatakannya secara spesifik diperdebatkan kekuatannya, Surah Yasin secara tradisi dan keyakinan banyak ulama dianggap memiliki kedudukan istimewa seperti jantung bagi tubuh."
						},
						{
							"question": "Surah-surah yang diturunkan sebelum hijrah Nabi ke Madinah, yang umumnya berisi tentang penguatan akidah dan tauhid, diklasifikasikan sebagai surah?",
							"options": ["Madaniyah", "Makkiyah", "Misriyah", "Syamiyah"],
							"correct": 1,
							"explanation": "Surah Makkiyah (diturunkan di Makkah) memiliki ciri khas ayat-ayatnya yang pendek, sastranya kuat, dan fokus utamanya adalah membangun fondasi keimanan kepada Allah dan hari akhir."
						},
						{
							"question": "Surah-surah yang diturunkan setelah hijrah Nabi ke Madinah, yang banyak berisi tentang hukum syariat, muamalah, dan kisah ahli kitab, disebut surah?",
							"options": ["Makkiyah", "Madaniyah", "Hijaziyah", "Yamaniyah"],
							"correct": 1,
							"explanation": "Surah Madaniyah (diturunkan di Madinah) umumnya memiliki ayat-ayat yang lebih panjang dan isinya lebih rinci mengatur hukum-hukum bagi masyarakat Islam yang baru terbentuk."
						},
						{
							"question": "Surat Al-Lahab ('Tabbat Yada Abi Lahabin Watab') turun sebagai jawaban langsung atas penentangan keras dari salah seorang paman Nabi, yaitu?",
							"options": ["Abu Thalib", "Hamzah bin Abdul Muthalib", "Abbas bin Abdul Muthalib", "Abu Lahab"],
							"correct": 3,
							"explanation": "Asbabun Nuzul (sebab turunnya) surat ini adalah ketika Abu Lahab secara terbuka mencela dakwah Nabi di bukit Shafa. Surat ini adalah satu-satunya surat yang secara eksplisit menyebut nama musuh Islam."
						},
						{
							"question": "Perbedaan mendasar antara Hadits Qudsi dan Hadits Nabawi adalah?",
							"options": ["Hadits Qudsi lebih shahih", "Hadits Nabawi lebih panjang", "Makna Hadits Qudsi berasal dari Allah, sedangkan lafaznya dari Nabi", "Hadits Qudsi hanya boleh diriwayatkan oleh sahabat tertentu"],
							"correct": 2,
							"explanation": "Dalam Hadits Qudsi, Nabi Muhammad Shallallahu 'alaihi wasallam meriwayatkan firman Allah dengan redaksi (lafaz) dari beliau sendiri. Sedangkan Hadits Nabawi, baik makna maupun lafaznya berasal dari Nabi Shallallahu 'alaihi wasallam."
						},
						{
							"question": "Tingkatan hadits yang paling tinggi, di mana sanadnya bersambung, perawinya adil dan kuat hafalannya (dhabith), serta tidak ada kejanggalan (syadz) dan cacat ('illah), adalah hadits?",
							"options": ["Hasan", "Dha'if", "Maudhu'", "Shahih"],
							"correct": 3,
							"explanation": "Hadits Shahih adalah hadits yang memenuhi semua kriteria kesahihan secara sangat ketat. Hadits ini menjadi sumber hukum kedua setelah Al-Qur'an."
						},
						{
							"question": "Dua kitab hadits shahih yang paling terpercaya dan disepakati oleh mayoritas umat Islam (sering disebut 'Ash-Shahihain') adalah Shahih Bukhari dan Shahih...?",
							"options": ["Tirmidzi", "Abu Dawud", "An-Nasa'i", "Muslim"],
							"correct": 3,
							"explanation": "Imam Bukhari dan muridnya, Imam Muslim, adalah dua ulama hadits terbesar. Kitab Shahih mereka menempati posisi tertinggi dalam koleksi kitab-kitab hadits."
						},
						{
							"question": "Sahabat Nabi yang paling banyak meriwayatkan hadits (lebih dari 5000 hadits) karena kedekatan dan do'a khusus dari Nabi untuk kekuatan hafalannya adalah?",
							"options": ["Abdullah bin Umar", "Aisyah binti Abu Bakar", "Anas bin Malik", "Abu Hurairah"],
							"correct": 3,
							"explanation": "Abu Hurairah r.a. (Abdurrahman bin Shakhr Ad-Dausi) mendedikasikan hidupnya untuk menyertai Nabi dan menghafal sabda-sabda beliau, menjadikannya perawi hadits dengan jumlah riwayat terbanyak."
						},
						{
							"question": "Lengkapkan potongan hadits populer berikut: 'Innamal a'malu binniyat...', yang artinya 'Sesungguhnya setiap amalan itu tergantung pada...'",
							"options": ["Hasilnya", "Niatnya", "Ucapannya", "Kekuatannya"],
							"correct": 1,
							"explanation": "Hadits tentang niat ini adalah salah satu hadits paling fundamental dalam Islam. Ia mengajarkan bahwa nilai dari suatu amalan di sisi Allah sangat ditentukan oleh niat atau tujuan di dalam hati."
						},
						{
							"question": "Surah terpanjang dalam Al-Qur'an yang di dalamnya terdapat Ayat Kursi adalah Surah?",
							"options": ["Ali 'Imran", "An-Nisa'", "Al-Ma'idah", "Al-Baqarah"],
							"correct": 3,
							"explanation": "Surah Al-Baqarah (Sapi Betina) adalah surah terpanjang (286 ayat) dan berisi sangat banyak hukum-hukum syariat. Namanya diambil dari kisah penyembelihan sapi betina di zaman Nabi Musa a.s."
						},
						{
							"question": "Awal Surat 'Abasa turun sebagai teguran halus dari Allah kepada Nabi Muhammad Shallallahu 'alaihi wasallam karena beliau sempat bermuka masam dan berpaling dari seorang sahabat buta bernama?",
							"options": ["Abdullah bin Mas'ud", "Abdullah bin Rawahah", "Abdullah bin Ummi Maktum", "Abdullah bin Abbas"],
							"correct": 2,
							"explanation": "Peristiwa ini menunjukkan betapa luhurnya ajaran Islam. Nabi ditegur karena lebih memprioritaskan dakwah kepada pembesar Quraisy dan kurang memperhatikan seorang buta yang tulus datang mencari petunjuk."
						},
						{
							"question": "Hadits yang sanad (rantai perawinya) terputus atau salah satu perawinya memiliki kelemahan (seperti hafalan yang buruk atau tidak jujur) dikategorikan sebagai hadits?",
							"options": ["Shahih", "Hasan", "Dha'if", "Qudsi"],
							"correct": 2,
							"explanation": "Hadits Dha'if (lemah) tidak bisa dijadikan sebagai landasan hukum (syariat), namun sebagian ulama memperbolehkannya untuk fadhailul a'mal (motivasi beramal) dengan syarat-syarat tertentu."
						},
						{
							"question": "Rasulullah Shallallahu 'alaihi wasallam bersabda, 'Ad-dinu an-nasihah', yang berarti 'Agama itu adalah...'",
							"options": ["Kekuatan", "Kesabaran", "Nasihat", "Kebersihan"],
							"correct": 2,
							"explanation": "Hadits ini menunjukkan betapa pentingnya saling menasihati dalam kebenaran dan kesabaran di dalam Islam. Nasihat yang tulus adalah inti dari ajaran agama."
						},
						{
							"question": "Rangkaian nama-nama perawi yang menyampaikan suatu hadits dari generasi ke generasi hingga sampai kepada kita disebut?",
							"options": ["Matan", "Sanad", "Rijal", "Musthalah"],
							"correct": 1,
							"explanation": "Sanad (sandaran) adalah rantai transmisi hadits. Kualitas dari sanad inilah (apakah bersambung atau terputus, apakah perawinya terpercaya atau tidak) yang menentukan derajat sebuah hadits."
						},
						{
							"question": "Isi atau materi dari sebuah hadits, yaitu sabda Nabi itu sendiri setelah disebutkan rangkaian sanadnya, disebut?",
							"options": ["Sanad", "Rawi", "Matan", "Dirayah"],
							"correct": 2,
							"explanation": "Sebuah hadits terdiri dari dua komponen utama: Sanad (rantai perawi) dan Matan (isi hadits). Ulama hadits meneliti keduanya dengan sangat cermat untuk menentukan kesahihan sebuah hadits."
						},
						{
							"question": "Surat terpendek dalam Al-Qur'an yang hanya terdiri dari tiga ayat adalah Surah?",
							"options": ["An-Nasr", "Al-'Asr", "Al-Ikhlas", "Al-Kautsar"],
							"correct": 3,
							"explanation": "Surah Al-Kautsar, meskipun sangat pendek, memiliki makna yang sangat dalam tentang nikmat yang melimpah yang Allah berikan kepada Nabi Muhammad Shallallahu 'alaihi wasallam."
						},
						{
							"question": "Berapakah jumlah keseluruhan surat yang terdapat di dalam Al-Qur'an?",
							"options": ["110", "112", "114", "116"],
							"correct": 2,
							"explanation": "Al-Qur'an terdiri dari 114 surat, dimulai dari Surah Al-Fatihah dan diakhiri dengan Surah An-Nas. Semuanya adalah firman Allah yang dijamin keasliannya."
						},
						{
							"question": "Hadits yang menyatakan 'Sebaik-baik kalian adalah yang mempelajari Al-Qur'an dan mengajarkannya' diriwayatkan oleh?",
							"options": ["Umar bin Khattab", "Utsman bin Affan", "Ali bin Abi Thalib", "Abu Bakar Ash-Shiddiq"],
							"correct": 1,
							"explanation": "Hadits yang agung ini diriwayatkan oleh Khalifah Utsman bin Affan r.a. dan menjadi motivasi terbesar bagi umat Islam untuk senantiasa berinteraksi dengan Al-Qur'an, baik dengan belajar maupun mengajar."
						},
						{
							"question": "Al-Qur'an dibagi menjadi 30 bagian yang sama panjang untuk memudahkan pembacaan, terutama di bulan Ramadan. Setiap bagian ini disebut?",
							"options": ["Surat", "Ayat", "Hizb", "Juz"],
							"correct": 3,
							"explanation": "Pembagian menjadi 30 Juz ini adalah hasil ijtihad para ulama di kemudian hari untuk mempermudah target pembacaan (tilawah) Al-Qur'an, misalnya target khatam satu kali dalam sebulan."
						},
						{
							"question": "Hadits yang diriwayatkan oleh sejumlah besar perawi pada setiap tingkatannya yang secara akal mustahil mereka bersepakat untuk berdusta disebut hadits?",
							"options": ["Ahad", "Masyhur", "Aziz", "Mutawatir"],
							"correct": 3,
							"explanation": "Hadits Mutawatir memiliki tingkat keyakinan tertinggi, setara dengan Al-Qur'an, karena saking banyaknya jalur periwayatan yang saling menguatkan. Contohnya adalah hadits tentang syafa'at dan mengusap khuff."
						},
						{
							"question": "Setelah ibunda beliau, Aminah, wafat, Rasulullah Shallallahu 'alaihi wasallam saat masih kecil diasuh oleh kakeknya, yaitu?",
							"options": ["Abu Thalib", "Hamzah bin Abdul Muthalib", "Abdul Muthalib", "Abu Lahab"],
							"correct": 2,
							"explanation": "Setelah ibunya wafat, Nabi Muhammad Shallallahu 'alaihi wasallam yang saat itu berusia 6 tahun diasuh dengan penuh kasih sayang oleh kakeknya, Abdul Muthalib, hingga sang kakek wafat dua tahun kemudian."
						},
						{
							"question": "Peristiwa Isra' Mi'raj adalah perjalanan agung di mana Nabi Muhammad Shallallahu 'alaihi wasallam menerima perintah langsung dari Allah Subhanahu wa Ta'ala untuk melaksanakan?",
							"options": ["Puasa Ramadan", "Ibadah Haji", "Shalat lima waktu", "Perang melawan kaum kafir"],
							"correct": 2,
							"explanation": "Perintah shalat lima waktu adalah satu-satunya kewajiban fardhu yang diterima Nabi langsung di Sidratul Muntaha, menunjukkan kedudukannya yang sangat istimewa dalam Islam."
						},
						{
							"question": "Strategi brilian berupa penggalian parit pertahanan di sekeliling kota Madinah untuk menahan pasukan sekutu (Ahzab) dicetuskan oleh sahabat Salman Al-Farisi pada perang?",
							"options": ["Badar", "Uhud", "Khandaq", "Khaibar"],
							"correct": 2,
							"explanation": "Perang Khandaq (yang berarti 'parit') adalah contoh kecerdasan strategi perang Rasulullah Shallallahu 'alaihi wasallam dan para sahabatnya. Taktik ini belum pernah dikenal oleh bangsa Arab sebelumnya."
						},
						{
							"question": "Perjanjian Hudaibiyah antara kaum muslimin dan kaum Quraisy, meskipun secara lahiriah tampak merugikan, namun oleh Allah disebut sebagai 'kemenangan yang nyata' (Fathan Mubina). Mengapa?",
							"options": ["Karena kaum Quraisy menyerah", "Karena kaum muslimin mendapat banyak harta rampasan", "Karena membuka jalan bagi dakwah Islam secara damai dan luas", "Karena kaum Quraisy langsung masuk Islam"],
							"correct": 2,
							"explanation": "Setelah perjanjian ini, gencatan senjata memungkinkan Islam tersebar dengan pesat tanpa peperangan. Jumlah orang yang masuk Islam dalam dua tahun setelah perjanjian ini jauh lebih banyak daripada sebelumnya."
						},
						{
							"question": "Khalifah pertama setelah wafatnya Rasulullah Shallallahu 'alaihi wasallam, Abu Bakar Ash-Shiddiq, menghadapi tantangan besar berupa kaum yang menolak membayar zakat. Sikap beliau adalah?",
							"options": ["Membiarkan mereka", "Menasihati saja", "Memerangi mereka dengan tegas", "Mengurangi kewajiban zakat"],
							"correct": 2,
							"explanation": "Abu Bakar r.a. menunjukkan ketegasan yang luar biasa. Beliau menganggap menolak zakat sama bahayanya dengan menolak shalat, sehingga beliau memerangi mereka untuk menjaga keutuhan rukun Islam."
						},
						{
							"question": "Khalifah Umar bin Khattab r.a. mendapat gelar 'Al-Faruq', yang berarti?",
							"options": ["Singa Padang Pasir", "Yang Sangat Terpercaya", "Pembeda antara yang hak dan yang batil", "Pemilik Dua Cahaya"],
							"correct": 2,
							"explanation": "Umar r.a. dijuluki Al-Faruq karena ketegasannya dalam membedakan dan menegakkan kebenaran (hak) serta memberantas kebatilan, baik sebelum maupun sesudah masuk Islam."
						},
						{
							"question": "Salah satu jasa terbesar dari Khalifah Utsman bin Affan r.a. bagi umat Islam adalah standarisasi penulisan Al-Qur'an dalam satu dialek (Quraisy) yang dikenal sebagai?",
							"options": ["Mushaf Madinah", "Mushaf Utsmani", "Mushaf Al-Jam'i", "Mushaf Kufah"],
							"correct": 1,
							"explanation": "Untuk menghindari perselisihan bacaan Al-Qur'an di kalangan umat Islam yang semakin luas, Utsman r.a. membentuk tim untuk menyalin ulang Al-Qur'an dalam satu mushaf standar (Mushaf Utsmani) yang kita gunakan hingga hari ini."
						},
						{
							"question": "Masa pemerintahan Khalifah Ali bin Abi Thalib r.a. banyak diuji dengan berbagai fitnah dan perpecahan internal, yang puncaknya adalah Perang Jamal dan Perang?",
							"options": ["Yarmuk", "Qadisiyah", "Siffin", "Nahrawan"],
							"correct": 2,
							"explanation": "Perang Siffin terjadi antara pasukan Khalifah Ali r.a. dan pasukan Mu'awiyah bin Abi Sufyan. Peristiwa ini menjadi salah satu lembaran sejarah yang paling menyedihkan dalam sejarah umat Islam."
						},
						{
							"question": "Dinasti Islam pertama yang berdiri setelah masa Khulafaur Rasyidin berakhir adalah Bani Umayyah, yang didirikan oleh?",
							"options": ["Marwan bin Hakam", "Yazid bin Mu'awiyah", "Abdul Malik bin Marwan", "Mu'awiyah bin Abi Sufyan"],
							"correct": 3,
							"explanation": "Setelah Hasan bin Ali r.a. menyerahkan kekhalifahan untuk mempersatukan umat, Mu'awiyah bin Abi Sufyan r.a. menjadi khalifah dan memulai sistem pemerintahan monarki (kerajaan) Bani Umayyah."
						},
						{
							"question": "Puncak keemasan peradaban Islam dalam bidang ilmu pengetahuan, filsafat, dan kedokteran terjadi pada masa Dinasti Abbasiyah yang berpusat di kota?",
							"options": ["Damaskus", "Kufah", "Kairo", "Baghdad"],
							"correct": 3,
							"explanation": "Baghdad pada masa Dinasti Abbasiyah menjadi pusat ilmu pengetahuan dunia. Di sanalah berdiri 'Baitul Hikmah' (Rumah Kebijaksanaan), perpustakaan dan pusat penerjemahan terbesar di zamannya."
						},
						{
							"question": "Penaklukan Konstantinopel, benteng terkuat Romawi Timur, pada tahun 1453 M adalah prestasi gemilang yang dicapai oleh Sultan Muhammad Al-Fatih dari Dinasti?",
							"options": ["Abbasiyah", "Fatimiyah", "Utsmaniyah", "Ayyubiyah"],
							"correct": 2,
							"explanation": "Sultan Muhammad Al-Fatih dari Dinasti Utsmaniyah (Ottoman) berhasil mewujudkan 'bisyarah' atau kabar gembira yang pernah disampaikan oleh Rasulullah Shallallahu 'alaihi wasallam tentang penaklukan kota tersebut."
						},
						{
							"question": "Saat peristiwa Fathu Makkah (Pembebasan Kota Makkah), Rasulullah Shallallahu 'alaihi wasallam menunjukkan akhlak yang mulia dengan cara?",
							"options": ["Menghancurkan seluruh kota", "Membunuh semua pemimpin Quraisy", "Memberikan pengampunan massal kepada penduduk Makkah", "Mengambil semua harta penduduk"],
							"correct": 2,
							"explanation": "Meskipun berada di posisi pemenang, Nabi Muhammad Shallallahu 'alaihi wasallam memberikan contoh pengampunan yang luar biasa dengan berkata kepada penduduk Makkah yang dulu memusuhinya, 'Pergilah, kalian semua bebas!'."
						},
						{
							"question": "Khalifah Umar bin Khattab r.a. adalah orang yang pertama kali mencetuskan sistem penanggalan Islam yang dimulai dari peristiwa?",
							"options": ["Kelahiran Nabi", "Wafatnya Nabi", "Turunnya wahyu pertama", "Hijrah Nabi dari Makkah ke Madinah"],
							"correct": 3,
							"explanation": "Penanggalan Hijriyah, yang dimulai dari momen hijrah, dipilih karena hijrah adalah peristiwa transformatif yang menjadi tonggak berdirinya masyarakat dan negara Islam pertama."
						},
						{
							"question": "Penyebab utama terjadinya Perang Uhud adalah keinginan kaum Quraisy untuk...?",
							"options": ["Menguasai sumur Badar", "Menjalin kerjasama dagang", "Membalas kekalahan mereka di Perang Badar", "Menguji kekuatan kaum muslimin"],
							"correct": 2,
							"explanation": "Dendam atas kekalahan telak di Perang Badar setahun sebelumnya menjadi motivasi utama kaum musyrikin Quraisy untuk mengumpulkan pasukan besar dan menyerang kaum muslimin di Uhud."
						},
						{
							"question": "Gelar 'Dzun Nurain' (Pemilik Dua Cahaya) diberikan kepada Khalifah Utsman bin Affan r.a. karena beliau?",
							"options": ["Memiliki wajah yang sangat bercahaya", "Menikahi dua putri Nabi Muhammad Shallallahu 'alaihi wasallam", "Banyak bersedekah di malam hari", "Memiliki dua mushaf Al-Qur'an"],
							"correct": 1,
							"explanation": "Utsman bin Affan r.a. mendapatkan kemuliaan yang tidak didapatkan sahabat lain, yaitu menikahi dua putri Rasulullah Shallallahu 'alaihi wasallam secara berurutan: Ruqayyah, dan setelah Ruqayyah wafat, beliau menikahi Ummu Kultsum."
						},
						{
							"question": "Hijrahnya Nabi Muhammad Shallallahu 'alaihi wasallam dari Makkah ke Madinah bukan sekadar perpindahan tempat, melainkan sebuah strategi untuk?",
							"options": ["Menghindari tanggung jawab dakwah", "Mencari kekayaan", "Membangun basis negara dan masyarakat Islam yang kuat", "Berlibur dari tekanan kaum Quraisy"],
							"correct": 2,
							"explanation": "Hijrah adalah titik balik dalam sejarah Islam. Di Madinah, Nabi tidak hanya menjadi pemimpin spiritual, tetapi juga pemimpin negara yang membangun masyarakat berlandaskan Al-Qur'an dan Sunnah."
						},
						{
							"question": "Kalimat 'La ilaha illallah' dalam Syahadat mengandung dua unsur utama, yaitu penolakan (An-Nafyu) dan penetapan (Al-Itsbat). Makna yang paling tepat adalah?",
							"options": ["Banyak tuhan selain Allah", "Tiada Tuhan yang berhak disembah kecuali Allah", "Allah adalah satu-satunya Tuhan yang ada", "Tuhan itu ada di mana-mana"],
							"correct": 1,
							"explanation": "Makna yang benar adalah menolak segala bentuk sesembahan selain Allah (La ilaha) dan menetapkan bahwa satu-satunya yang berhak disembah hanyalah Allah (illallah). Ini adalah inti dari tauhid uluhiyah."
						},
						{
							"question": "Konsekuensi dari syahadat 'Muhammadun Rasulullah' adalah mentaati perintahnya, membenarkan perkataannya, dan...?",
							"options": ["Menjadikannya sebagai sesembahan", "Menganggapnya mengetahui hal ghaib", "Menjauhi larangannya dan beribadah sesuai ajarannya", "Merayakan hari kelahirannya secara berlebihan"],
							"correct": 2,
							"explanation": "Mengakui Muhammad sebagai Rasulullah berarti menjadikan beliau sebagai satu-satunya teladan dalam beribadah dan menjalankan syariat Allah, serta menjauhi apa yang beliau larang."
						},
						{
							"question": "Shalat yang disebut sebagai 'Shalatul Wustha' (shalat pertengahan) dalam Al-Qur'an dan memiliki penekanan khusus untuk dijaga adalah shalat?",
							"options": ["Subuh", "Dzuhur", "Ashar", "Maghrib"],
							"correct": 2,
							"explanation": "Mayoritas ulama tafsir berpendapat bahwa Shalatul Wustha adalah shalat Ashar. Menjaganya memiliki keutamaan yang sangat besar karena seringkali dilalaikan akibat kesibukan."
						},
						{
							"question": "Berhenti sejenak hingga seluruh anggota badan tenang pada setiap gerakan rukun shalat (misalnya setelah ruku' atau sujud) disebut?",
							"options": ["I'tidal", "Iftirasy", "Tuma'ninah", "Tasyahud"],
							"correct": 2,
							"explanation": "Tuma'ninah adalah salah satu rukun shalat yang sangat penting. Shalat yang dilakukan tergesa-gesa tanpa tuma'ninah dianggap tidak sah oleh mayoritas ulama."
						},
						{
							"question": "Shalat sunnah yang dikerjakan pada waktu pagi hari setelah matahari terbit hingga menjelang Dzuhur disebut shalat?",
							"options": ["Tahajud", "Istikharah", "Rawatib", "Dhuha"],
							"correct": 3,
							"explanation": "Shalat Dhuha dikenal sebagai shalatnya orang-orang yang bertaubat (awwabin) dan memiliki keutamaan sebagai wasiat Nabi, pembuka pintu rezeki, dan sedekah bagi seluruh sendi tubuh."
						},
						{
							"question": "Berikut ini yang merupakan syarat sah shalat (harus dipenuhi sebelum shalat dimulai) adalah?",
							"options": ["Membaca Al-Fatihah", "Sujud", "Menghadap Kiblat", "Salam"],
							"correct": 2,
							"explanation": "Menghadap Kiblat, suci dari hadas, suci badan dan tempat, serta menutup aurat adalah syarat sah shalat. Sedangkan Al-Fatihah dan sujud adalah rukun shalat (dikerjakan di dalam shalat)."
						},
						{
							"question": "Zakat yang wajib dikeluarkan setahun sekali pada bulan Ramadan untuk menyucikan jiwa setiap muslim, baik tua maupun muda, disebut?",
							"options": ["Zakat Mal", "Zakat Perdagangan", "Zakat Fitrah", "Infaq"],
							"correct": 2,
							"explanation": "Zakat Fitrah bertujuan untuk menyucikan orang yang berpuasa dari perkataan sia-sia dan kotor, serta untuk memberi makan kepada orang-orang miskin agar mereka dapat ikut merayakan Idul Fitri."
						},
						{
							"question": "Dalam 8 asnaf (golongan) penerima zakat, orang yang memiliki utang dan kesulitan melunasinya disebut?",
							"options": ["Fakir", "Amil", "Gharimin", "Ibnu Sabil"],
							"correct": 2,
							"explanation": "Gharimin adalah orang-orang yang berutang untuk kebutuhan pokok yang halal atau untuk mendamaikan orang lain. Mereka berhak menerima zakat untuk meringankan bebannya."
						},
						{
							"question": "Batas waktu kepemilikan harta (seperti emas, perak, atau ternak) selama satu tahun hijriyah sebelum wajib dikeluarkan zakatnya disebut?",
							"options": ["Nishab", "Haul", "Waqaf", "Rikaz"],
							"correct": 1,
							"explanation": "Haul adalah syarat waktu bagi beberapa jenis zakat mal. Jika harta telah mencapai nishab (batas minimal jumlah) dan tersimpan selama satu haul, maka zakatnya wajib ditunaikan."
						},
						{
							"question": "Puasa sunnah yang dilaksanakan pada tanggal 13, 14, dan 15 setiap bulan Hijriyah disebut puasa?",
							"options": ["Daud", "Arafah", "Asyura", "Ayyamul Bidh"],
							"correct": 3,
							"explanation": "Ayyamul Bidh berarti 'hari-hari putih', karena pada tanggal tersebut bulan bersinar purnama. Berpuasa pada hari-hari ini nilainya seperti berpuasa sepanjang tahun."
						},
						{
							"question": "Membayar Fidyah (memberi makan orang miskin) adalah keringanan pengganti puasa bagi orang yang...",
							"options": ["Sengaja membatalkan puasa", "Sakit ringan seperti flu", "Tidak mampu berpuasa sama sekali karena tua renta", "Tertidur sepanjang hari"],
							"correct": 2,
							"explanation": "Fidyah diperuntukkan bagi mereka yang memiliki udzur/halangan permanen dan tidak ada harapan untuk bisa meng-qadha' puasanya, seperti orang yang sudah sangat tua atau sakit parah menahun."
						},
						{
							"question": "Manakah dari perbuatan berikut yang DAPAT membatalkan puasa?",
							"options": ["Menelan ludah", "Berkumur tidak berlebihan", "Muntah dengan tidak sengaja", "Memasukkan makanan/minuman dengan sengaja"],
							"correct": 3,
							"explanation": "Inti dari puasa adalah menahan diri dari makan, minum, dan hubungan suami istri. Memasukkan sesuatu ke dalam rongga tubuh dengan sengaja adalah pembatal puasa yang utama."
						},
						{
							"question": "Puncak dari ibadah haji, di mana seluruh jamaah wajib berkumpul di sebuah padang pada tanggal 9 Dzulhijjah, adalah?",
							"options": ["Thawaf di Ka'bah", "Sa'i antara Shafa dan Marwah", "Wukuf di Arafah", "Melontar Jumrah di Mina"],
							"correct": 2,
							"explanation": "Wukuf di Arafah adalah rukun haji yang paling agung. Nabi bersabda, 'Al-Hajju Arafah' (Haji itu adalah Arafah). Meninggalkannya membuat haji tidak sah."
						},
						{
							"question": "Keadaan suci yang wajib dijalani oleh jamaah haji atau umrah, ditandai dengan niat dan mengenakan pakaian khusus (kain putih tanpa jahitan bagi pria), disebut?",
							"options": ["Tahallul", "Ihram", "Miqat", "Tawaf"],
							"correct": 1,
							"explanation": "Ihram adalah niat untuk masuk ke dalam manasik haji/umrah. Saat berihram, jamaah terikat dengan berbagai larangan, seperti memakai wewangian atau memotong kuku."
						},
						{
							"question": "Perbedaan paling mendasar antara ibadah Haji dan Umrah terletak pada pelaksanaan rukun?",
							"options": ["Thawaf", "Sa'i", "Wukuf di Arafah", "Tahallul (Bercukur)"],
							"correct": 2,
							"explanation": "Ibadah Umrah tidak memiliki rukun Wukuf di Arafah. Wukuf hanya ada dalam ibadah Haji, yang menjadikannya ibadah yang terikat dengan waktu tertentu (bulan Dzulhijjah)."
						},
						{
							"question": "Menginap atau bermalam di Muzdalifah pada malam tanggal 10 Dzulhijjah setelah dari Arafah, dalam manasik haji hukumnya adalah?",
							"options": ["Rukun Haji", "Wajib Haji", "Sunnah Haji", "Mubah (Boleh)"],
							"correct": 1,
							"explanation": "Mabit (bermalam) di Muzdalifah termasuk Wajib Haji. Jika ditinggalkan, hajinya tetap sah namun wajib membayar dam (denda)."
						},
						{
							"question": "Hal-hal yang jika ditinggalkan tidak membatalkan shalat namun dianjurkan untuk diganti dengan sujud sahwi adalah?",
							"options": ["Rukun Shalat", "Syarat Sah Shalat", "Sunnah Ab'adh", "Sunnah Hai'at"],
							"correct": 2,
							"explanation": "Sunnah Ab'adh adalah sunnah-sunnah yang sangat dianjurkan, seperti tasyahud awal dan doa qunut (dalam mazhab Syafi'i). Jika terlupa, dianjurkan sujud sahwi."
						},
						{
							"question": "Orang yang sedang dalam perjalanan jauh (musafir) yang berhak menerima zakat disebut?",
							"options": ["Riqab", "Amil", "Muallaf", "Ibnu Sabil"],
							"correct": 3,
							"explanation": "Ibnu Sabil adalah musafir yang kehabisan bekal di tengah perjalanannya (bukan untuk maksiat). Ia berhak menerima zakat untuk dapat melanjutkan perjalanannya atau kembali ke kampung halamannya."
						},
						{
							"question": "Puasa sunnah yang paling dicintai Allah, yaitu berpuasa sehari dan berbuka sehari, adalah puasa?",
							"options": ["Ayyamul Bidh", "Senin-Kamis", "Syawal", "Daud"],
							"correct": 3,
							"explanation": "Puasa Daud, yang meneladani puasanya Nabi Daud a.s., dianggap sebagai puasa sunnah yang paling afdhal karena tingkat konsistensi dan tantangannya yang tinggi."
						},
						{
							"question": "Melontar tiga jumrah (Ula, Wustha, dan Aqabah) pada hari-hari Tasyrik (11, 12, 13 Dzulhijjah) dilaksanakan di?",
							"options": ["Arafah", "Muzdalifah", "Mina", "Masjidil Haram"],
							"correct": 2,
							"explanation": "Kegiatan melontar jumrah dan mabit (bermalam) selama hari-hari Tasyrik dilaksanakan di Mina. Ini adalah bagian dari Wajib Haji."
						},
						{
							"question": "Berbicara dengan sengaja tentang urusan dunia di tengah-tengah shalat akan membuat shalat menjadi?",
							"options": ["Makruh", "Tidak sempurna", "Batal", "Lebih utama"],
							"correct": 2,
							"explanation": "Berbicara dengan sengaja, meskipun hanya satu atau dua kata yang dapat dipahami, merupakan salah satu hal yang membatalkan shalat secara langsung."
						},
						{
							"question": "Keyakinan paling fundamental dalam Islam yang menyatakan keesaan Allah Subhanahu wa Ta'ala disebut sebagai?",
							"options": ["Tawassul", "Tazkiyah", "Tauhid", "Tafakkur"],
							"correct": 2,
							"explanation": "Jawaban yang benar adalah 'Tauhid'."
						},
						{
							"question": "Asmaul Husna 'Ar-Rahman' memiliki arti?",
							"options": ["Maha Pengampun", "Maha Pengasih", "Maha Perkasa", "Maha Penyayang"],
							"correct": 1,
							"explanation": "Jawaban yang benar adalah 'Maha Pengasih'."
						},
						{
							"question": "Sifat Wajib bagi Allah 'Qidam' berarti...",
							"options": ["Kekal", "Berdiri Sendiri", "Terdahulu", "Berbeda dengan Makhluk"],
							"correct": 2,
							"explanation": "Jawaban yang benar adalah 'Terdahulu'."
						},
						{
							"question": "Malaikat yang bertugas menyampaikan wahyu Allah kepada para nabi dan rasul adalah?",
							"options": ["Mikail", "Israfil", "Izrail", "Jibril"],
							"correct": 3,
							"explanation": "Jawaban yang benar adalah 'Jibril'."
						},
						{
							"question": "Siapakah dua malaikat yang bertugas mencatat amal baik dan buruk setiap manusia?",
							"options": ["Munkar dan Nakir", "Raqib dan Atid", "Malik dan Ridwan", "Jibril dan Mikail"],
							"correct": 1,
							"explanation": "Jawaban yang benar adalah 'Raqib dan Atid'."
						},
						{
							"question": "Kitab suci Zabur diturunkan oleh Allah Subhanahu wa Ta'ala kepada?",
							"options": ["Nabi Musa a.s.", "Nabi Isa a.s.", "Nabi Daud a.s.", "Nabi Muhammad Shallallahu 'alaihi wasallam"],
							"correct": 2,
							"explanation": "Jawaban yang benar adalah 'Nabi Daud a.s.'."
						},
						{
							"question": "Al-Qur'an adalah kitab suci terakhir yang menyempurnakan kitab-kitab sebelumnya. Kepada siapakah Al-Qur'an diturunkan?",
							"options": ["Nabi Ibrahim a.s.", "Nabi Isa a.s.", "Nabi Musa a.s.", "Nabi Muhammad Shallallahu 'alaihi wasallam"],
							"correct": 3,
							"explanation": "Jawaban yang benar adalah 'Nabi Muhammad Shallallahu 'alaihi wasallam'."
						},
						{
							"question": "Berapakah jumlah nabi dan rasul yang wajib diimani oleh setiap muslim?",
							"options": ["10", "25", "124.000", "313"],
							"correct": 1,
							"explanation": "Jawaban yang benar adalah '25'."
						},
						{
							"question": "Gelar 'Ulul Azmi' diberikan kepada para rasul yang memiliki...",
							"options": ["Kekayaan melimpah", "Mukjizat paling hebat", "Keteguhan dan kesabaran luar biasa", "Umat yang paling banyak"],
							"correct": 2,
							"explanation": "Jawaban yang benar adalah 'Keteguhan dan kesabaran luar biasa' (pilihan ke-3)."
						},
						{
							"question": "Mukjizat membelah lautan dengan tongkat diberikan oleh Allah Subhanahu wa Ta'ala kepada?",
							"options": ["Nabi Sulaiman a.s.", "Nabi Musa a.s.", "Nabi Nuh a.s.", "Nabi Isa a.s."],
							"correct": 1,
							"explanation": "Jawaban yang benar adalah 'Nabi Musa a.s.'."
						},
						{
							"question": "Nama lain dari Hari Kiamat yang memiliki arti 'Hari Perhitungan' adalah?",
							"options": ["Yaumul Mizan", "Yaumul Ba'ats", "Yaumul Hisab", "Yaumul Mahsyar"],
							"correct": 2,
							"explanation": "Jawaban yang benar adalah 'Yaumul Hisab'."
						},
						{
							"question": "Alam penantian bagi ruh manusia setelah kematian hingga datangnya hari kebangkitan disebut?",
							"options": ["Alam Rahim", "Alam Barzakh", "Padang Mahsyar", "Alam Ghaib"],
							"correct": 1,
							"explanation": "Jawaban yang benar adalah 'Alam Barzakh'."
						},
						{
							"question": "Keluarnya Dajjal dan turunnya Nabi Isa a.s. adalah contoh dari tanda-tanda kiamat...",
							"options": ["Sughra (Kecil)", "Wustha (Pertengahan)", "Kubra (Besar)", "Awwal (Permulaan)"],
							"correct": 2,
							"explanation": "Jawaban yang benar adalah 'Kubra (Besar)'."
						},
						{
							"question": "Ketetapan Allah Subhanahu wa Ta'ala yang telah tertulis di Lauhul Mahfuz sejak zaman azali disebut?",
							"options": ["Qada", "Qadar", "Ikhtiar", "Tawakal"],
							"correct": 1,
							"explanation": "Jawaban yang benar adalah 'Qadar'."
						},
						{
							"question": "Realisasi atau perwujudan dari ketetapan Allah (Qadar) yang terjadi pada makhluk-Nya disebut?",
							"options": ["Qadar", "Ikhtiar", "Doa", "Qada"],
							"correct": 3,
							"explanation": "Jawaban yang benar adalah 'Qada'."
						},
						{
							"question": "Sikap yang benar terhadap takdir Allah adalah...",
							"options": ["Pasrah total tanpa berusaha", "Menyalahkan takdir jika gagal", "Beriman, ridha, dan tetap berikhtiar", "Hanya percaya pada usaha sendiri"],
							"correct": 2,
							"explanation": "Jawaban yang benar adalah 'Beriman, ridha, dan tetap berikhtiar'."
						},
						{
							"question": "Malaikat yang ditugaskan oleh Allah untuk mencabut nyawa setiap makhluk hidup adalah?",
							"options": ["Israfil", "Mikail", "Jibril", "Maut"],
							"correct": 3,
							"explanation": "Jawaban yang benar adalah 'Malaikat Maut' terdapat pada surah As-Sajdah:11."
						},
						{
							"question": "Kitab suci yang diturunkan kepada Nabi Isa a.s. sebagai petunjuk bagi kaum Bani Israil adalah?",
							"options": ["Taurat", "Zabur", "Injil", "Al-Qur'an"],
							"correct": 2,
							"explanation": "Jawaban yang benar adalah 'Injil'."
						},
						{
							"question": "Nabi yang membangun bahtera besar untuk menyelamatkan kaumnya yang beriman dari bencana banjir bandang adalah?",
							"options": ["Nabi Ibrahim a.s.", "Nabi Hud a.s.", "Nabi Nuh a.s.", "Nabi Adam a.s."],
							"correct": 2,
							"explanation": "Jawaban yang benar adalah 'Nabi Nuh a.s.'."
						},
						{
							"question": "Sifat mustahil bagi Allah 'Fana' adalah kebalikan dari sifat wajib...",
							"options": ["Wujud (Ada)", "Qidam (Terdahulu)", "Baqa' (Kekal)", "Mukhalafatu lil Hawaditsi"],
							"correct": 2,
							"explanation": "Jawaban yang benar adalah 'Baqa' (Kekal)'."
						},
						{
							"question": "Sifat Jaiz bagi Allah Subhanahu wa Ta'ala adalah suatu sifat yang...",
							"options": ["Wajib ada pada Dzat Allah", "Mustahil ada pada Dzat Allah", "Boleh Allah perbuat atau tidak perbuat", "Hanya diketahui oleh para Rasul"],
							"correct": 2,
							"explanation": "Jawaban yang benar adalah 'Boleh Allah perbuat atau tidak perbuat'."
						},
                        {
                            question: "Berapa jumlah surat dalam Al-Quran?",
                            options: ["112", "113", "114", "115"],
                            correct: 2,
                            explanation: "Al-Quran terdiri dari 114 surat, dimulai dari surat Al-Fatihah hingga An-Nas."
                        },
                        {
                            question: "Apa nama malaikat yang bertugas menyampaikan wahyu?",
                            options: ["Mikail", "Jibril", "Israfil", "Izrail"],
                            correct: 1,
                            explanation: "Malaikat Jibril (Gabriel) adalah malaikat yang bertugas menyampaikan wahyu Allah kepada para nabi."
                        },
                        {
                            question: "Berapa kali sholat fardhu dalam sehari?",
                            options: ["3", "4", "5", "6"],
                            correct: 2,
                            explanation: "Sholat fardhu dilakukan 5 kali sehari: Subuh, Dzuhur, Ashar, Maghrib, dan Isya."
                        },
                        {
                            question: "Apa nama bulan suci umat Islam?",
                            options: ["Muharram", "Rajab", "Ramadan", "Dzulhijjah"],
                            correct: 2,
                            explanation: "Ramadan adalah bulan suci umat Islam dimana diwajibkan puasa dari terbit fajar hingga terbenam matahari."
                        },
                        {
                            question: "Berapa rukun Islam?",
                            options: ["4", "5", "6", "7"],
                            correct: 1,
                            explanation: "Rukun Islam ada 5: Syahadat, Sholat, Zakat, Puasa Ramadan, dan Haji bagi yang mampu."
                        }
                    ];

                    // Pilih pertanyaan random
                    const randomIndex = Math.floor(Math.random() * islamicQuestions.length);
                    const question = islamicQuestions[randomIndex];

                    state.kuiz.currentQuestion = question;
                    state.kuiz.userAnswer = '';

                } catch (error) {
                    console.error('Error getting question:', error);
                    state.kuiz.error = 'Gagal mengambil pertanyaan. Silakan coba lagi.';
                } finally {
                    state.kuiz.isLoading = false;
                    render();
                }
            };

            const submitAnswer = () => {
                if (state.kuiz.userAnswer === '' || !state.kuiz.currentQuestion) return;

                const isCorrect = parseInt(state.kuiz.userAnswer) === state.kuiz.currentQuestion.correct;

                // Hitung skor (1-100)
                state.kuiz.totalQuestions++;
                if (isCorrect) {
                    state.kuiz.correctAnswers++;
                }

                const score = Math.round((state.kuiz.correctAnswers / state.kuiz.totalQuestions) * 100);
                state.kuiz.score = score;
                state.kuiz.correctAnswer = state.kuiz.currentQuestion.options[state.kuiz.currentQuestion.correct];
                state.kuiz.explanation = state.kuiz.currentQuestion.explanation;
                state.kuiz.showResult = true;

                // Simpan ke history
                state.kuiz.history.unshift({
                    question: state.kuiz.currentQuestion.question,
                    userAnswer: state.kuiz.currentQuestion.options[parseInt(state.kuiz.userAnswer)],
                    correctAnswer: state.kuiz.correctAnswer,
                    isCorrect: isCorrect,
                    score: score,
                    timestamp: new Date().toLocaleString('id-ID')
                });

                // Batasi history hanya 20 pertanyaan terakhir
                if (state.kuiz.history.length > 20) {
                    state.kuiz.history = state.kuiz.history.slice(0, 20);
                }

                saveData();
                render();
            };

            const resetQuiz = () => {
                state.kuiz.totalQuestions = 0;
                state.kuiz.correctAnswers = 0;
                state.kuiz.score = 0;
                state.kuiz.history = [];
                state.kuiz.showResult = false;
                state.kuiz.currentQuestion = null;
                saveData();
                render();
            };



            // === Database Kota Indonesia ===
            const INDONESIA_CITIES = [
                // Pulau Jawa
                {name: 'Jakarta', lat: -6.2088, lon: 106.8456, province: 'DKI Jakarta'},
                {name: 'Surabaya', lat: -7.2575, lon: 112.7521, province: 'Jawa Timur'},
                {name: 'Bandung', lat: -6.9175, lon: 107.6191, province: 'Jawa Barat'},
                {name: 'Bekasi', lat: -6.2383, lon: 106.9756, province: 'Jawa Barat'},
                {name: 'Medan', lat: 3.5952, lon: 98.6722, province: 'Sumatera Utara'},
                {name: 'Tangerang', lat: -6.1783, lon: 106.6319, province: 'Banten'},
                {name: 'Depok', lat: -6.4025, lon: 106.7942, province: 'Jawa Barat'},
                {name: 'Semarang', lat: -6.9667, lon: 110.4167, province: 'Jawa Tengah'},
                {name: 'Palembang', lat: -2.9761, lon: 104.7754, province: 'Sumatera Selatan'},
                {name: 'Makassar', lat: -5.1477, lon: 119.4327, province: 'Sulawesi Selatan'},
                {name: 'South Tangerang', lat: -6.2878, lon: 106.7306, province: 'Banten'},
                {name: 'Batam', lat: 1.0456, lon: 104.0305, province: 'Kepulauan Riau'},
                {name: 'Bogor', lat: -6.5950, lon: 106.8167, province: 'Jawa Barat'},
                {name: 'Pekanbaru', lat: 0.5333, lon: 101.4500, province: 'Riau'},
                {name: 'Bandar Lampung', lat: -5.4292, lon: 105.2610, province: 'Lampung'},

                // Sumatera
                {name: 'Padang', lat: -0.9492, lon: 100.3543, province: 'Sumatera Barat'},
                {name: 'Malang', lat: -7.9797, lon: 112.6304, province: 'Jawa Timur'},
                {name: 'Samarinda', lat: -0.5018, lon: 117.1536, province: 'Kalimantan Timur'},
                {name: 'Tasikmalaya', lat: -7.3506, lon: 108.2170, province: 'Jawa Barat'},
                {name: 'Banjarmasin', lat: -3.3194, lon: 114.5901, province: 'Kalimantan Selatan'},
                {name: 'Pontianak', lat: -0.0263, lon: 109.3425, province: 'Kalimantan Barat'},
                {name: 'Cimahi', lat: -6.8722, lon: 107.5423, province: 'Jawa Barat'},
                {name: 'Denpasar', lat: -8.6500, lon: 115.2167, province: 'Bali'},
                {name: 'Balikpapan', lat: -1.2379, lon: 116.8529, province: 'Kalimantan Timur'},
                {name: 'Jambi', lat: -1.6101, lon: 103.6131, province: 'Jambi'},
                {name: 'Surakarta', lat: -7.5667, lon: 110.8333, province: 'Jawa Tengah'},
                {name: 'Yogyakarta', lat: -7.7956, lon: 110.3695, province: 'DI Yogyakarta'},
                {name: 'Kupang', lat: -10.1772, lon: 123.6070, province: 'Nusa Tenggara Timur'},
                {name: 'Cirebon', lat: -6.7063, lon: 108.5570, province: 'Jawa Barat'},
                {name: 'Serang', lat: -6.1169, lon: 106.1539, province: 'Banten'},
                {name: 'Mataram', lat: -8.5833, lon: 116.1167, province: 'Nusa Tenggara Barat'},

                // Kalimantan
                {name: 'Palangka Raya', lat: -2.2136, lon: 113.9230, province: 'Kalimantan Tengah'},
                {name: 'Manado', lat: 1.4748, lon: 124.8421, province: 'Sulawesi Utara'},
                {name: 'Ambon', lat: -3.6954, lon: 128.1814, province: 'Maluku'},
                {name: 'Jayapura', lat: -2.5489, lon: 140.7000, province: 'Papua'},
                {name: 'Kendari', lat: -3.9450, lon: 122.4989, province: 'Sulawesi Tenggara'},
                {name: 'Palu', lat: -0.8917, lon: 119.8707, province: 'Sulawesi Tengah'},
                {name: 'Gorontalo', lat: 0.5435, lon: 123.0682, province: 'Gorontalo'},
                {name: 'Mamuju', lat: -2.6797, lon: 118.8878, province: 'Sulawesi Barat'},
                {name: 'Ternate', lat: 0.7886, lon: 127.3784, province: 'Maluku Utara'},
                {name: 'Bengkulu', lat: -3.8004, lon: 102.2655, province: 'Bengkulu'},
                {name: 'Banda Aceh', lat: 5.5483, lon: 95.3238, province: 'Aceh'},

                // Kota-kota Besar Lainnya
                {name: 'Cilegon', lat: -6.0022, lon: 106.0194, province: 'Banten'},
                {name: 'Sukabumi', lat: -6.9278, lon: 106.9319, province: 'Jawa Barat'},
                {name: 'Cirebon', lat: -6.7325, lon: 108.5570, province: 'Jawa Barat'},
                {name: 'Purwokerto', lat: -7.4217, lon: 109.2339, province: 'Jawa Tengah'},
                {name: 'Magelang', lat: -7.4700, lon: 110.2167, province: 'Jawa Tengah'},
                {name: 'Tegal', lat: -6.8694, lon: 109.1403, province: 'Jawa Tengah'},
                {name: 'Pekalongan', lat: -6.8886, lon: 109.6753, province: 'Jawa Tengah'},
                {name: 'Kediri', lat: -7.8167, lon: 112.0167, province: 'Jawa Timur'},
                {name: 'Blitar', lat: -8.0983, lon: 112.1681, province: 'Jawa Timur'},
                {name: 'Mojokerto', lat: -7.4667, lon: 112.4333, province: 'Jawa Timur'},
                {name: 'Madiun', lat: -7.6297, lon: 111.5239, province: 'Jawa Timur'},
                {name: 'Jember', lat: -8.1667, lon: 113.7000, province: 'Jawa Timur'},
                {name: 'Banyuwangi', lat: -8.2192, lon: 114.3689, province: 'Jawa Timur'},
                {name: 'Probolinggo', lat: -7.7542, lon: 113.2156, province: 'Jawa Timur'},

                // Sumatera Lengkap
                {name: 'Binjai', lat: 3.6000, lon: 98.4833, province: 'Sumatera Utara'},
                {name: 'Pematangsiantar', lat: 2.9667, lon: 99.0667, province: 'Sumatera Utara'},
                {name: 'Tebing Tinggi', lat: 3.3333, lon: 99.1667, province: 'Sumatera Utara'},
                {name: 'Dumai', lat: 1.6667, lon: 101.4500, province: 'Riau'},
                {name: 'Bukittinggi', lat: -0.3000, lon: 100.3700, province: 'Sumatera Barat'},
                {name: 'Solok', lat: -0.7917, lon: 100.6583, province: 'Sumatera Barat'},
                {name: 'Payakumbuh', lat: -0.2167, lon: 100.6333, province: 'Sumatera Barat'},
                {name: 'Lubuklinggau', lat: -3.3000, lon: 102.8667, province: 'Sumatera Selatan'},
                {name: 'Prabumulih', lat: -3.4333, lon: 104.2333, province: 'Sumatera Selatan'},
                {name: 'Metro', lat: -5.1139, lon: 105.3067, province: 'Lampung'},

                // Kalimantan Lengkap
                {name: 'Tarakan', lat: 3.3000, lon: 117.6333, province: 'Kalimantan Utara'},
                {name: 'Bontang', lat: 0.1333, lon: 117.5000, province: 'Kalimantan Timur'},
                {name: 'Singkawang', lat: 0.9000, lon: 108.9833, province: 'Kalimantan Barat'},

                // Sulawesi
                {name: 'Makassar', lat: -5.1477, lon: 119.4327, province: 'Sulawesi Selatan'},
                {name: 'Pare-Pare', lat: -4.0167, lon: 119.6333, province: 'Sulawesi Selatan'},
                {name: 'Palopo', lat: -2.9833, lon: 120.2000, province: 'Sulawesi Selatan'},
                {name: 'Bitung', lat: 1.4500, lon: 125.1833, province: 'Sulawesi Utara'},
                {name: 'Tomohon', lat: 1.3333, lon: 124.8333, province: 'Sulawesi Utara'},
                {name: 'Kotamobagu', lat: 0.7333, lon: 124.3167, province: 'Sulawesi Utara'},
                {name: 'Bau-Bau', lat: -5.4833, lon: 122.6000, province: 'Sulawesi Tenggara'},

                // Nusa Tenggara & Maluku
                {name: 'Singaraja', lat: -8.1167, lon: 115.0833, province: 'Bali'},
                {name: 'Bima', lat: -8.4667, lon: 118.7167, province: 'Nusa Tenggara Barat'},
                {name: 'Ende', lat: -8.8500, lon: 121.6667, province: 'Nusa Tenggara Timur'},
                {name: 'Maumere', lat: -8.6167, lon: 122.2167, province: 'Nusa Tenggara Timur'},
                {name: 'Tual', lat: -5.6333, lon: 132.7500, province: 'Maluku'},
                {name: 'Tidore', lat: 0.6833, lon: 127.4000, province: 'Maluku Utara'},

                // Papua
                {name: 'Sorong', lat: -0.8667, lon: 131.2500, province: 'Papua Barat'},
                {name: 'Merauke', lat: -8.4833, lon: 140.4000, province: 'Papua'},
                {name: 'Nabire', lat: -3.3667, lon: 135.5000, province: 'Papua'},
                {name: 'Timika', lat: -4.5333, lon: 136.8833, province: 'Papua'},
                {name: 'Biak', lat: -1.1833, lon: 136.0833, province: 'Papua'},
                {name: 'Wamena', lat: -4.1000, lon: 138.9500, province: 'Papua'},

                // Kota-kota Tambahan
                {name: 'Indramayu', lat: -6.3264, lon: 108.3200, province: 'Jawa Barat'},
                {name: 'Garut', lat: -7.2125, lon: 107.9000, province: 'Jawa Barat'},
                {name: 'Banjar', lat: -7.3667, lon: 108.5333, province: 'Jawa Barat'},
                {name: 'Subang', lat: -6.5667, lon: 107.7500, province: 'Jawa Barat'},
                {name: 'Purwakarta', lat: -6.5500, lon: 107.4333, province: 'Jawa Barat'},
                {name: 'Karawang', lat: -6.3000, lon: 107.3000, province: 'Jawa Barat'},
                {name: 'Cianjur', lat: -6.8167, lon: 107.1333, province: 'Jawa Barat'},
                {name: 'Kuningan', lat: -6.9833, lon: 108.4833, province: 'Jawa Barat'},
                {name: 'Wonogiri', lat: -7.8167, lon: 110.9167, province: 'Jawa Tengah'},
                {name: 'Klaten', lat: -7.7056, lon: 110.6056, province: 'Jawa Tengah'},
                {name: 'Boyolali', lat: -7.5333, lon: 110.5833, province: 'Jawa Tengah'},
                {name: 'Sukoharjo', lat: -7.6833, lon: 110.8333, province: 'Jawa Tengah'},
                {name: 'Karanganyar', lat: -7.6000, lon: 111.0333, province: 'Jawa Tengah'},
                {name: 'Sragen', lat: -7.4167, lon: 111.0000, province: 'Jawa Tengah'},
                {name: 'Gresik', lat: -7.1556, lon: 112.6536, province: 'Jawa Timur'},
                {name: 'Sidoarjo', lat: -7.4486, lon: 112.7181, province: 'Jawa Timur'},
                {name: 'Pasuruan', lat: -7.6453, lon: 112.9075, province: 'Jawa Timur'},
                {name: 'Lumajang', lat: -8.1333, lon: 113.2167, province: 'Jawa Timur'},
                {name: 'Bondowoso', lat: -7.9167, lon: 113.8167, province: 'Jawa Timur'},
                {name: 'Situbondo', lat: -7.7056, lon: 114.0097, province: 'Jawa Timur'},
                {name: 'Ngawi', lat: -7.4042, lon: 111.4464, province: 'Jawa Timur'},
                {name: 'Magetan', lat: -7.6167, lon: 111.3500, province: 'Jawa Timur'},
                {name: 'Pacitan', lat: -8.2000, lon: 111.0833, province: 'Jawa Timur'},
                {name: 'Ponorogo', lat: -7.8667, lon: 111.4667, province: 'Jawa Timur'},
                {name: 'Trenggalek', lat: -8.0500, lon: 111.7167, province: 'Jawa Timur'},
                {name: 'Tulungagung', lat: -8.0667, lon: 111.9000, province: 'Jawa Timur'}
            ];

            // Fungsi untuk mencari kota
            const searchCity = (query) => {
                if (!query || query.trim().length < 2) return [];

                const searchTerm = query.toLowerCase().trim();
                return INDONESIA_CITIES.filter(city =>
                    city.name.toLowerCase().includes(searchTerm) ||
                    city.province.toLowerCase().includes(searchTerm)
                ).slice(0, 10); // Batasi hasil maksimal 10
            };

            // === Sistem Jadwal Sholat ===
            const getPrayerTimes = async (city = '') => {
                state.prayerTimes.isLoading = true;
                state.prayerTimes.error = null;
                render();

                try {
                    let lat, lon, detectedCity = '', regionName = '';

                    if (city.trim()) {
                        // Cari di database kota lokal terlebih dahulu
                        const cityData = INDONESIA_CITIES.find(c =>
                            c.name.toLowerCase() === city.toLowerCase().trim()
                        );

                        if (cityData) {
                            // Gunakan data dari database lokal
                            lat = cityData.lat;
                            lon = cityData.lon;
                            state.prayerTimes.location = `${cityData.name}, ${cityData.province}`;
                        } else {
                            // Jika tidak ditemukan di database lokal, coba geocoding
                            try {
                                const geocodeUrl = `https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(city + ', Indonesia')}&key=demo&limit=1`;
                                const geocodeResponse = await fetch(geocodeUrl);
                                const geocodeData = await geocodeResponse.json();

                                if (geocodeData.results && geocodeData.results.length > 0) {
                                    const result = geocodeData.results[0];
                                    lat = result.geometry.lat;
                                    lon = result.geometry.lng;
                                    state.prayerTimes.location = `${city} (geocoded)`;
                                } else {
                                    throw new Error('Kota tidak ditemukan');
                                }
                            } catch (geocodeError) {
                                // Fallback ke Jakarta jika tidak ditemukan
                                const jakartaData = INDONESIA_CITIES.find(c => c.name === 'Jakarta');
                                lat = jakartaData.lat;
                                lon = jakartaData.lon;
                                state.prayerTimes.location = `${city}`;
                            }
                        }
                    } else {
                        // Dapatkan lokasi berdasarkan IP dengan fallback
                        try {
                            // Coba API geolocation yang mendukung HTTPS
                            const locationResponse = await fetch('https://ipapi.co/json/');
                            const locationData = await locationResponse.json();

                            if (locationData.latitude && locationData.longitude) {
                                lat = locationData.latitude;
                                lon = locationData.longitude;
                                detectedCity = locationData.city || 'Unknown';
                                regionName = locationData.region || 'Indonesia';
                                state.prayerTimes.location = `${detectedCity}, ${regionName}`;
                            } else {
                                throw new Error('Gagal mendeteksi lokasi');
                            }
                        } catch (ipError) {
                            // Fallback ke Jakarta
                            const jakartaData = INDONESIA_CITIES.find(c => c.name === 'Jakarta');
                            lat = jakartaData.lat;
                            lon = jakartaData.lon;
                            state.prayerTimes.location = 'Jakarta (default)';
                        }
                    }

                    // Gunakan API aladhan dengan HTTPS
                    const prayerUrl = `https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=20`;

                    try {
                        const response = await fetch(prayerUrl);
                        const data = await response.json();

                        if (data.code === 200) {
                            state.prayerTimes.data = data.data;
                            state.prayerTimes.lastUpdated = new Date();
                            calculateNextPrayer();
                            saveData();
                        } else {
                            throw new Error('Gagal mengambil jadwal sholat dari API');
                        }
                    } catch (apiError) {
                        // Fallback ke jadwal sholat default Jakarta
                        console.warn('API tidak tersedia, menggunakan jadwal default Jakarta');
                        state.prayerTimes.data = {
                            timings: {
                                Fajr: "04:30",
                                Dhuhr: "12:00",
                                Asr: "15:15",
                                Maghrib: "18:00",
                                Isha: "19:15"
                            },
                            date: {
                                readable: new Date().toLocaleDateString('id-ID'),
                                hijri: {
                                    date: toHijri(new Date()).day,
                                    month: {en: toHijri(new Date()).monthName},
                                    year: toHijri(new Date()).year
                                }
                            }
                        };
                        state.prayerTimes.location = state.prayerTimes.location || 'Jakarta (default)';
                        state.prayerTimes.lastUpdated = new Date();
                        calculateNextPrayer();
                        saveData();
                    }

                } catch (error) {
                    console.error('Error fetching prayer times:', error);
                    state.prayerTimes.error = 'Gagal memuat jadwal sholat. Silakan coba lagi.';
                } finally {
                    state.prayerTimes.isLoading = false;
                    render();
                }
            };

            const calculateNextPrayer = () => {
                if (!state.prayerTimes.data || !state.prayerTimes.data.timings) return;

                const now = new Date();
                const timings = state.prayerTimes.data.timings;

                // Bersihkan format waktu yang mungkin mengandung timezone
                const cleanTime = (timeStr) => {
                    if (!timeStr) return "00:00";
                    // Ambil hanya bagian HH:MM dari string waktu
                    const match = timeStr.match(/(\d{1,2}):(\d{2})/);
                    return match ? `${match[1].padStart(2, '0')}:${match[2]}` : "00:00";
                };

                const prayers = [
                    {name: 'Subuh', time: cleanTime(timings.Fajr), arabic: ''},
                    {name: 'Dzuhur', time: cleanTime(timings.Dhuhr), arabic: ''},
                    {name: 'Ashar', time: cleanTime(timings.Asr), arabic: ''},
                    {name: 'Maghrib', time: cleanTime(timings.Maghrib), arabic: ''},
                    {name: 'Isya', time: cleanTime(timings.Isha), arabic: ''}
                ];

                for (let prayer of prayers) {
                    const [hours, minutes] = prayer.time.split(':');
                    const prayerTime = new Date();
                    prayerTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);

                    if (prayerTime > now) {
                        state.prayerTimes.nextPrayer = prayer;
                        return;
                    }
                }

                // Jika sudah lewat Isya, sholat berikutnya adalah Subuh esok hari
                const [fajrHours, fajrMinutes] = prayers[0].time.split(':');
                state.prayerTimes.nextPrayer = {
                    name: 'Subuh',
                    time: prayers[0].time,
                    arabic: '',
                    isNextDay: true
                };
            };

            const updateCountdown = () => {
                if (!state.prayerTimes.nextPrayer || !state.prayerTimes.nextPrayer.time) return;

                try {
                    const now = new Date();
                    const prayer = state.prayerTimes.nextPrayer;
                    const [hours, minutes] = prayer.time.split(':');

                    if (!hours || !minutes) return;

                    let prayerTime = new Date();
                    prayerTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);

                    if (prayer.isNextDay || prayerTime <= now) {
                        prayerTime.setDate(prayerTime.getDate() + 1);
                    }

                    const diff = prayerTime - now;

                    if (diff > 0) {
                        const countdownHours = Math.floor(diff / (1000 * 60 * 60));
                        const countdownMinutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        const countdownSeconds = Math.floor((diff % (1000 * 60)) / 1000);

                        state.prayerTimes.countdown = {
                            hours: countdownHours.toString().padStart(2, '0'),
                            minutes: countdownMinutes.toString().padStart(2, '0'),
                            seconds: countdownSeconds.toString().padStart(2, '0'),
                            total: diff
                        };
                    } else {
                        state.prayerTimes.countdown = null;
                        calculateNextPrayer();
                    }
                } catch (error) {
                    console.error('Error updating countdown:', error);
                    state.prayerTimes.countdown = null;
                }
            };

            // === Sistem Tap Clipz ===
            const getRandomVideo = () => {
                playClickSound();
                state.tapClipz.isVideoLoading = true;
                render();

                // Pilih video random
                const randomIndex = Math.floor(Math.random() * state.tapClipz.videos.length);
                state.tapClipz.currentVideoIndex = randomIndex;

                // Simulasi loading untuk user experience yang lebih baik
                setTimeout(() => {
                    state.tapClipz.isVideoLoading = false;
                    render();
                }, 500);
            };

            // === Fungsi untuk City Search Dropdown ===
            const showCityDropdown = (cities) => {
                const dropdown = document.getElementById('city-search-dropdown');
                if (!dropdown) return;

                if (cities.length === 0) {
                    dropdown.innerHTML = '<div class="p-3 text-center text-slate-500 dark:text-slate-400 text-sm">Kota tidak ditemukan</div>';
                } else {
                    dropdown.innerHTML = cities.map(city => `
                        <div class="city-option p-3 hover:bg-slate-100 dark:hover:bg-slate-600 cursor-pointer border-b border-slate-100 dark:border-slate-600 last:border-b-0" data-city-name="${city.name}">
                            <div class="font-medium text-slate-800 dark:text-white">${city.name}</div>
                            <div class="text-xs text-slate-500 dark:text-slate-400">${city.province}</div>
                        </div>
                    `).join('');
                }

                dropdown.classList.remove('hidden');
            };

            const hideCityDropdown = () => {
                const dropdown = document.getElementById('city-search-dropdown');
                if (dropdown) {
                    dropdown.classList.add('hidden');
                }
            };

            // Update countdown setiap detik
            setInterval(() => {
                if (state.prayerTimes.nextPrayer && state.activeScreen === 'settings') {
                    updateCountdown();
                    const countdownElement = document.getElementById('prayer-countdown');
                    if (countdownElement && state.prayerTimes.countdown) {
                        countdownElement.innerHTML = `
                            <div class="text-2xl font-bold text-green-600 dark:text-green-400">
                                ${state.prayerTimes.countdown.hours}:${state.prayerTimes.countdown.minutes}:${state.prayerTimes.countdown.seconds}
                            </div>
                            <div class="text-sm text-slate-500 dark:text-slate-400">
                                menuju ${state.prayerTimes.nextPrayer.name} ${state.prayerTimes.nextPrayer.arabic}
                            </div>
                        `;
                    }
                }
            }, 1000);

            // --- Data Persistence ---
            const saveData = () => {
                try {
                    localStorage.setItem('muslimahAppData', JSON.stringify(state.userData));
                    localStorage.setItem('muslimahAppTheme', state.theme);
                    localStorage.setItem('muslimahChatHistory', JSON.stringify(state.tanyaCloud.chatHistory));
                    localStorage.setItem('muslimahKuizData', JSON.stringify({
                        totalQuestions: state.kuiz.totalQuestions,
                        correctAnswers: state.kuiz.correctAnswers,
                        score: state.kuiz.score,
                        history: state.kuiz.history
                    }));
                    localStorage.setItem('muslimahPrayerTimes', JSON.stringify({
                        data: state.prayerTimes.data,
                        location: state.prayerTimes.location,
                        lastUpdated: state.prayerTimes.lastUpdated
                    }));
                } catch (e) {console.error("Failed to save data:", e);}
            };

            const loadData = () => {
                try {
                    const savedData = localStorage.getItem('muslimahAppData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        state.userData = {
                            menstruationDates: data.menstruationDates || [],
                            menstruationEndDates: data.menstruationEndDates || [],
                            fastingDebt: data.fastingDebt || 0,
                            manualFastingDebt: data.manualFastingDebt || data.fastingDebt || 0
                        };

                        // Recalculate total debt
                        const automaticDebt = calculateAutomaticFastingDebt(state.userData);
                        state.userData.fastingDebt = automaticDebt + state.userData.manualFastingDebt;
                    }
                    const savedTheme = localStorage.getItem('muslimahAppTheme');
                    if (savedTheme) state.theme = savedTheme;
                    const savedChatHistory = localStorage.getItem('muslimahChatHistory');
                    if (savedChatHistory) state.tanyaCloud.chatHistory = JSON.parse(savedChatHistory);

                    const savedKuizData = localStorage.getItem('muslimahKuizData');
                    if (savedKuizData) {
                        const kuizData = JSON.parse(savedKuizData);
                        state.kuiz.totalQuestions = kuizData.totalQuestions || 0;
                        state.kuiz.correctAnswers = kuizData.correctAnswers || 0;
                        state.kuiz.score = kuizData.score || 0;
                        state.kuiz.history = kuizData.history || [];
                    }

                    const savedPrayerTimes = localStorage.getItem('muslimahPrayerTimes');
                    if (savedPrayerTimes) {
                        const prayerData = JSON.parse(savedPrayerTimes);
                        const lastUpdated = new Date(prayerData.lastUpdated);
                        const now = new Date();

                        // Update jadwal sholat jika data lebih dari 24 jam
                        if ((now - lastUpdated) < 24 * 60 * 60 * 1000) {
                            state.prayerTimes.data = prayerData.data;
                            state.prayerTimes.location = prayerData.location;
                            state.prayerTimes.lastUpdated = lastUpdated;
                            calculateNextPrayer();
                        }
                    }
                } catch (e) {console.error("Failed to load data:", e);}
            };

            // === Chat History Management ===
            const saveChatToHistory = (messages) => {
                if (messages.length === 0) return;

                const chatSession = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    messages: [...messages],
                    title: messages[0]?.text?.substring(0, 50) + (messages[0]?.text?.length > 50 ? '...' : '') || 'Chat Baru'
                };

                state.tanyaCloud.chatHistory.unshift(chatSession);

                // Batasi riwayat hanya 50 chat terakhir
                if (state.tanyaCloud.chatHistory.length > 50) {
                    state.tanyaCloud.chatHistory = state.tanyaCloud.chatHistory.slice(0, 50);
                }

                saveData();
            };

            const loadChatFromHistory = (chatId) => {
                const chat = state.tanyaCloud.chatHistory.find(c => c.id === chatId);
                if (chat) {
                    state.tanyaCloud.messages = [...chat.messages];
                    state.showChatHistory = false;
                    render();
                }
            };

            const deleteChatFromHistory = (chatId) => {
                state.tanyaCloud.chatHistory = state.tanyaCloud.chatHistory.filter(c => c.id !== chatId);
                saveData();
                render();
            };

            const clearAllChatHistory = () => {
                state.tanyaCloud.chatHistory = [];
                saveData();
                render();
            };

            const applyTheme = () => {
                if (state.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            };

            // --- UI Rendering Functions ---
            const renderHeader = () => `
                <header class="mb-6 flex justify-between items-center p-4 sm:p-6">
                    <div>
                        <h1 class="text-3xl font-bold text-slate-800 dark:text-white">Muslimah</h1>
                        <p class="text-slate-500 dark:text-slate-400">Your Daily Companion</p>
                    </div>
                </header>`;

            const renderCalendarScreen = () => {
                const {currentDate, userData} = state;
                const today = new Date();
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                // Hitung prediksi menstruasi
                const predictions = calculateMenstrualPredictions(userData);

                // Hitung total hutang puasa (otomatis + manual)
                const automaticDebt = calculateAutomaticFastingDebt(userData);
                const totalDebt = automaticDebt + userData.manualFastingDebt;

                let calendarCells = '';
                for (let i = 0; i < firstDayOfMonth; i++) {
                    calendarCells += `<div class="bg-transparent"></div>`;
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateObj = new Date(year, month, day);
                    const dateString = dateObj.toISOString().split('T')[0];
                    const hijri = toHijri(dateObj);
                    const isToday = dateObj.toDateString() === today.toDateString();
                    const isMenstruation = userData.menstruationDates.includes(dateString);
                    const isMenstruationEnd = userData.menstruationEndDates.includes(dateString);

                    // Periksa apakah tanggal ini adalah prediksi haid berikutnya
                    const isNextPeriodPrediction = predictions.nextPeriod &&
                        dateObj.getFullYear() === predictions.nextPeriod.getFullYear() &&
                        dateObj.getMonth() === predictions.nextPeriod.getMonth() &&
                        dateObj.getDate() === predictions.nextPeriod.getDate();

                    // Periksa apakah tanggal ini dalam masa subur
                    const isFertileWindow = predictions.fertileWindow &&
                        dateObj.getTime() >= predictions.fertileWindow.start.getTime() &&
                        dateObj.getTime() <= predictions.fertileWindow.end.getTime();

                    // Periksa apakah tanggal ini adalah ovulasi
                    const isOvulation = predictions.ovulation &&
                        dateObj.getFullYear() === predictions.ovulation.getFullYear() &&
                        dateObj.getMonth() === predictions.ovulation.getMonth() &&
                        dateObj.getDate() === predictions.ovulation.getDate();

                    let bgClass = '';
                    let indicators = '';

                    if (isToday) {
                        bgClass = 'bg-pink-500 text-white';
                    } else if (isMenstruation) {
                        bgClass = 'bg-red-200 dark:bg-red-800/50';
                        indicators += '<div class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full pointer-events-none"></div>';
                    } else if (isMenstruationEnd) {
                        bgClass = 'bg-pink-200 dark:bg-pink-800/50';
                        indicators += '<div class="absolute top-1 right-1 w-2 h-2 bg-pink-500 rounded-full pointer-events-none"></div>';
                    } else if (isNextPeriodPrediction) {
                        bgClass = 'bg-red-100 dark:bg-red-900/30 border-2 border-red-400';
                        indicators += '<div class="absolute top-1 left-1 w-2 h-2 bg-red-400 rounded-full pointer-events-none"></div>';
                    } else if (isOvulation) {
                        bgClass = 'bg-blue-200 dark:bg-blue-800/50';
                        indicators += '<div class="absolute top-1 right-1 w-2 h-2 bg-blue-500 rounded-full pointer-events-none"></div>';
                    } else if (isFertileWindow) {
                        bgClass = 'bg-green-100 dark:bg-green-800/30';
                        indicators += '<div class="absolute top-1 right-1 w-1.5 h-1.5 bg-green-500 rounded-full pointer-events-none"></div>';
                    } else {
                        bgClass = 'text-slate-700 dark:text-slate-200';
                    }

                    calendarCells += `
                        <div data-date="${dateString}" class="calendar-day relative h-14 flex flex-col justify-center items-center rounded-lg cursor-pointer transition-all duration-200 hover:bg-rose-100 dark:hover:bg-slate-700 ${bgClass}">
                            <span class="text-sm pointer-events-none">${day}</span>
                            <span class="text-xs pointer-events-none ${isToday ? 'text-white/70' : 'text-slate-400'}">${hijri.day}</span>
                            ${indicators}
                        </div>`;
                }

                // Render prediksi dan keterangan
                let predictionsHtml = '';
                if (predictions.nextPeriod) {
                    predictionsHtml = `
                        <div class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-lg shadow-rose-100/50 dark:shadow-slate-950/50">
                            <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3">Prediksi Siklus Menstruasi</h3>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="text-slate-600 dark:text-slate-400">Haid Berikutnya:</span>
                                    <span class="font-semibold text-red-600 dark:text-red-400">${predictions.nextPeriod.toLocaleDateString('id-ID')}</span>
                                </div>
                                ${predictions.ovulation ? `
                                    <div class="flex justify-between items-center">
                                        <span class="text-slate-600 dark:text-slate-400">Ovulasi:</span>
                                        <span class="font-semibold text-blue-600 dark:text-blue-400">${predictions.ovulation.toLocaleDateString('id-ID')}</span>
                                    </div>
                                ` : ''}
                                ${predictions.fertileWindow ? `
                                    <div class="flex justify-between items-center">
                                        <span class="text-slate-600 dark:text-slate-400">Masa Subur:</span>
                                        <span class="font-semibold text-green-600 dark:text-green-400">
                                            ${predictions.fertileWindow.start.toLocaleDateString('id-ID')} - 
                                            ${predictions.fertileWindow.end.toLocaleDateString('id-ID')}
                                        </span>
                                    </div>
                                ` : ''}
                                ${predictions.ishadhahWarning ? `
                                    <div class="p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg">
                                        <span class="text-yellow-800 dark:text-yellow-200 font-medium"> Perhatian: Haid sudah ${predictions.ishadhahWarning} hari. Jika lebih dari 15 hari, konsultasikan dengan dokter.</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>

                        <!-- Keterangan Warna -->
                        <div class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-lg shadow-rose-100/50 dark:shadow-slate-950/50">
                            <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3">Keterangan</h3>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-red-200 dark:bg-red-800/50 rounded"></div>
                                    <span class="text-slate-600 dark:text-slate-400">Haid</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-pink-200 dark:bg-pink-800/50 rounded"></div>
                                    <span class="text-slate-600 dark:text-slate-400">Akhir Haid</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-red-100 dark:bg-red-900/30 border border-red-400 rounded"></div>
                                    <span class="text-slate-600 dark:text-slate-400">Prediksi Haid</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-blue-200 dark:bg-blue-800/50 rounded"></div>
                                    <span class="text-slate-600 dark:text-slate-400">Ovulasi</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-green-100 dark:bg-green-800/30 rounded"></div>
                                    <span class="text-slate-600 dark:text-slate-400">Masa Subur</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-pink-500 rounded"></div>
                                    <span class="text-slate-600 dark:text-slate-400">Hari Ini</span>
                                </div>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="p-4 sm:p-6 space-y-6">
                        <!-- Quick Stats -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-lg shadow-rose-100/50 dark:shadow-slate-950/50">
                                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Hutang Puasa</h3>
                                <p class="text-3xl font-bold text-pink-500 dark:text-pink-400">${totalDebt} <span class="text-lg">hari</span></p>
                                <p class="text-xs text-slate-400 dark:text-slate-500">Otomatis: ${automaticDebt} | Manual: ${userData.manualFastingDebt}</p>
                            </div>
                            <div class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-lg shadow-rose-100/50 dark:shadow-slate-950/50">
                                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Total Fidyah</h3>
                                <p class="text-3xl font-bold text-pink-500 dark:text-pink-400">Rp ${(totalDebt * FIDYAH_PER_DAY).toLocaleString('id-ID')}</p>
                                <p class="text-xs text-slate-400 dark:text-slate-500">Asumsi Rp ${FIDYAH_PER_DAY.toLocaleString('id-ID')}/hari</p>
                            </div>
                        </div>

                        <!-- Calendar -->
                        <div class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-lg shadow-rose-100/50 dark:shadow-slate-950/50">
                            <div class="flex justify-between items-center mb-4">
                                <button id="prev-month-btn" class="p-2 rounded-full hover:bg-rose-100 dark:hover:bg-slate-700" title="Bulan Sebelumnya">${icons.ChevronLeft("text-slate-600 dark:text-slate-300")}</button>
                                <div>
                                    <p class="font-bold text-lg text-slate-800 dark:text-white text-center">${currentDate.toLocaleString('id-ID', {month: 'long', year: 'numeric'})}</p>
                                    <p class="text-sm text-slate-500 dark:text-slate-400 text-center">${toHijri(currentDate).monthName} ${toHijri(currentDate).year} H</p>
                                </div>
                                <button id="next-month-btn" class="p-2 rounded-full hover:bg-rose-100 dark:hover:bg-slate-700" title="Bulan Berikutnya">${icons.ChevronRight("text-slate-600 dark:text-slate-300")}</button>
                            </div>
                            <div class="grid grid-cols-7 gap-1 text-center text-xs font-semibold text-slate-500 dark:text-slate-400 mb-2">
                                ${['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'].map(day => `<div>${day}</div>`).join('')}
                            </div>
                            <div id="calendar-grid" class="grid grid-cols-7 gap-1">${calendarCells}</div>
                        </div>

                        ${predictionsHtml}

                        <!-- Fasting Manager -->
                        <div class="space-y-4">
                            <div class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-lg shadow-rose-100/50 dark:shadow-slate-950/50">
                                <h2 class="text-lg font-bold text-slate-800 dark:text-white mb-2">Manajemen Hutang Puasa Manual</h2>
                                <div class="flex items-center justify-center gap-4 my-4">
                                    <button id="decrease-debt-btn" class="p-3 bg-rose-100 dark:bg-slate-700 text-pink-600 dark:text-pink-400 rounded-full transition-transform active:scale-90" title="Kurangi Hutang">${icons.Minus("w-6 h-6")}</button>
                                    <span class="text-5xl font-bold w-24 text-center text-slate-800 dark:text-white">${userData.manualFastingDebt}</span>
                                    <button id="increase-debt-btn" class="p-3 bg-rose-100 dark:bg-slate-700 text-pink-600 dark:text-pink-400 rounded-full transition-transform active:scale-90" title="Tambah Hutang">${icons.Plus("w-6 h-6")}</button>
                                </div>
                                <p class="text-center text-sm text-slate-500 dark:text-slate-400">Ubah jumlah hari hutang puasa manual. Hutang dari Ramadan akan ditambahkan otomatis.</p>
                            </div>
                        </div>
                    </div>
                `;
            };



            const renderTapClipzScreen = () => {
                const {tapClipz} = state;
                const currentVideo = tapClipz.videos[tapClipz.currentVideoIndex];

                if (tapClipz.isVideoLoading) {
                    return `
                        <div class="h-full flex flex-col justify-center items-center">
                            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"></div>
                            <p class="mt-4 text-slate-500 dark:text-slate-400">Memuat video...</p>
                        </div>
                    `;
                }

                return `
                    <div class="h-full">
                        <!-- Video Player Full Screen -->
                        <div class="h-full bg-black">
                            <video 
                                id="tap-clipz-video"
                                class="w-full h-full object-contain"
                                controls
                                autoplay
                                preload="metadata"
                                poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 225'%3E%3Crect width='400' height='225' fill='%23000000'/%3E%3Ctext x='200' y='112' text-anchor='middle' fill='%23ffffff' font-family='Arial' font-size='16'%3EMemuat Video...%3C/text%3E%3C/svg%3E"
                            >
                                <source src="${currentVideo}" type="video/mp4">
                                Browser Anda tidak mendukung pemutar video.
                            </video>
                        </div>
                    </div>
                `;
            };

            const renderKuizScreen = () => {
                const {kuiz} = state;

                if (kuiz.isLoading) {
                    return `
                        <div class="p-4 sm:p-6 h-full flex flex-col justify-center items-center">
                            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"></div>
                            <p class="mt-4 text-slate-500 dark:text-slate-400">Mengambil pertanyaan...</p>
                        </div>
                    `;
                }

                if (kuiz.error) {
                    return `
                        <div class="p-4 sm:p-6 h-full flex flex-col justify-center items-center">
                            <div class="text-red-500 text-center mb-6">
                                ${icons.XCircle("mx-auto h-12 w-12 mb-4")}
                                <p class="text-lg font-semibold">Terjadi Kesalahan</p>
                                <p class="text-sm">${kuiz.error}</p>
                            </div>
                            <button id="retry-question-btn" class="px-6 py-3 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors">
                                Coba Lagi
                            </button>
                        </div>
                    `;
                }

                if (kuiz.showResult && kuiz.currentQuestion) {
                    const isCorrect = kuiz.userAnswer !== '' && parseInt(kuiz.userAnswer) === kuiz.currentQuestion.correct;
                    return `
                        <div class="p-4 sm:p-6 space-y-6">
                            <!-- Hasil Jawaban -->
                            <div class="p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
                                <div class="text-center mb-6">
                                    ${isCorrect ?
                            `${icons.CheckCircle("mx-auto h-16 w-16 text-green-500 mb-4")}
                                         <h2 class="text-2xl font-bold text-green-600 dark:text-green-400">Jawaban Benar!</h2>` :
                            `${icons.XCircle("mx-auto h-16 w-16 text-red-500 mb-4")}
                                         <h2 class="text-2xl font-bold text-red-600 dark:text-red-400">Jawaban Salah</h2>`
                        }
                                </div>

                                <!-- Pertanyaan -->
                                <div class="mb-4">
                                    <h3 class="font-semibold text-slate-800 dark:text-white mb-2">Pertanyaan:</h3>
                                    <p class="text-slate-600 dark:text-slate-300">${kuiz.currentQuestion.question}</p>
                                </div>

                                <!-- Jawaban User -->
                                ${kuiz.userAnswer !== '' ? `
                                    <div class="mb-4">
                                        <h3 class="font-semibold text-slate-800 dark:text-white mb-2">Jawaban Anda:</h3>
                                        <p class="text-slate-600 dark:text-slate-300 ${isCorrect ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}">${kuiz.currentQuestion.options[parseInt(kuiz.userAnswer)]}</p>
                                    </div>
                                ` : ''}

                                <!-- Jawaban Benar -->
                                <div class="mb-4">
                                    <h3 class="font-semibold text-slate-800 dark:text-white mb-2">Jawaban Benar:</h3>
                                    <p class="text-green-600 dark:text-green-400 font-medium">${kuiz.correctAnswer}</p>
                                </div>

                                <!-- Penjelasan -->
                                <div class="mb-6">
                                    <h3 class="font-semibold text-slate-800 dark:text-white mb-2">Penjelasan:</h3>
                                    <p class="text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-700 p-3 rounded-lg">${kuiz.explanation}</p>
                                </div>

                                <!-- Skor -->
                                <div class="text-center p-4 bg-pink-50 dark:bg-pink-900/20 rounded-lg mb-6">
                                    <h3 class="font-semibold text-slate-800 dark:text-white mb-2">Skor Anda</h3>
                                    <p class="text-4xl font-bold text-pink-600 dark:text-pink-400">${kuiz.score}/100</p>
                                    <p class="text-sm text-slate-500 dark:text-slate-400">${kuiz.correctAnswers}/${kuiz.totalQuestions} pertanyaan benar</p>
                                </div>

                                <!-- Tombol Aksi -->
                                <div class="flex gap-3">
                                    <button id="next-question-btn" class="flex-1 px-4 py-3 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors">
                                        Pertanyaan Berikutnya
                                    </button>
                                    <button id="reset-quiz-btn" class="px-4 py-3 bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors">
                                        ${icons.RotateCcw("w-5 h-5")}
                                    </button>
                                </div>
                            </div>

                            <!-- History Singkat -->
                            ${kuiz.history.length > 0 ? `
                                <div class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
                                    <h3 class="font-semibold text-slate-800 dark:text-white mb-3">Riwayat Terakhir</h3>
                                    <div class="space-y-2 max-h-40 overflow-y-auto">
                                        ${kuiz.history.slice(0, 3).map(item => `
                                            <div class="flex items-center gap-3 p-2 bg-slate-50 dark:bg-slate-700 rounded-lg">
                                                ${item.isCorrect ?
                                icons.CheckCircle("w-5 h-5 text-green-500") :
                                icons.XCircle("w-5 h-5 text-red-500")
                            }
                                                <div class="flex-1">
                                                    <p class="text-sm text-slate-600 dark:text-slate-300 truncate">${item.question}</p>
                                                    <p class="text-xs text-slate-400">${item.timestamp}</p>
                                                </div>
                                                <span class="text-sm font-medium ${item.isCorrect ? 'text-green-600' : 'text-red-600'}">${item.score}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }

                if (kuiz.currentQuestion) {
                    return `
                        <div class="p-4 sm:p-6 space-y-6">
                            <!-- Statistik -->
                            <div class="grid grid-cols-3 gap-4">
                                <div class="p-3 bg-white dark:bg-slate-800 rounded-xl text-center">
                                    <p class="text-sm text-slate-500 dark:text-slate-400">Pertanyaan</p>
                                    <p class="text-xl font-bold text-pink-500">${kuiz.totalQuestions + 1}</p>
                                </div>
                                <div class="p-3 bg-white dark:bg-slate-800 rounded-xl text-center">
                                    <p class="text-sm text-slate-500 dark:text-slate-400">Benar</p>
                                    <p class="text-xl font-bold text-green-500">${kuiz.correctAnswers}</p>
                                </div>
                                <div class="p-3 bg-white dark:bg-slate-800 rounded-xl text-center">
                                    <p class="text-sm text-slate-500 dark:text-slate-400">Skor</p>
                                    <p class="text-xl font-bold text-blue-500">${kuiz.totalQuestions > 0 ? Math.round((kuiz.correctAnswers / kuiz.totalQuestions) * 100) : 0}</p>
                                </div>
                            </div>

                            <!-- Pertanyaan -->
                            <div class="p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
                                <h2 class="text-xl font-bold text-slate-800 dark:text-white mb-6">${kuiz.currentQuestion.question}</h2>

                                <div class="space-y-3">
                                    ${kuiz.currentQuestion.options.map((option, index) => `
                                        <label class="flex items-center p-4 bg-slate-50 dark:bg-slate-700 rounded-lg cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors">
                                            <input type="radio" name="answer" value="${index}" class="mr-3 text-pink-500" ${kuiz.userAnswer == index ? 'checked' : ''}>
                                            <span class="text-slate-700 dark:text-slate-200">${option}</span>
                                        </label>
                                    `).join('')}
                                </div>

                                <button id="submit-answer-btn" 
                                        class="w-full mt-6 px-6 py-3 bg-pink-500 text-white font-semibold rounded-lg hover:bg-pink-600 transition-colors disabled:bg-pink-300 dark:disabled:bg-slate-600 disabled:cursor-not-allowed"
                                        ${kuiz.userAnswer === '' ? 'disabled' : ''}>
                                    Submit Jawaban
                                </button>
                            </div>
                        </div>
                    `;
                }

                // Tampilan awal - belum ada pertanyaan
                return `
                    <div class="p-4 sm:p-6 h-full flex flex-col justify-center items-center">
                        <div class="text-center mb-8">
                            ${icons.BookOpen("mx-auto h-20 w-20 text-pink-500 mb-6")}
                            <h1 class="text-3xl font-bold text-slate-800 dark:text-white mb-4">Kuiz Islam</h1>
                            <p class="text-slate-600 dark:text-slate-300 mb-2">Uji pengetahuan Anda tentang Islam</p>
                            <p class="text-sm text-slate-500 dark:text-slate-400">Berdasarkan Al-Quran dan Sunnah</p>
                        </div>

                        ${kuiz.totalQuestions > 0 ? `
                            <div class="w-full max-w-md p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg mb-6">
                                <h3 class="font-semibold text-slate-800 dark:text-white text-center mb-4">Statistik Anda</h3>
                                <div class="grid grid-cols-2 gap-4 text-center">
                                    <div>
                                        <p class="text-2xl font-bold text-pink-500">${kuiz.totalQuestions}</p>
                                        <p class="text-sm text-slate-500 dark:text-slate-400">Pertanyaan</p>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-green-500">${kuiz.score}</p>
                                        <p class="text-sm text-slate-500 dark:text-slate-400">Skor Terakhir</p>
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        <button id="start-quiz-btn" class="px-8 py-4 bg-pink-500 text-white font-semibold rounded-lg hover:bg-pink-600 transition-colors text-lg">
                            ${kuiz.totalQuestions > 0 ? 'Lanjutkan Kuiz' : 'Mulai Kuiz'}
                        </button>

                        ${kuiz.totalQuestions > 0 ? `
                            <button id="reset-quiz-btn" class="mt-4 px-6 py-2 text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 transition-colors">
                                Reset Statistik
                            </button>
                        ` : ''}
                    </div>
                `;
            };

            const renderTanyaCloudScreen = () => {
                if (state.showChatHistory) {
                    return renderChatHistoryScreen();
                }

                const {messages, isLoading} = state.tanyaCloud;
                let messagesHtml = messages.map(msg => `
                    <div class="flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}">
                        <div class="max-w-xs md:max-w-md lg:max-w-lg px-4 py-3 shadow-md ${msg.role === 'user' ? 'bg-emerald-100 dark:bg-emerald-800 text-slate-800 dark:text-slate-100 rounded-t-2xl rounded-bl-2xl' : 'bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 rounded-t-2xl rounded-br-2xl'}">
                            <p class="whitespace-pre-wrap">${msg.text}</p>
                        </div>
                    </div>
                `).join('');

                if (isLoading) {
                    messagesHtml += `
                        <div class="flex justify-start">
                            <div class="px-4 py-3 rounded-2xl bg-white dark:bg-slate-700 chat-bubble-bot shadow-md">
                                <div class="flex items-center gap-2">
                                    <div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse-dot"></div>
                                    <div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse-dot"></div>
                                    <div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse-dot"></div>
                                </div>
                            </div>
                        </div>`;
                }

                const initialMessage = messages.length === 0 && !isLoading ? `
                    <div class="w-fit mx-auto bg-sky-100 dark:bg-sky-900/50 text-sky-700 dark:text-sky-300 text-sm px-4 py-2 rounded-full shadow">
                        Mulai percakapan dengan Tanya Cloud
                    </div>` : '';

                return `
                    <div class="absolute inset-0 flex flex-col bg-rose-50 dark:bg-slate-900">
                        <!-- Header bergaya WhatsApp -->
                        <header class="flex items-center justify-between p-3 bg-white/80 dark:bg-slate-800/80 backdrop-blur-lg border-b border-slate-200/80 dark:border-slate-700/80 shrink-0 shadow-sm">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 flex items-center justify-center bg-pink-500 rounded-full text-white">
                                    ${icons.Cloudy("w-6 h-6")}
                                </div>
                                <div>
                                    <h1 class="text-lg font-bold text-slate-800 dark:text-white">Tanya Cloud</h1>
                                    <p class="text-xs text-slate-500 dark:text-slate-400">Online</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button id="new-chat-btn" class="p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-full transition-all active:scale-90" title="Chat Baru">
                                    ${icons.Plus("w-5 h-5")}
                                </button>
                                <button id="chat-history-btn" class="p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-full transition-all active:scale-90" title="Riwayat Chat">
                                    ${icons.History("w-5 h-5")}
                                </button>
                            </div>
                        </header>

                        <!-- Kontainer Chat dengan Latar Belakang -->
                        <div 
                            id="chat-container" 
                            class="flex-grow p-4 overflow-y-auto space-y-4"
                            style="background-image: linear-gradient(rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8)), url('https://www.transparenttextures.com/patterns/az-subtle.png');"
                        >
                            ${initialMessage}
                            ${messagesHtml}
                        </div>

                        <!-- Area Input Teks di Bawah -->
                        <div class="p-2 bg-white/80 dark:bg-slate-800/80 backdrop-blur-lg border-t border-slate-200/80 dark:border-slate-700/80 shrink-0">
                            <div class="flex items-center gap-2">
                                <input
                                    id="chat-input"
                                    type="text"
                                    value="${state.tanyaCloud.prompt}"
                                    placeholder="Ketik pesan..."
                                    class="flex-grow w-full px-4 py-2 bg-slate-100 dark:bg-slate-700 border-transparent rounded-full focus:outline-none focus:ring-2 focus:ring-pink-400 text-slate-800 dark:text-white"
                                    ${isLoading ? 'disabled' : ''}
                                />
                                <button 
                                    id="send-button"
                                    ${isLoading || !state.tanyaCloud.prompt.trim() ? 'disabled' : ''}
                                    class="w-10 h-10 flex items-center justify-center bg-pink-500 text-white rounded-full disabled:bg-pink-300 dark:disabled:bg-slate-600 disabled:cursor-not-allowed transition-all hover:bg-pink-600 active:scale-90 shrink-0"
                                >
                                    ${icons.SendHorizonal("w-5 h-5")}
                                </button>
                            </div>
                        </div>
                    </div>`;
            };

            const renderChatHistoryScreen = () => {
                const {chatHistory} = state.tanyaCloud;

                let historyHtml = '';
                if (chatHistory.length === 0) {
                    historyHtml = `
                        <div class="text-center text-slate-500 dark:text-slate-400 p-8">
                            ${icons.History("mx-auto h-12 w-12 mb-4")}
                            <p>Belum ada riwayat chat</p>
                            <p class="text-sm mt-2">Mulai chat baru untuk melihat riwayat di sini</p>
                        </div>`;
                } else {
                    historyHtml = chatHistory.map(chat => `
                        <div class="p-4 bg-white dark:bg-slate-700 rounded-xl border border-slate-200 dark:border-slate-600 hover:shadow-md transition-all cursor-pointer chat-history-item" data-chat-id="${chat.id}">
                            <div class="flex justify-between items-start pointer-events-none">
                                <div class="flex-grow">
                                    <h3 class="font-semibold text-slate-800 dark:text-white text-sm">${chat.title}</h3>
                                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">${new Date(chat.timestamp).toLocaleDateString('id-ID', {
                        weekday: 'short',
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}</p>
                                    <p class="text-xs text-slate-400 dark:text-slate-500 mt-1">${chat.messages.length} pesan</p>
                                </div>
                                <button class="p-1 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-all pointer-events-auto delete-chat-btn" data-chat-id="${chat.id}" title="Hapus Chat">
                                    ${icons.Trash2("w-4 h-4 pointer-events-none")}
                                </button>
                            </div>
                        </div>
                    `).join('');
                }

                return `
                    <div class="px-4 sm:px-6 pb-4 flex-grow flex flex-col overflow-hidden">
                        <!-- Header riwayat -->
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex items-center gap-3">
                                <button id="back-from-history-btn" class="p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-full transition-all" title="Kembali ke Chat">
                                    ${icons.ArrowLeft("w-5 h-5")}
                                </button>
                                <div>
                                    <h1 class="text-2xl font-bold text-slate-800 dark:text-white">Riwayat Chat</h1>
                                    <p class="text-slate-500 dark:text-slate-400">${chatHistory.length} percakapan tersimpan</p>
                                </div>
                            </div>
                            ${chatHistory.length > 0 ? `
                                <button id="clear-history-btn" class="px-3 py-2 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-all text-sm font-medium">
                                    Hapus Semua
                                </button>
                            ` : ''}
                        </div>

                        <div id="chat-history-list" class="flex-grow bg-white dark:bg-slate-800 rounded-2xl p-4 overflow-y-auto space-y-3">
                            ${historyHtml}
                        </div>
                    </div>`;
            };

            const renderSettingsScreen = () => {
                const {prayerTimes} = state;

                let prayerTimesContent = '';

                if (prayerTimes.isLoading) {
                    prayerTimesContent = `
                        <div class="text-center py-8">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"></div>
                            <p class="mt-2 text-slate-500 dark:text-slate-400">Mengambil jadwal sholat...</p>
                        </div>
                    `;
                } else if (prayerTimes.error) {
                    prayerTimesContent = `
                        <div class="text-center py-6">
                            <p class="text-red-500 mb-4">${prayerTimes.error}</p>
                            <button id="retry-prayer-times-btn" class="px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors">
                                Coba Lagi
                            </button>
                        </div>
                    `;
                } else if (prayerTimes.data && prayerTimes.data.timings) {
                    const timings = prayerTimes.data.timings;

                    // Bersihkan format waktu
                    const cleanTime = (timeStr) => {
                        if (!timeStr) return "00:00";
                        const match = timeStr.match(/(\d{1,2}):(\d{2})/);
                        return match ? `${match[1].padStart(2, '0')}:${match[2]}` : "00:00";
                    };

                    const prayers = [
                        {name: 'Subuh', time: cleanTime(timings.Fajr), arabic: ''},
                        {name: 'Dzuhur', time: cleanTime(timings.Dhuhr), arabic: ''},
                        {name: 'Ashar', time: cleanTime(timings.Asr), arabic: ''},
                        {name: 'Maghrib', time: cleanTime(timings.Maghrib), arabic: ''},
                        {name: 'Isya', time: cleanTime(timings.Isha), arabic: ''}
                    ];

                    updateCountdown();

                    prayerTimesContent = `
                        <div class="space-y-4">
                            <!-- Next Prayer Countdown -->
                            ${prayerTimes.nextPrayer ? `
                                <div class="text-center p-4 bg-gradient-to-r from-green-100 to-blue-100 dark:from-green-900/30 dark:to-blue-900/30 rounded-xl">
                                    <h4 class="text-sm font-semibold text-slate-600 dark:text-slate-300 mb-2">Sholat Berikutnya</h4>
                                    <div id="prayer-countdown">
                                        ${prayerTimes.countdown ? `
                                            <div class="text-2xl font-bold text-green-600 dark:text-green-400">
                                                ${prayerTimes.countdown.hours}:${prayerTimes.countdown.minutes}:${prayerTimes.countdown.seconds}
                                            </div>
                                            <div class="text-sm text-slate-500 dark:text-slate-400">
                                                menuju ${prayerTimes.nextPrayer.name} ${prayerTimes.nextPrayer.arabic}
                                            </div>
                                        ` : `
                                            <div class="text-lg font-semibold text-green-600 dark:text-green-400">
                                                ${prayerTimes.nextPrayer.name} ${prayerTimes.nextPrayer.arabic}
                                            </div>
                                            <div class="text-sm text-slate-500 dark:text-slate-400">
                                                ${prayerTimes.nextPrayer.time}
                                            </div>
                                        `}
                                    </div>
                                </div>
                            ` : ''}

                            <!-- Location Info -->
                            <div class="flex items-center justify-between text-sm">
                                <div class="flex items-center gap-2">
                                    ${icons.MapPin("text-slate-500 w-4 h-4")}
                                    <span class="text-slate-600 dark:text-slate-400">${prayerTimes.location}</span>
                                </div>
                                <button id="refresh-prayer-times-btn" class="text-pink-500 hover:text-pink-600 transition-colors">
                                    Perbarui
                                </button>
                            </div>

                            <!-- Prayer Times List -->
                            <div class="grid grid-cols-1 gap-2">
                                ${prayers.map(prayer => `
                                    <div class="flex justify-between items-center py-2 px-3 rounded-lg ${prayerTimes.nextPrayer && prayerTimes.nextPrayer.name === prayer.name ? 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800' : 'bg-slate-50 dark:bg-slate-700/50'}">
                                        <div class="flex items-center gap-3">
                                            <span class="text-sm font-medium text-slate-700 dark:text-slate-200">${prayer.name}</span>
                                            <span class="text-xs text-slate-500 dark:text-slate-400">${prayer.arabic}</span>
                                        </div>
                                        <span class="font-semibold ${prayerTimes.nextPrayer && prayerTimes.nextPrayer.name === prayer.name ? 'text-green-600 dark:text-green-400' : 'text-slate-600 dark:text-slate-300'}">${prayer.time}</span>
                                    </div>
                                `).join('')}
                            </div>

                            <!-- Date Info -->
                            <div class="text-center text-xs text-slate-400 dark:text-slate-500 pt-2">
                                ${prayerTimes.data.date ?
                            `${prayerTimes.data.date.readable || new Date().toLocaleDateString('id-ID')} | ${prayerTimes.data.date.hijri ? `${prayerTimes.data.date.hijri.date} ${prayerTimes.data.date.hijri.month.en} ${prayerTimes.data.date.hijri.year}` : `${toHijri(new Date()).day} ${toHijri(new Date()).monthName} ${toHijri(new Date()).year} H`}` :
                            `${new Date().toLocaleDateString('id-ID')} | ${toHijri(new Date()).day} ${toHijri(new Date()).monthName} ${toHijri(new Date()).year} H`
                        }
                            </div>
                        </div>
                    `;
                } else {
                    prayerTimesContent = `
                        <div class="text-center py-6">
                            <p class="text-slate-500 dark:text-slate-400 mb-4">Jadwal sholat belum dimuat</p>
                            <button id="load-prayer-times-btn" class="px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors">
                                Muat Jadwal Sholat
                            </button>
                        </div>
                    `;
                }

                return `
                    <div class="p-4 sm:p-6 space-y-6">
                        <h2 class="text-xl font-bold text-slate-800 dark:text-white">Pengaturan</h2>

                        <!-- Prayer Times -->
                        <div class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-lg shadow-rose-100/50 dark:shadow-slate-950/50">
                            <div class="flex items-center gap-3 mb-4">
                                ${icons.Clock("text-pink-500")}
                                <h3 class="font-semibold text-slate-700 dark:text-slate-200">Jadwal Sholat</h3>
                            </div>

                            <!-- City Search -->
                            <div class="mb-4">
                                <div class="relative">
                                    <div class="flex gap-2">
                                        <div class="flex-grow relative">
                                            <input 
                                                id="city-search-input" 
                                                type="text" 
                                                placeholder="Ketik nama kota di Indonesia..." 
                                                class="w-full px-3 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 text-slate-800 dark:text-white text-sm"
                                                autocomplete="off"
                                            />
                                            <!-- Dropdown hasil pencarian -->
                                            <div id="city-search-dropdown" class="absolute top-full left-0 right-0 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto hidden">
                                                <!-- Hasil pencarian akan muncul di sini -->
                                            </div>
                                        </div>
                                        <button id="search-city-btn" class="px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors text-sm">
                                            Cari
                                        </button>
                                        <button id="clear-city-btn" class="px-3 py-2 bg-slate-300 dark:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-400 dark:hover:bg-slate-500 transition-colors text-sm" title="Reset ke lokasi otomatis">
                                            Reset
                                        </button>
                                    </div>
                                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
                                        Database lengkap 98 kota di Indonesia. Kosongkan untuk deteksi lokasi otomatis.
                                    </p>
                                </div>
                            </div>

                            ${prayerTimesContent}
                        </div>

                        <!-- Theme Toggle -->
                        <div class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-lg shadow-rose-100/50 dark:shadow-slate-950/50 flex justify-between items-center">
                            <div class="flex items-center gap-4">
                                ${state.theme === 'light' ? icons.Sun("text-pink-500") : icons.Moon("text-pink-400")}
                                <span class="font-semibold text-slate-700 dark:text-slate-200">Mode Tampilan</span>
                            </div>
                            <button id="theme-toggle-btn" class="relative inline-flex items-center h-8 w-14 rounded-full transition-colors ${state.theme === 'light' ? 'bg-pink-500' : 'bg-slate-600'}">
                                <span class="inline-block w-6 h-6 transform bg-white rounded-full transition-transform ${state.theme === 'light' ? 'translate-x-1' : 'translate-x-7'}"></span>
                            </button>
                        </div>

                        <!-- Account Info -->
                        <div class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-lg shadow-rose-100/50 dark:shadow-slate-950/50">
                            <h3 class="font-semibold text-slate-700 dark:text-slate-200 mb-2">Informasi Akun</h3>
                            <p class="text-sm text-slate-500 dark:text-slate-400">
                                Data Anda disimpan secara lokal di perangkat ini. Menghapus data aplikasi akan menghilangkan semua catatan Anda. Jika ada kesalahan jadwal sholat maka ikuti jadwal sholat sesuai lokasi tempat tinggal.
                            </p>
                        </div>

                        <!-- About -->
                        <div class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-lg shadow-rose-100/50 dark:shadow-slate-950/50 text-center">
                            <h3 class="font-semibold text-slate-700 dark:text-slate-200">Muslimah App v1.0</h3>
                            <p class="text-sm text-slate-500 dark:text-slate-400">Dibuat dengan  oleh <strong>CLOUD SUNNAH</strong></p>
                        </div>
                    </div>`;
            };

            const renderBottomNav = () => {
                const navItems = [
                    {id: 'tap-clipz', label: 'Tap Clipz', icon: icons.Play},
                    {id: 'kuiz', label: 'Kuiz', icon: icons.BookOpen},
                    {id: 'calendar', label: 'Kalender', icon: icons.CalendarDays},
                    {id: 'tanya-cloud', label: 'Tanya Cloud', icon: icons.Cloudy},
                    {id: 'settings', label: 'Pengaturan', icon: icons.Settings},
                ];

                bottomNavBarContainer.innerHTML = `
                    <div class="flex justify-around items-center max-w-md mx-auto h-20">
                        ${navItems.map(item => `
                            <button
                                data-screen="${item.id}"
                                class="nav-button flex flex-col items-center justify-center w-20 h-20 transition-all duration-300 transform ${state.activeScreen === item.id ? 'bottom-nav-button-active' : ''}"
                            >
                                <div class="p-3 rounded-full transition-all duration-300 pointer-events-none ${state.activeScreen === item.id ? 'bg-pink-500 shadow-lg shadow-pink-300/50 dark:shadow-pink-800/50' : ''}">
                                    ${item.icon(`transition-colors duration-300 pointer-events-none ${state.activeScreen === item.id ? 'text-white' : 'text-slate-500 dark:text-slate-400'}`)}
                                </div>
                                <span class="text-xs mt-1 font-bold transition-colors duration-300 pointer-events-none ${state.activeScreen === item.id ? 'text-pink-600 dark:text-pink-400' : 'text-slate-500 dark:text-slate-400'}">
                                    ${item.label}
                                </span>
                            </button>
                        `).join('')}
                    </div>
                `;
            };

            const renderModal = () => {
                if (state.isModalOpen && state.selectedDate) {
                    // Parsing tanggal yang benar tanpa timezone offset
                    const dateParts = state.selectedDate.split('-');
                    const year = parseInt(dateParts[0]);
                    const month = parseInt(dateParts[1]) - 1; // Month is 0-indexed in JavaScript
                    const day = parseInt(dateParts[2]);

                    const localDate = new Date(year, month, day);

                    const isMarkedStart = state.userData.menstruationDates.includes(state.selectedDate);
                    const isMarkedEnd = state.userData.menstruationEndDates.includes(state.selectedDate);

                    const modalHtml = `
                    <div id="menstruation-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex justify-center items-center z-50 p-4">
                        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-sm text-center shadow-2xl">
                            <p class="text-slate-500 dark:text-slate-400 mb-6">Pilih jenis penanda:</p>
                            <div class="flex flex-col gap-3">
                                <button id="mark-start-period-btn" class="w-full ${isMarkedStart ? 'bg-red-500' : 'bg-red-400'} text-white font-bold py-3 px-4 rounded-lg hover:bg-red-600 transition-colors">
                                    ${isMarkedStart ? 'Hapus Tanda Mulai Haid' : 'Tandai Mulai Haid'}
                                </button>
                                <button id="mark-end-period-btn" class="w-full ${isMarkedEnd ? 'bg-pink-500' : 'bg-pink-400'} text-white font-bold py-3 px-4 rounded-lg hover:bg-pink-600 transition-colors">
                                    ${isMarkedEnd ? 'Hapus Tanda Selesai Haid' : 'Tandai Selesai Haid'}
                                </button>
                                <button id="cancel-modal-btn" class="w-full bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-bold py-3 px-4 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors">
                                    Batal
                                </button>
                            </div>
                        </div>
                    </div>`;
                    document.body.insertAdjacentHTML('beforeend', modalHtml);
                } else {
                    const modal = document.getElementById('menstruation-modal');
                    if (modal) modal.remove();
                }
            }

            // --- Event Handlers ---
            const setActiveScreen = (screen) => {
                playClickSound();
                state.activeScreen = screen;
                state.showChatHistory = false;

                // Auto-play video acak saat klik menu Tap Clipz
                if (screen === 'tap-clipz') {
                    getRandomVideo();
                } else {
                    render();
                }
            };
            const changeMonth = (offset) => {
                playClickSound();
                state.currentDate = new Date(state.currentDate.getFullYear(), state.currentDate.getMonth() + offset, 1);
                render();
            };
            const handleDayClick = (dateString) => {
                playClickSound();
                state.selectedDate = dateString;
                state.isModalOpen = true;
                render();
            };
            const closeModal = () => {
                playClickSound();
                state.isModalOpen = false;
                state.selectedDate = null;
                render();
            };
            const handleMarkStartPeriod = () => {
                playClickSound();
                if (!state.selectedDate) return;

                const isAlreadyMarked = state.userData.menstruationDates.includes(state.selectedDate);

                if (isAlreadyMarked) {
                    // Hapus tanda
                    state.userData.menstruationDates = state.userData.menstruationDates.filter(d => d !== state.selectedDate);
                } else {
                    // Tambah tanda
                    state.userData.menstruationDates = [...state.userData.menstruationDates, state.selectedDate].sort();

                    // Periksa apakah tanggal ini di bulan Ramadan untuk menambah hutang puasa otomatis
                    const date = new Date(state.selectedDate);
                    const hijri = toHijri(date);
                    if (hijri.month === 9) { // Bulan Ramadan
                        // Tidak perlu menambah manual karena sudah dihitung otomatis
                    }
                }

                // Update state userData dengan total debt yang benar
                state.userData.fastingDebt = calculateAutomaticFastingDebt(state.userData) + state.userData.manualFastingDebt;
                saveData();

                // Auto close modal setelah aksi berhasil
                setTimeout(() => {
                    closeModal();
                }, 100);
            };

            const handleMarkEndPeriod = () => {
                playClickSound();
                if (!state.selectedDate) return;

                const isAlreadyMarked = state.userData.menstruationEndDates.includes(state.selectedDate);

                if (isAlreadyMarked) {
                    // Hapus tanda
                    state.userData.menstruationEndDates = state.userData.menstruationEndDates.filter(d => d !== state.selectedDate);
                } else {
                    // Tambah tanda
                    state.userData.menstruationEndDates = [...state.userData.menstruationEndDates, state.selectedDate].sort();
                }

                saveData();

                // Auto close modal setelah aksi berhasil
                setTimeout(() => {
                    closeModal();
                }, 100);
            };

            const handleDebtChange = (amount) => {
                playClickSound();
                state.userData.manualFastingDebt = Math.max(0, state.userData.manualFastingDebt + amount);
                state.userData.fastingDebt = calculateAutomaticFastingDebt(state.userData) + state.userData.manualFastingDebt;
                saveData();
                render();
            };
            const toggleTheme = () => {
                playClickSound();
                state.theme = state.theme === 'light' ? 'dark' : 'light';
                applyTheme();
                saveData();
                render();
            };
            const toggleChatHistory = () => {
                playClickSound();
                state.showChatHistory = !state.showChatHistory;
                render();
            };
            const handleNewChat = () => {
                playClickSound();
                if (state.tanyaCloud.messages.length > 0) {
                    saveChatToHistory(state.tanyaCloud.messages);
                }
                state.tanyaCloud.messages = [];
                state.tanyaCloud.prompt = '';
                state.tanyaCloud.isLoading = false;
                state.tanyaCloud.error = null;
                render();
            };
            const handleSendMessage = async () => {
                const prompt = state.tanyaCloud.prompt.trim();
                if (!prompt || state.tanyaCloud.isLoading) return;

                playClickSound();

                state.tanyaCloud.messages.push({role: 'user', text: prompt});
                state.tanyaCloud.prompt = '';
                state.tanyaCloud.isLoading = true;
                state.tanyaCloud.error = null;
                render();

                if (!navigator.onLine) {
                    state.tanyaCloud.messages.push({
                        role: 'bot',
                        text: 'Maaf, tidak ada koneksi internet. Silakan periksa koneksi Anda dan coba lagi.'
                    });
                    state.tanyaCloud.isLoading = false;
                    render();
                    return;
                }

                // URL API proxy
                const apiUrl = `https://muslimah-zeta.vercel.app/api/proxy`;

                const systemPrompt = "Anda adalah 'Cloud Sunnah', asisten AI Islami yang ramah, bijak, dan berpengetahuan luas. Jawablah semua pertanyaan dari sudut pandang ajaran Islam berdasarkan Al-Qur'an dan Sunnah. Selalu berikan jawaban yang menenangkan, informatif, dan mudah dipahami oleh audiens Muslimah di Indonesia. Gunakan bahasa Indonesia yang baik dan santun.";

                // Map the entire conversation history to the format required by the Gemini API.
                const contentsForAPI = state.tanyaCloud.messages.map(msg => ({
                    role: msg.role === 'bot' ? 'model' : 'user',
                    parts: [{text: msg.text}]
                }));

                const payload = {
                    contents: contentsForAPI,
                    systemInstruction: {parts: [{text: systemPrompt}]},
                };

                try {
                    // Kirim request ke proxy kita
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`API Error: ${response.statusText}`);

                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    const botMessage = candidate?.content?.parts?.[0]?.text || "Maaf, terjadi sedikit kendala. Coba beberapa saat lagi ya.";

                    state.tanyaCloud.messages.push({role: 'bot', text: botMessage});

                } catch (err) {
                    console.error("Proxy or API Error:", err);
                    state.tanyaCloud.messages.push({role: 'bot', text: generateLocalResponse(prompt)});
                } finally {
                    state.tanyaCloud.isLoading = false;
                    render();
                }
            };
            const generateLocalResponse = (prompt) => {
                const lowerPrompt = prompt.toLowerCase();
                if (lowerPrompt.includes('assalamualaikum') || lowerPrompt.includes('salam')) {
                    return 'Waalaikumsalam warahmatullahi wabarakatuh. Ada yang bisa saya bantu?';
                }
                if (lowerPrompt.includes('haid') || lowerPrompt.includes('menstruasi')) {
                    return 'Haid adalah siklus alami bagi wanita. Selama masa ini, ada beberapa ibadah yang tidak dilakukan seperti sholat dan puasa, namun bisa digantikan dengan dzikir atau mendengarkan kajian. Setelah suci, jangan lupa untuk mengqada puasa yang tertinggal ya.';
                }
                return `Mohon maaf, sepertinya terjadi sedikit gangguan saat terhubung dengan server AI kami. \n\nSebagai AI sederhana, saya menyarankan untuk berkonsultasi dengan ustadz atau ulama terpercaya untuk mendapatkan jawaban yang lebih komprehensif. Sementara itu, selalu ingat untuk senantiasa bertakwa kepada Allah Subhanahu wa Ta'ala dan mengikuti sunnah Rasulullah Shallallahu 'alaihi wasallam. \n\nSilakan coba lagi beberapa saat. Barakallahu fiik! `;
            };

            // --- Attaching Event Listeners ---
            const addGlobalEventListeners = () => {
                // Event delegation for clicks within the main app container
                appContainer.addEventListener('click', (e) => {
                    const target = e.target;

                    // Bottom Nav
                    const navButton = target.closest('.nav-button');
                    if (navButton?.dataset.screen) return setActiveScreen(navButton.dataset.screen);

                    // Calendar Screen
                    if (target.closest('#prev-month-btn')) return changeMonth(-1);
                    if (target.closest('#next-month-btn')) return changeMonth(1);
                    if (target.closest('#decrease-debt-btn')) return handleDebtChange(-1);
                    if (target.closest('#increase-debt-btn')) return handleDebtChange(1);
                    const dayElement = target.closest('.calendar-day');
                    if (dayElement?.dataset.date) return handleDayClick(dayElement.dataset.date);



                    // Tap Clipz Screen events (none needed as auto-play is handled in setActiveScreen)

                    // Kuiz Screen
                    if (target.closest('#start-quiz-btn')) return getRandomQuestion();
                    if (target.closest('#submit-answer-btn')) return submitAnswer();
                    if (target.closest('#next-question-btn')) return getRandomQuestion();
                    if (target.closest('#retry-question-btn')) return getRandomQuestion();
                    if (target.closest('#reset-quiz-btn')) return resetQuiz();

                    // Settings Screen
                    if (target.closest('#theme-toggle-btn')) return toggleTheme();
                    if (target.closest('#load-prayer-times-btn')) return getPrayerTimes();
                    if (target.closest('#retry-prayer-times-btn')) return getPrayerTimes();
                    if (target.closest('#refresh-prayer-times-btn')) return getPrayerTimes(state.prayerTimes.location);
                    if (target.closest('#search-city-btn')) {
                        const cityInput = document.getElementById('city-search-input');
                        if (cityInput) return getPrayerTimes(cityInput.value);
                    }
                    if (target.closest('#clear-city-btn')) {
                        const cityInput = document.getElementById('city-search-input');
                        if (cityInput) {
                            cityInput.value = '';
                            hideCityDropdown();
                        }
                        return getPrayerTimes(''); // Reset ke deteksi otomatis
                    }

                    // City dropdown selection
                    const cityOption = target.closest('.city-option');
                    if (cityOption) {
                        const cityName = cityOption.dataset.cityName;
                        const cityInput = document.getElementById('city-search-input');
                        if (cityInput && cityName) {
                            cityInput.value = cityName;
                            hideCityDropdown();
                            return getPrayerTimes(cityName);
                        }
                    }

                    // Tanya Cloud
                    if (target.closest('#new-chat-btn')) return handleNewChat();
                    if (target.closest('#chat-history-btn')) return toggleChatHistory();
                    if (target.closest('#send-button')) return handleSendMessage();

                    // Chat History
                    if (target.closest('#back-from-history-btn')) return toggleChatHistory();
                    if (target.closest('#clear-history-btn')) return clearAllChatHistory();
                    const deleteBtn = target.closest('.delete-chat-btn');
                    if (deleteBtn) return deleteChatFromHistory(Number(deleteBtn.dataset.chatId));
                    const historyItem = target.closest('.chat-history-item');
                    if (historyItem) return loadChatFromHistory(Number(historyItem.dataset.chatId));
                });

                // Listeners for modals which are appended directly to the body
                document.body.addEventListener('click', e => {
                    // Modal actions
                    if (e.target.closest('#mark-start-period-btn') || e.target.id === 'mark-start-period-btn') return handleMarkStartPeriod();
                    if (e.target.closest('#mark-end-period-btn') || e.target.id === 'mark-end-period-btn') return handleMarkEndPeriod();
                    if (e.target.closest('#cancel-modal-btn') || e.target.id === 'cancel-modal-btn') return closeModal();

                    // Close modal when clicking on modal background
                    if (e.target.id === 'menstruation-modal') return closeModal();
                });

                // Listeners for non-click events that don't bubble well for delegation
                appContainer.addEventListener('input', e => {
                    if (e.target.id === 'chat-input') {
                        state.tanyaCloud.prompt = e.target.value;
                        const sendButton = document.getElementById('send-button');
                        if (sendButton) sendButton.disabled = state.tanyaCloud.isLoading || !state.tanyaCloud.prompt.trim();
                    }

                    // City search autocomplete
                    if (e.target.id === 'city-search-input') {
                        const query = e.target.value;
                        if (query.length >= 2) {
                            const results = searchCity(query);
                            showCityDropdown(results);
                        } else {
                            hideCityDropdown();
                        }
                    }
                });

                // Hide dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    const searchInput = document.getElementById('city-search-input');
                    const dropdown = document.getElementById('city-search-dropdown');

                    if (searchInput && dropdown &&
                        !searchInput.contains(e.target) &&
                        !dropdown.contains(e.target)) {
                        hideCityDropdown();
                    }
                });



                // Event listener untuk radio button kuiz
                appContainer.addEventListener('change', e => {
                    if (e.target.name === 'answer') {
                        state.kuiz.userAnswer = e.target.value;
                        const submitButton = document.getElementById('submit-answer-btn');
                        if (submitButton) submitButton.disabled = false;
                    }
                });

                appContainer.addEventListener('keypress', e => {
                    if (e.target.id === 'chat-input' && e.key === 'Enter') {
                        e.preventDefault();
                        handleSendMessage();
                    }
                    if (e.target.id === 'city-search-input' && e.key === 'Enter') {
                        e.preventDefault();
                        getPrayerTimes(e.target.value);
                    }
                });
            };

            // --- Main Render Function ---
            const render = () => {
                let contentHtml = '';
                mainContent.className = "flex-grow overflow-y-auto relative";

                switch (state.activeScreen) {
                    case 'tap-clipz':
                        contentHtml = renderTapClipzScreen();
                        break;
                    case 'kuiz':
                        contentHtml = renderHeader() + renderKuizScreen();
                        break;
                    case 'calendar':
                        contentHtml = renderHeader() + renderCalendarScreen();
                        break;
                    case 'tanya-cloud':
                        mainContent.className = "flex-grow overflow-hidden relative";
                        contentHtml = renderTanyaCloudScreen();
                        break;
                    case 'settings':
                        contentHtml = renderHeader() + renderSettingsScreen();
                        break;
                }
                mainContent.innerHTML = contentHtml;
                renderBottomNav();
                renderModal();

                if (state.activeScreen === 'tanya-cloud' && !state.showChatHistory) {
                    const chatContainer = document.getElementById('chat-container');
                    if (chatContainer) chatContainer.scrollTop = chatContainer.scrollHeight;
                }
            };

            // --- App Initialization ---
            const init = () => {
                loadData();
                applyTheme();
                addGlobalEventListeners(); // Listeners are now added only once

                // Inisialisasi video random pertama kali
                getRandomVideo();

                render();

                // Load prayer times if not available
                if (!state.prayerTimes.data) {
                    setTimeout(() => getPrayerTimes(), 2000);
                }
            };

            // Initialize app only after authentication
            window.initApp = init;
        });
    </script>
</body>

</html>
